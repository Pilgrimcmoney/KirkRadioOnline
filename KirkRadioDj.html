<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kirk Radio DJ - Professional DJ Software</title>
    <!-- Using inline Font Awesome icons instead of external CSS -->
    <style>
        /* Font Awesome core inline styles */
        .fas, .fab, .fa {
            -moz-osx-font-smoothing: grayscale;
            -webkit-font-smoothing: antialiased;
            display: inline-block;
            font-style: normal;
            font-variant: normal;
            text-rendering: auto;
            line-height: 1;
        }
        
        /* Tailwind utility classes (minimal subset used in this app) */
        .w-full { width: 100%; }
        .flex { display: flex; }
        .grid { display: grid; }
        .hidden { display: none; }
        .block { display: block; }
        .relative { position: relative; }
        .absolute { position: absolute; }
        .fixed { position: fixed; }
        .sticky { position: sticky; }
        .flex-1 { flex: 1 1 0%; }
        .flex-col { flex-direction: column; }
        .items-center { align-items: center; }
        .justify-center { justify-content: center; }
        .justify-between { justify-content: space-between; }
        .gap-2 { gap: 0.5rem; }
        .gap-6 { gap: 1.5rem; }
        .p-2 { padding: 0.5rem; }
        .p-4 { padding: 1rem; }
        .p-6 { padding: 1.5rem; }
        .px-2 { padding-left: 0.5rem; padding-right: 0.5rem; }
        .px-3 { padding-left: 0.75rem; padding-right: 0.75rem; }
        .px-4 { padding-left: 1rem; padding-right: 1rem; }
        .py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }
        .pl-10 { padding-left: 2.5rem; }
        .pt-4 { padding-top: 1rem; }
        .pt-8 { padding-top: 2rem; }
        .mb-1 { margin-bottom: 0.25rem; }
        .mb-2 { margin-bottom: 0.5rem; }
        .mb-3 { margin-bottom: 0.75rem; }
        .mb-4 { margin-bottom: 1rem; }
        .ml-2 { margin-left: 0.5rem; }
        .mr-1 { margin-right: 0.25rem; }
        .mr-2 { margin-right: 0.5rem; }
        .mx-2 { margin-left: 0.5rem; margin-right: 0.5rem; }
        .mt-2 { margin-top: 0.5rem; }
        .mt-4 { margin-top: 1rem; }
        .mt-10 { margin-top: 2.5rem; }
        .space-x-2 > :not([hidden]) ~ :not([hidden]) { margin-left: 0.5rem; }
        .space-x-4 > :not([hidden]) ~ :not([hidden]) { margin-left: 1rem; }
        .space-x-6 > :not([hidden]) ~ :not([hidden]) { margin-left: 1.5rem; }
        .space-y-2 > :not([hidden]) ~ :not([hidden]) { margin-top: 0.5rem; }
        .space-y-4 > :not([hidden]) ~ :not([hidden]) { margin-top: 1rem; }
        .space-y-6 > :not([hidden]) ~ :not([hidden]) { margin-top: 1.5rem; }
        .grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
        .grid-cols-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); }
        .rounded { border-radius: 0.25rem; }
        .rounded-full { border-radius: 9999px; }
        .border { border-width: 1px; }
        .border-t { border-top-width: 1px; }
        .border-b { border-bottom-width: 1px; }
        .border-r { border-right-width: 1px; }
        .text-center { text-align: center; }
        .text-white { color: white; }
        .text-gray-400 { color: #9ca3af; }
        .text-gray-500 { color: #6b7280; }
        .text-sm { font-size: 0.875rem; line-height: 1.25rem; }
        .text-lg { font-size: 1.125rem; line-height: 1.75rem; }
        .text-xl { font-size: 1.25rem; line-height: 1.75rem; }
        .text-xs { font-size: 0.75rem; line-height: 1rem; }
        .font-medium { font-weight: 500; }
        .truncate { overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .w-24 { width: 6rem; }
        .w-32 { width: 8rem; }
        .w-64 { width: 16rem; }
        .h-24 { height: 6rem; }
        .h-32 { height: 8rem; }
        .h-64 { height: 16rem; }
        
        /* Font Awesome icons - just the ones we need */
        .fa-search:before { content: "🔍"; }
        .fa-folder-open:before { content: "📂"; }
        .fa-plus:before { content: "➕"; }
        .fa-file-export:before { content: "📤"; }
        .fa-google-drive:before { content: "📁"; }
        .fa-microsoft:before { content: "📁"; }
        .fa-youtube:before { content: "📺"; }
        .fa-soundcloud:before { content: "🎵"; }
        .fa-database:before { content: "🗃️"; }
        .fa-external-link-alt:before { content: "🔗"; }
        .fa-link:before { content: "🔗"; }
        .fa-save:before { content: "💾"; }
        .fa-file-audio:before { content: "🎵"; }
        .fa-broadcast-tower:before { content: "📡"; }
        .fa-cog:before { content: "⚙️"; }
        .fa-volume-up:before { content: "🔊"; }
        .fa-sync:before { content: "🔄"; }
        .fa-key:before { content: "🔑"; }
        .fa-redo:before { content: "🔁"; }
        .fa-play:before { content: "▶️"; }
        .fa-pause:before { content: "⏸️"; }
        .fa-stop:before { content: "⏹️"; }
        .fa-step-backward:before { content: "⏮️"; }
        .fa-step-forward:before { content: "⏭️"; }
        .fa-chevron-down:before { content: "🔽"; }
        .fa-expand:before { content: "⤢"; }
        .fa-search:before { content: "🔍"; }
    </style>
    <style>
        /* Fix for search input and menu dropdown text visibility */
        input[type="text"], input[type="password"], select, option {
            color: white !important;
        }
        input::placeholder {
            color: #888 !important;
            opacity: 1;
        }
        input[type="text"]:focus, input[type="password"]:focus {
            outline: none;
            border-color: #D42F00;
            box-shadow: 0 0 0 1px #D42F00;
        }
        select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-position: right 0.5rem center;
            background-repeat: no-repeat;
            background-size: 1.5em 1.5em;
            padding-right: 2rem !important;
        }
        select:focus {
            outline: none;
            border-color: #D42F00;
            box-shadow: 0 0 0 1px #D42F00;
        }
        
        /* Custom checkbox styling */
        input[type="checkbox"] {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            border: 1px solid #444;
            border-radius: 3px;
            background-color: #333;
            position: relative;
            cursor: pointer;
            outline: none;
        }
        
        input[type="checkbox"]:checked {
            background-color: #D42F00;
            border-color: #D42F00;
        }
        
        input[type="checkbox"]:checked::after {
            content: '✓';
            position: absolute;
            color: white;
            font-size: 12px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        input[type="checkbox"]:focus {
            border-color: #D42F00;
            box-shadow: 0 0 0 1px #D42F00;
        }
        
        :root {
            --primary: #D42F00;
            --background: #111;
            --secondary: #222;
            --border: #333;
            --highlight-active: #D42F00;
            --highlight-inactive: #555;
            --text-primary: #fff;
            --text-secondary: #aaa;
            --kirk-radio-red: #D42F00;
        }
        
        /* Add Kirk Radio logo background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('assets/kirk_radio_logo.jpg');
            background-size: 500px;
            background-position: center;
            background-repeat: no-repeat;
            opacity: 0.1;
            z-index: -1;
            filter: brightness(0.8) contrast(1.2);
            pointer-events: none;
        }

        body {
            background-color: var(--background);
            color: var(--text-primary);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            position: relative;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* Add overlay to make content more visible over background image */
        body::after {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: -1;
        }

        .deck {
            background-color: var(--secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }

        .deck:hover {
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.5);
        }

        /* Enhanced 3D turntable setup */
        .turntable-container {
            position: relative;
            width: 220px;
            height: 220px;
            margin: 0 auto;
            perspective: 1200px;
            transform-style: preserve-3d;
        }

        /* 3D turntable platter with enhanced depth */
        .turntable-platter {
            position: absolute;
            width: 220px;
            height: 220px;
            border-radius: 50%;
            background-color: #1a1a1a;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) translateZ(-5px);
            z-index: -1;
            box-shadow: 0 5px 15px rgba(0,0,0,0.7);
            border: 3px solid #2a2a2a;
            overflow: hidden;
        }

        /* Enhanced 3D platter base with metallic effect */
        .turntable-platter::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: radial-gradient(
                circle at center,
                #333 0%,
                #222 30%,
                #1a1a1a 70%,
                #111 100%
            );
            top: 0;
            left: 0;
            z-index: -1;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.8);
        }

        /* Enhanced turntable strobe marks with 3D effect */
        .strobe-marks {
            position: absolute;
            width: 220px;
            height: 220px;
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) translateZ(-2px);
            z-index: 0;
            background: repeating-conic-gradient(
                #333 0deg 10deg,
                #222 10deg 20deg
            );
            box-shadow: inset 0 0 15px rgba(0,0,0,0.8);
            opacity: 0.8;
        }
        
        /* Add metallic rim to platter for 3D effect */
        .platter-rim {
            position: absolute;
            width: 220px;
            height: 220px;
            border-radius: 50%;
            border: 4px solid;
            border-color: #444 #333 #222 #333;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) translateZ(-3px);
            z-index: 0;
            box-shadow: 0 3px 10px rgba(0,0,0,0.7);
        }

        /* Enhanced 3D vinyl record with improved depth */
        .vinyl {
            width: 200px;
            height: 200px;
            background: radial-gradient(circle at center, 
                #333 0%, 
                #222 45%, 
                #1a1a1a 90%,
                #111 100%);
            border-radius: 50%;
            position: relative;
            cursor: grab;
            transform-style: preserve-3d;
            box-shadow: 0 6px 20px rgba(0,0,0,0.5), 
                        inset 0 3px 10px rgba(255,255,255,0.1),
                        inset 0 -3px 10px rgba(0,0,0,0.5);
            border: 1px solid #444;
            transition: transform 0.1s ease-out;
            will-change: transform;
            z-index: 2;
            transform: translateZ(5px);
        }

        .vinyl:hover {
            box-shadow: 0 8px 25px rgba(0,0,0,0.7), 
                        inset 0 3px 10px rgba(255,255,255,0.15),
                        inset 0 -3px 10px rgba(0,0,0,0.6);
        }

        .vinyl:active {
            cursor: grabbing;
            transform: translateZ(2px);
        }

        /* Enhanced vinyl record texture with realistic grooves */
        .vinyl-texture {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: repeating-radial-gradient(
                circle at center,
                transparent,
                transparent 4px,
                rgba(30, 30, 30, 0.4) 4px,
                rgba(30, 30, 30, 0.4) 5px,
                transparent 5px,
                transparent 8px
            );
            pointer-events: none;
            z-index: 2;
            opacity: 0.9;
        }
        
        /* Enhanced vinyl center hole and spindle with 3D effect */
        .vinyl::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            background: radial-gradient(circle at center, #222, #111);
            border-radius: 50%;
            transform: translate(-50%, -50%) translateZ(1px);
            box-shadow: 0 0 0 10px rgba(50, 50, 50, 0.6), inset 0 0 5px rgba(0,0,0,0.8);
            z-index: 4;
        }

        .vinyl::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 120px;
            height: 120px;
            border: 2px solid rgba(68, 68, 68, 0.7);
            border-radius: 50%;
            transform: translate(-50%, -50%) translateZ(0.5px);
            z-index: 1;
            box-shadow: inset 0 0 5px rgba(0,0,0,0.5);
        }
        
        /* Enhanced vinyl record label with 3D effect */
        .vinyl-label-container {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 80px;
            height: 80px;
            transform: translate(-50%, -50%);
            z-index: 3;
            pointer-events: none;
            border-radius: 50%;
            transform-style: preserve-3d;
        }

        .vinyl-label {
            width: 80px;
            height: 80px;
            background: radial-gradient(circle at center, #fff 0%, #f5f5f5 70%, #eee 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            color: white;
            text-align: center;
            font-weight: bold;
            text-transform: uppercase;
            text-shadow: 0 1px 1px rgba(0,0,0,0.5);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3), inset 0 2px 3px rgba(255, 255, 255, 0.2);
            z-index: 5;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) translateZ(6px);
            border: 1px solid rgba(0,0,0,0.1);
            background-image: url('assets/kirk_radio_logo.jpg');
            background-size: cover;
            background-position: center;
        }

        /* Enhanced vinyl reflection effect */
        .vinyl-reflection {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: linear-gradient(45deg, 
                rgba(255,255,255,0.15) 0%, 
                rgba(255,255,255,0.05) 50%,
                rgba(255,255,255,0) 60%);
            z-index: 3;
            pointer-events: none;
        }
        
        /* Add vinyl groove animation */
        @keyframes pulse-groove {
            0% { opacity: 0.4; }
            50% { opacity: 0.8; }
            100% { opacity: 0.4; }
        }
        
        .vinyl-grooves {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: repeating-radial-gradient(
                circle at center,
                transparent,
                transparent 5px,
                rgba(0, 0, 0, 0.2) 5.5px,
                transparent 6px,
                transparent 15px
            );
            pointer-events: none;
            z-index: 2;
            opacity: 0.5;
            animation: pulse-groove 5s infinite ease-in-out;
        }

        /* Improved animation for vinyl rotation */
        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .vinyl.playing {
            animation: rotate 2s linear infinite;
        }

        /* Enhanced scratching animation - more responsive */
        .vinyl.scratching {
            animation: none;
            transition: transform 0.05s linear;
        }

        .waveform {
            height: 60px;
            background: #333;
            border-radius: 4px;
            position: relative;
            overflow: hidden;
        }

        .waveform-data {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            transform: scaleY(0.8);
        }

        .slider {
            -webkit-appearance: none;
            width: 100%;
            height: 4px;
            background: #444;
            border-radius: 2px;
            outline: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            background: var(--primary);
            border-radius: 50%;
            cursor: pointer;
        }

        .vertical-slider {
            writing-mode: bt-lr;
            -webkit-appearance: slider-vertical;
            width: 8px;
            height: 150px;
        }

        .dropdown-content {
            display: none;
            position: absolute;
            right: 0;
            background-color: var(--secondary);
            min-width: 300px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
            z-index: 10;
            border-radius: 4px;
            border: 1px solid var(--border);
        }

        .dropdown.active .dropdown-content {
            display: block;
        }

        /* Progress bar for tracks */
        .progress-bar {
            height: 6px;
            width: 100%;
            background-color: #333;
            border-radius: 3px;
            position: relative;
            cursor: pointer;
            overflow: hidden;
        }

        .progress-bar-fill {
            height: 100%;
            background-color: var(--primary);
            border-radius: 3px;
            width: 0%;
            transition: width 0.1s linear;
        }

        /* Enhanced 3D EQ Knobs */
        .eq-knob {
            width: 50px;
            height: 50px;
            background: radial-gradient(circle at center, #666 5%, #555 30%, #444 60%, #333 90%);
            border-radius: 50%;
            position: relative;
            margin: 0 auto;
            border: 2px solid #444;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.4);
            transform: perspective(500px) rotateX(25deg);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .eq-knob:hover {
            transform: perspective(500px) rotateX(25deg) scale(1.05);
            box-shadow: 0 6px 15px rgba(0,0,0,0.5);
            background: radial-gradient(circle at center, #777 5%, #666 30%, #555 60%, #444 90%);
        }
        
        .eq-knob:active {
            transform: perspective(500px) rotateX(25deg) scale(0.95);
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        .eq-knob::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 4px;
            height: 20px;
            background-color: var(--primary);
            transform-origin: bottom center;
            border-radius: 2px;
            box-shadow: 0 0 5px rgba(0,0,0,0.3);
        }
        
        /* Add knob grip marks for better visual feedback */
        .eq-knob::before {
            content: '';
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            width: 8px;
            height: 2px;
            background-color: #222;
            border-radius: 1px;
            box-shadow: 0 0 2px rgba(0,0,0,0.3);
        }

        .eq-knob[data-value="0"]::after {
            transform: translate(-50%, -50%) rotate(0deg);
        }
        
        /* Add transition for smooth knob rotation */
        .eq-knob::after {
            transition: transform 0.2s ease-out;
        }

        /* FX panel styles */
        .fx-button {
            padding: 8px 12px;
            background-color: #333;
            border-radius: 4px;
            cursor: pointer;
            text-align: center;
            transition: background-color 0.2s;
            border: 1px solid #444;
        }

        .fx-button.active {
            background-color: var(--primary);
            box-shadow: 0 0 10px rgba(212, 47, 0, 0.5);
        }

        /* Button styles */
        .dj-button {
            background-color: #333;
            border-radius: 4px;
            padding: 8px 12px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid #444;
            color: white;
        }

        .dj-button:hover {
            background-color: #444;
            transform: translateY(-1px);
        }

        .dj-button:active {
            transform: translateY(1px);
        }

        .dj-button.active {
            background-color: var(--primary);
            box-shadow: 0 0 10px rgba(212, 47, 0, 0.3);
        }

        /* Crossfader */
        .crossfader-container {
            width: 100%;
            padding: 15px 0;
            text-align: center;
        }

        .crossfader {
            width: 100%;
            height: 12px;
            -webkit-appearance: none;
            background: linear-gradient(to right, 
                rgba(52, 152, 219, 0.8), 
                rgba(46, 204, 113, 0.8));
            border-radius: 6px;
            outline: none;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.3);
        }

        .crossfader::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 24px;
            height: 24px;
            background: linear-gradient(to bottom, #fff, #ddd);
            border-radius: 50%;
            cursor: grab;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            border: 1px solid #aaa;
        }

        .crossfader::-webkit-slider-thumb:active {
            cursor: grabbing;
            background: linear-gradient(to bottom, #eee, #ccc);
        }

        /* Transport controls */
        .transport-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
        }

        .transport-button {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #333;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid #444;
        }

        .transport-button:hover {
            background-color: #444;
            transform: scale(1.05);
        }

        .transport-button:active {
            transform: scale(0.95);
        }

        .transport-button.active {
            background-color: var(--primary);
            box-shadow: 0 0 10px rgba(212, 47, 0, 0.5);
        }

        /* Tooltips */
        .tooltip {
            position: relative;
        }

        .tooltip .tooltip-text {
            visibility: hidden;
            width: 120px;
            background-color: #000;
            color: #fff;
            text-align: center;
            border-radius: 4px;
            padding: 5px;
            position: absolute;
            z-index: 20;
            bottom: 125%;
            left: 50%;
            margin-left: -60px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.75rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            pointer-events: none;
        }

        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        /* Alert modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 30;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: var(--secondary);
            padding: 20px;
            border-radius: 8px;
            width: 400px;
            max-width: 90%;
            border: 1px solid var(--border);
        }

        /* Track info display */
        .track-info {
            background-color: #1a1a1a;
            border: 1px solid var(--border);
            border-radius: 4px;
            padding: 8px;
            margin-bottom: 10px;
        }

        .vu-meter {
            height: 150px;
            width: 20px;
            background: linear-gradient(to top, #ff0000, #ffff00, #00ff00);
            position: relative;
            border-radius: 4px;
            overflow: hidden;
        }

        .vu-meter-fill {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 70%;
            background-color: #000;
            opacity: 0.7;
        }

        /* Enable badge */
        .enable-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: var(--primary);
            border-radius: 50%;
            width: 12px;
            height: 12px;
            display: none;
        }

        .enabled .enable-badge {
            display: block;
        }

        /* Loading indicator */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Label styles */
        .control-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 4px;
            display: block;
            text-align: center;
        }

        .section-label {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
            padding-bottom: 4px;
            border-bottom: 1px solid var(--border);
        }
    </style>
</head>
<body class="min-h-screen">
    <div class="flex h-screen">
        <!-- Left Sidebar - Track Library -->
        <div class="w-64 bg-[#1a1a1a] border-r border-[#333] flex flex-col">
            <div class="p-4 border-b border-[#333]">
                <h2 class="text-lg font-medium mb-3">Track Library</h2>
                <div class="relative">
                    <input type="text" 
                           placeholder="Search tracks..." 
                           class="w-full bg-[#222] border border-[#333] rounded px-4 py-2 pl-10 text-white focus:outline-none focus:ring-1 focus:ring-[#D42F00] focus:border-[#D42F00] placeholder-gray-500"
                           onkeyup="searchTracks(this.value)" id="searchInput">
                    <i class="fas fa-search absolute left-3 top-3 text-gray-500"></i>
                </div>
            </div>

            <div class="flex-1 max-h-fit p-4" id="trackList">
                <!-- Track list will be populated by JavaScript -->
                <div class="text-center text-gray-500 mt-10">
                    <p>No tracks loaded</p>
                    <p class="mt-2">Use "Load Track" button or click "Music Database" to see available tracks</p>
                </div>
            </div>

            <!-- Library Controls -->
            <div class="p-4 border-t border-[#333]">
                <div class="section-label">Library Controls</div>
                <button onclick="openLibraryFolder()" class="dj-button w-full mb-2 tooltip">
                    <i class="fas fa-folder-open mr-2"></i> Open Library Folder
                    <span class="tooltip-text">Open a folder to import multiple tracks at once</span>
                </button>
                <div class="flex gap-2 mb-4">
                    <button onclick="createPlaylist()" class="dj-button flex-1 tooltip">
                        <i class="fas fa-plus mr-1"></i> New Playlist
                        <span class="tooltip-text">Create a new playlist</span>
                    </button>
                    <button onclick="exportLibrary()" class="dj-button flex-1 tooltip">
                        <i class="fas fa-file-export mr-1"></i> Export
                        <span class="tooltip-text">Export your track library</span>
                    </button>
                </div>
                
                <div class="section-label">Music Services</div>
                <div class="space-y-2">
                    <button onclick="connectGoogleDrive()" class="dj-button w-full flex items-center justify-between tooltip">
                        <div><i class="fab fa-google-drive mr-2"></i> Google Drive</div>
                        <i class="fas fa-link text-xs"></i>
                        <span class="tooltip-text">Connect to your Google Drive music</span>
                    </button>
                    <button onclick="connectOneDrive()" class="dj-button w-full flex items-center justify-between tooltip">
                        <div><i class="fab fa-microsoft mr-2"></i> OneDrive</div>
                        <i class="fas fa-link text-xs"></i>
                        <span class="tooltip-text">Connect to your OneDrive music</span>
                    </button>
                    <button onclick="connectYouTube()" class="dj-button w-full flex items-center justify-between tooltip">
                        <div><i class="fab fa-youtube mr-2"></i> YouTube</div>
                        <i class="fas fa-link text-xs"></i>
                        <span class="tooltip-text">Connect to YouTube for DJ mixes and music</span>
                    </button>
                    <button onclick="connectSoundCloud()" class="dj-button w-full flex items-center justify-between tooltip">
                        <div><i class="fab fa-soundcloud mr-2"></i> SoundCloud</div>
                        <i class="fas fa-link text-xs"></i>
                        <span class="tooltip-text">Connect to SoundCloud for streaming music</span>
                    </button>
                    <button onclick="browseMusicDatabase()" class="dj-button w-full flex items-center justify-between tooltip bg-[#D42F00]">
                        <div><i class="fas fa-database mr-2"></i> Music Database</div>
                        <i class="fas fa-external-link-alt text-xs"></i>
                        <span class="tooltip-text">Browse our extensive online music collection</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="flex-1 flex flex-col bg-[#111]">
            <!-- Top Toolbar -->
            <div class="bg-[#1a1a1a] border-b border-[#333] p-4">
                <div class="flex items-center justify-between">
                    <div class="flex space-x-4">
                        <button onclick="saveMix()" class="dj-button tooltip">
                            <i class="fas fa-save mr-2"></i>Save Mix
                            <span class="tooltip-text">Save the current mix session</span>
                        </button>
                        <button id="loadTrackBtn" onclick="loadTrack()" class="dj-button tooltip">
                            <i class="fas fa-file-audio mr-2"></i>Load Track
                            <span class="tooltip-text">Load an audio track from your device</span>
                        </button>
                        <div class="dropdown relative">
                            <button id="broadcastBtn" onclick="toggleBroadcastSettings()" class="dj-button tooltip">
                                <i class="fas fa-broadcast-tower mr-2"></i>Broadcast Settings
                                <span class="tooltip-text">Configure and start Icecast broadcasting</span>
                            </button>
                            <div id="broadcastSettings" class="dropdown-content">
                                <div class="p-4">
                                    <h3 class="text-white font-medium mb-4">Icecast Broadcast Settings</h3>
                                    <div class="space-y-4">
                                        <div>
                                            <label class="block mb-1 text-sm">Icecast Server URL</label>
                                            <input type="text" id="icecastUrl" placeholder="http://your-server:8000" 
                                                   class="w-full bg-[#333] border border-[#444] rounded px-3 py-2 text-white text-sm focus:outline-none focus:ring-1 focus:ring-[#D42F00] focus:border-[#D42F00] placeholder-gray-500">
                                        </div>
                                        <div>
                                            <label class="block mb-1 text-sm">Mount Point</label>
                                            <input type="text" id="mountPoint" placeholder="/stream" 
                                                   class="w-full bg-[#333] border border-[#444] rounded px-3 py-2 text-white text-sm focus:outline-none focus:ring-1 focus:ring-[#D42F00] focus:border-[#D42F00] placeholder-gray-500">
                                        </div>
                                        <div>
                                            <label class="block mb-1 text-sm">Username</label>
                                            <input type="text" id="icecastUsername" placeholder="source" 
                                                   class="w-full bg-[#333] border border-[#444] rounded px-3 py-2 text-white text-sm focus:outline-none focus:ring-1 focus:ring-[#D42F00] focus:border-[#D42F00] placeholder-gray-500">
                                        </div>
                                        <div>
                                            <label class="block mb-1 text-sm">Password</label>
                                            <input type="password" id="icecastPassword" placeholder="********" 
                                                   class="w-full bg-[#333] border border-[#444] rounded px-3 py-2 text-white text-sm focus:outline-none focus:ring-1 focus:ring-[#D42F00] focus:border-[#D42F00] placeholder-gray-500">
                                        </div>
                                        <div>
                                            <label class="block mb-1 text-sm">Stream Name</label>
                                            <input type="text" id="streamName" placeholder="Kirk Radio DJ Live Mix" 
                                                   class="w-full bg-[#333] border border-[#444] rounded px-3 py-2 text-white text-sm focus:outline-none focus:ring-1 focus:ring-[#D42F00] focus:border-[#D42F00] placeholder-gray-500">
                                        </div>
                                        <div>
                                            <label class="block mb-1 text-sm">Stream Description</label>
                                            <input type="text" id="streamDescription" placeholder="Live DJ set by Kirk Radio DJ" 
                                                   class="w-full bg-[#333] border border-[#444] rounded px-3 py-2 text-white text-sm focus:outline-none focus:ring-1 focus:ring-[#D42F00] focus:border-[#D42F00] placeholder-gray-500">
                                        </div>
                                        <div>
                                            <label class="block mb-1 text-sm">Bitrate</label>
                                            <select id="streamBitrate" class="w-full bg-[#333] border border-[#444] rounded px-3 py-2 text-white text-sm appearance-none">
                                                <option value="64">64 kbps (Low Quality)</option>
                                                <option value="128" selected>128 kbps (Standard)</option>
                                                <option value="192">192 kbps (Good Quality)</option>
                                                <option value="256">256 kbps (High Quality)</option>
                                                <option value="320">320 kbps (Best Quality)</option>
                                            </select>
                                            <div class="relative">
                                                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-white">
                                                    <i class="fas fa-chevron-down"></i>
                                                </div>
                                            </div>
                                        </div>
                                        <div>
                                            <label class="block mb-1 text-sm">Format</label>
                                            <select id="streamFormat" class="w-full bg-[#333] border border-[#444] rounded px-3 py-2 text-white text-sm appearance-none">
                                                <option value="mp3" selected>MP3</option>
                                                <option value="aac">AAC</option>
                                                <option value="ogg">Ogg Vorbis</option>
                                            </select>
                                            <div class="relative">
                                                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-white">
                                                    <i class="fas fa-chevron-down"></i>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="dropdown relative">
                            <button id="settingsBtn" onclick="toggleAppSettings()" class="dj-button tooltip">
                                <i class="fas fa-cog mr-2"></i>Settings
                                <span class="tooltip-text">Configure application settings</span>
                            </button>
                            <div id="appSettings" class="dropdown-content">
                                <div class="p-4">
                                    <h3 class="text-white font-medium mb-4">Application Settings</h3>
                                    <div class="space-y-4">
                                        <div class="section-label">Audio Devices</div>
                                        <div>
                                            <label class="block mb-1 text-sm">Output Device</label>
                                            <select id="audioOutputDevice" class="w-full bg-[#333] border border-[#444] rounded px-3 py-2 text-white text-sm appearance-none">
                                                <option value="default" selected>Default Output Device</option>
                                            </select>
                                            <div class="relative">
                                                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-white">
                                                    <i class="fas fa-chevron-down"></i>
                                                </div>
                                            </div>
                                        </div>
                                        <div>
                                            <label class="block mb-1 text-sm">Microphone Input</label>
                                            <select id="micInputDevice" class="w-full bg-[#333] border border-[#444] rounded px-3 py-2 text-white text-sm appearance-none">
                                                <option value="none">No Microphone</option>
                                                <option value="default" selected>Default Input Device</option>
                                            </select>
                                            <div class="relative">
                                                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-white">
                                                    <i class="fas fa-chevron-down"></i>
                                                </div>
                                            </div>
                                        </div>
                                        <div>
                                            <label class="block mb-1 text-sm">DJ Controller</label>
                                            <select id="djControllerDevice" class="w-full bg-[#333] border border-[#444] rounded px-3 py-2 text-white text-sm appearance-none">
                                                <option value="none" selected>No Controller</option>
                                            </select>
                                            <div class="relative">
                                                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-white">
                                                    <i class="fas fa-chevron-down"></i>
                                                </div>
                                            </div>
                                        </div>
                                        <div>
                                            <button onclick="detectHardware()" class="dj-button w-full mb-3">
                                                <i class="fas fa-search mr-2"></i> Detect Hardware
                                            </button>
                                        </div>
                                        
                                        <div class="section-label">Interface Settings</div>
                                        <div>
                                            <label class="flex items-center mb-2">
                                                <input type="checkbox" id="darkModeToggle" class="mr-2" checked> 
                                                <span>Dark Mode</span>
                                            </label>
                                            <label class="flex items-center mb-2">
                                                <input type="checkbox" id="waveformExpandedToggle" class="mr-2"> 
                                                <span>Show Expanded Waveforms</span>
                                            </label>
                                            <label class="flex items-center mb-2">
                                                <input type="checkbox" id="highQualityVinylToggle" class="mr-2" checked> 
                                                <span>High Quality Vinyl Scratch Effect</span>
                                            </label>
                                            <label class="flex items-center mb-4">
                                                <input type="checkbox" id="performanceModeToggle" class="mr-2"> 
                                                <span>Performance Mode (Reduce Visual Effects)</span>
                                            </label>
                                            
                                            <button onclick="toggleFullscreen()" class="dj-button w-full mb-3">
                                                <i class="fas fa-expand mr-2"></i> Toggle Fullscreen
                                            </button>
                                        </div>
                                        
                                        <div class="section-label">Audio Processing</div>
                                        <div>
                                            <label class="block mb-1 text-sm">Buffer Size</label>
                                            <select id="bufferSize" class="w-full bg-[#333] border border-[#444] rounded px-3 py-2 text-white text-sm mb-3 appearance-none">
                                                <option value="256">256 (Lowest latency)</option>
                                                <option value="512" selected>512 (Balanced)</option>
                                                <option value="1024">1024 (Best stability)</option>
                                                <option value="2048">2048 (Maximum stability)</option>
                                            </select>
                                            <div class="relative">
                                                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-white">
                                                    <i class="fas fa-chevron-down"></i>
                                                </div>
                                            </div>
                                            
                                            <label class="block mb-1 text-sm">Sample Rate</label>
                                            <select id="sampleRate" class="w-full bg-[#333] border border-[#444] rounded px-3 py-2 text-white text-sm appearance-none">
                                                <option value="44100">44.1 kHz (Standard)</option>
                                                <option value="48000" selected>48 kHz (Better Quality)</option>
                                                <option value="96000">96 kHz (High Quality)</option>
                                            </select>
                                            <div class="relative">
                                                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-white">
                                                    <i class="fas fa-chevron-down"></i>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="flex items-center space-x-6">
                        <div class="flex items-center">
                            <span class="control-label mr-2">Master Tempo:</span>
                            <input type="range" min="60" max="200" value="128" class="slider w-32"
                                   oninput="updateMasterTempo(this.value)">
                            <span class="text-white ml-2" id="tempoValue">128 BPM</span>
                        </div>
                        <div class="flex items-center">
                            <i class="fas fa-volume-up text-white mr-2" title="Master Volume"></i>
                            <input type="range" min="0" max="100" value="100" class="slider w-24"
                                   oninput="updateMasterVolume(this.value)" title="Master Volume Control">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Decks -->
            <div class="flex-1 p-6 space-y-6">
                <div class="grid grid-cols-2 gap-6">
                    <!-- Deck 1 -->
                    <div class="deck p-6">
                        <div class="flex justify-between mb-4">
                            <h2 class="text-xl font-medium">Deck 1</h2>
                            <div class="flex space-x-2">
                                <button onclick="toggleSync(0)" class="dj-button tooltip" title="Sync Tempo with Master">
                                    <i class="fas fa-sync"></i>
                                    <span class="tooltip-text">Sync Tempo with Master</span>
                                </button>
                                <button onclick="toggleKeyLock(0)" class="dj-button tooltip" title="Key Lock">
                                    <i class="fas fa-key"></i>
                                    <span class="tooltip-text">Lock Key When Changing Tempo</span>
                                </button>
                                <button onclick="toggleLoop(0)" class="dj-button tooltip" title="Loop Current Section">
                                    <i class="fas fa-redo"></i>
                                    <span class="tooltip-text">Loop Current Section</span>
                                </button>
                            </div>
                        </div>

                        <div class="track-info p-2 mb-4">
                            <div id="deck1Title" class="font-medium truncate">No track loaded</div>
                            <div id="deck1Artist" class="text-sm text-gray-400 truncate">--</div>
                            <div class="flex justify-between items-center mt-2 text-xs text-gray-500">
                                <span id="deck1CurrentTime">00:00</span>
                                <div class="progress-bar flex-1 mx-2">
                                    <div id="deck1Progress" class="progress-bar-fill" style="width: 0%"></div>
                                </div>
                                <span id="deck1TotalTime">00:00</span>
                            </div>
                        </div>

                        <div class="flex gap-6">
                            <div class="flex flex-col items-center">
                                <span class="control-label">Turntable Control</span>
                                <!-- Improved turntable visuals -->
                                <div class="turntable-container relative tooltip">
                                    <div class="turntable-platter"></div>
                                    <div class="platter-rim"></div>
                                    <div class="strobe-marks"></div>
                                    <div class="vinyl" id="vinyl1" onmousedown="startScratch(0, event)" 
                                         onmousemove="scratch(0, event)" onmouseup="stopScratch(0)">
                                        <div class="vinyl-texture"></div>
                                        <div class="vinyl-grooves"></div>
                                        <div class="vinyl-reflection"></div>
                                        <div class="vinyl-label">KIRK RADIO</div>
                                    </div>
                                    <span class="tooltip-text">Click and drag to scratch</span>
                                </div>
                                <div class="transport-controls mt-4">
                                    <button onclick="playDeck(0)" class="transport-button tooltip" id="playBtn1">
                                        <i class="fas fa-play" id="playIcon1"></i>
                                        <span class="tooltip-text">Play/Pause</span>
                                    </button>
                                    <button onclick="cuePoint(0)" class="transport-button tooltip">
                                        <i class="fas fa-flag"></i>
                                        <span class="tooltip-text">Set Cue Point</span>
                                    </button>
                                    <button onclick="skipBackward(0)" class="transport-button tooltip">
                                        <i class="fas fa-backward"></i>
                                        <span class="tooltip-text">Skip Backward</span>
                                    </button>
                                    <button onclick="skipForward(0)" class="transport-button tooltip">
                                        <i class="fas fa-forward"></i>
                                        <span class="tooltip-text">Skip Forward</span>
                                    </button>
                                </div>
                            </div>
                            <div class="flex-1">
                                <div class="mb-4">
                                    <span class="control-label">Waveform</span>
                                    <div class="waveform">
                                        <canvas id="waveform1" class="waveform-data"></canvas>
                                    </div>
                                </div>
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <span class="control-label">Tempo Control</span>
                                        <input type="range" min="60" max="200" value="128" class="slider"
                                               oninput="updateTempo(0, this.value)" title="Adjust track tempo">
                                        <div class="text-center text-sm mt-1" id="deck1Tempo">128 BPM</div>
                                    </div>
                                    <div>
                                        <span class="control-label">Key/Pitch Control</span>
                                        <input type="range" min="-12" max="12" value="0" class="slider"
                                               oninput="updateKey(0, this.value)" title="Adjust track key/pitch">
                                        <div class="text-center text-sm mt-1" id="deck1Key">Original Key</div>
                                    </div>
                                </div>
                                <div class="grid grid-cols-3 gap-4 mt-4">
                                    <div>
                                        <span class="control-label">Low EQ</span>
                                        <div class="eq-knob" id="lowEQ1" data-value="0" onclick="rotateEQ(this, 'low', 0)" title="Low Frequency EQ"></div>
                                    </div>
                                    <div>
                                        <span class="control-label">Mid EQ</span>
                                        <div class="eq-knob" id="midEQ1" data-value="0" onclick="rotateEQ(this, 'mid', 0)" title="Mid Frequency EQ"></div>
                                    </div>
                                    <div>
                                        <span class="control-label">High EQ</span>
                                        <div class="eq-knob" id="highEQ1" data-value="0" onclick="rotateEQ(this, 'high', 0)" title="High Frequency EQ"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Deck 2 (Similar to Deck 1) -->
                    <div class="deck p-6">
                        <div class="flex justify-between mb-4">
                            <h2 class="text-xl font-medium">Deck 2</h2>
                            <div class="flex space-x-2">
                                <button onclick="toggleSync(1)" class="dj-button tooltip" title="Sync Tempo with Master">
                                    <i class="fas fa-sync"></i>
                                    <span class="tooltip-text">Sync Tempo with Master</span>
                                </button>
                                <button onclick="toggleKeyLock(1)" class="dj-button tooltip" title="Key Lock">
                                    <i class="fas fa-key"></i>
                                    <span class="tooltip-text">Lock Key When Changing Tempo</span>
                                </button>
                                <button onclick="toggleLoop(1)" class="dj-button tooltip" title="Loop Current Section">
                                    <i class="fas fa-redo"></i>
                                    <span class="tooltip-text">Loop Current Section</span>
                                </button>
                            </div>
                        </div>

                        <div class="track-info p-2 mb-4">
                            <div id="deck2Title" class="font-medium truncate">No track loaded</div>
                            <div id="deck2Artist" class="text-sm text-gray-400 truncate">--</div>
                            <div class="flex justify-between items-center mt-2 text-xs text-gray-500">
                                <span id="deck2CurrentTime">00:00</span>
                                <div class="progress-bar flex-1 mx-2">
                                    <div id="deck2Progress" class="progress-bar-fill" style="width: 0%"></div>
                                </div>
                                <span id="deck2TotalTime">00:00</span>
                            </div>
                        </div>

                        <div class="flex gap-6">
                            <div class="flex flex-col items-center">
                                <span class="control-label">Turntable Control</span>
                                <!-- Improved turntable visuals -->
                                <div class="turntable-container relative tooltip">
                                    <div class="turntable-platter"></div>
                                    <div class="platter-rim"></div>
                                    <div class="strobe-marks"></div>
                                    <div class="vinyl" id="vinyl2" onmousedown="startScratch(1, event)" 
                                         onmousemove="scratch(1, event)" onmouseup="stopScratch(1)">
                                        <div class="vinyl-texture"></div>
                                        <div class="vinyl-grooves"></div>
                                        <div class="vinyl-reflection"></div>
                                        <div class="vinyl-label">KIRK RADIO</div>
                                    </div>
                                    <span class="tooltip-text">Click and drag to scratch</span>
                                </div>
                                <div class="transport-controls mt-4">
                                    <button onclick="playDeck(1)" class="transport-button tooltip" id="playBtn2">
                                        <i class="fas fa-play" id="playIcon2"></i>
                                        <span class="tooltip-text">Play/Pause</span>
                                    </button>
                                    <button onclick="cuePoint(1)" class="transport-button tooltip">
                                        <i class="fas fa-flag"></i>
                                        <span class="tooltip-text">Set Cue Point</span>
                                    </button>
                                    <button onclick="skipBackward(1)" class="transport-button tooltip">
                                        <i class="fas fa-backward"></i>
                                        <span class="tooltip-text">Skip Backward</span>
                                    </button>
                                    <button onclick="skipForward(1)" class="transport-button tooltip">
                                        <i class="fas fa-forward"></i>
                                        <span class="tooltip-text">Skip Forward</span>
                                    </button>
                                </div>
                            </div>
                            <div class="flex-1">
                                <div class="mb-4">
                                    <span class="control-label">Waveform</span>
                                    <div class="waveform">
                                        <canvas id="waveform2" class="waveform-data"></canvas>
                                    </div>
                                </div>
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <span class="control-label">Tempo Control</span>
                                        <input type="range" min="60" max="200" value="128" class="slider"
                                               oninput="updateTempo(1, this.value)" title="Adjust track tempo">
                                        <div class="text-center text-sm mt-1" id="deck2Tempo">128 BPM</div>
                                    </div>
                                    <div>
                                        <span class="control-label">Key/Pitch Control</span>
                                        <input type="range" min="-12" max="12" value="0" class="slider"
                                               oninput="updateKey(1, this.value)" title="Adjust track key/pitch">
                                        <div class="text-center text-sm mt-1" id="deck2Key">Original Key</div>
                                    </div>
                                </div>
                                <div class="grid grid-cols-3 gap-4 mt-4">
                                    <div>
                                        <span class="control-label">Low EQ</span>
                                        <div class="eq-knob" id="lowEQ2" data-value="0" onclick="rotateEQ(this, 'low', 1)" title="Low Frequency EQ"></div>
                                    </div>
                                    <div>
                                        <span class="control-label">Mid EQ</span>
                                        <div class="eq-knob" id="midEQ2" data-value="0" onclick="rotateEQ(this, 'mid', 1)" title="Mid Frequency EQ"></div>
                                    </div>
                                    <div>
                                        <span class="control-label">High EQ</span>
                                        <div class="eq-knob" id="highEQ2" data-value="0" onclick="rotateEQ(this, 'high', 1)" title="High Frequency EQ"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Mixer Controls -->
                <div class="flex justify-center items-center space-x-8 bg-[#1a1a1a] p-6 rounded-lg">
                    <div>
                        <span class="control-label text-center">Deck 1 Volume</span>
                        <input type="range" min="0" max="100" value="100" class="vertical-slider"
                               oninput="updateVolume(0, this.value)" title="Deck 1 Volume Control">
                        <div class="text-center text-xs mt-2" id="volume1Value">100%</div>
                    </div>
                    <div class="flex-1">
                        <span class="control-label">Crossfader</span>
                        <div class="flex items-center">
                            <span class="text-xs mr-2">Deck 1</span>
                            <input type="range" min="0" max="100" value="50" class="slider w-full"
                                   oninput="updateCrossfader(this.value)" title="Mix between Deck 1 and Deck 2">
                            <span class="text-xs ml-2">Deck 2</span>
                        </div>
                        <div class="text-center text-xs mt-2" id="crossfaderValue">Center</div>
                    </div>
                    <div>
                        <span class="control-label text-center">Deck 2 Volume</span>
                        <input type="range" min="0" max="100" value="100" class="vertical-slider"
                               oninput="updateVolume(1, this.value)" title="Deck 2 Volume Control">
                        <div class="text-center text-xs mt-2" id="volume2Value">100%</div>
                    </div>
                </div>

                <!-- FX Section -->
                <div class="bg-[#1a1a1a] p-6 rounded-lg">
                    <div class="section-label">Effects Panel</div>
                    <div class="grid grid-cols-2 gap-6">
                        <div>
                            <span class="control-label">Deck 1 Effects</span>
                            <div class="grid grid-cols-4 gap-2">
                                <div class="fx-button tooltip" onclick="toggleEffect(0, 'reverb')">
                                    Reverb
                                    <span class="tooltip-text">Apply reverb effect to Deck 1</span>
                                </div>
                                <div class="fx-button tooltip" onclick="toggleEffect(0, 'delay')">
                                    Delay
                                    <span class="tooltip-text">Apply delay effect to Deck 1</span>
                                </div>
                                <div class="fx-button tooltip" onclick="toggleEffect(0, 'flanger')">
                                    Flanger
                                    <span class="tooltip-text">Apply flanger effect to Deck 1</span>
                                </div>
                                <div class="fx-button tooltip" onclick="toggleEffect(0, 'filter')">
                                    Filter
                                    <span class="tooltip-text">Apply filter effect to Deck 1</span>
                                </div>
                            </div>
                            <div class="mt-4">
                                <span class="control-label">Effect Mix</span>
                                <input type="range" min="0" max="100" value="50" class="slider"
                                       oninput="updateEffectMix(0, this.value)" title="Adjust effect mix level">
                            </div>
                        </div>
                        <div>
                            <span class="control-label">Deck 2 Effects</span>
                            <div class="grid grid-cols-4 gap-2">
                                <div class="fx-button tooltip" onclick="toggleEffect(1, 'reverb')">
                                    Reverb
                                    <span class="tooltip-text">Apply reverb effect to Deck 2</span>
                                </div>
                                <div class="fx-button tooltip" onclick="toggleEffect(1, 'delay')">
                                    Delay
                                    <span class="tooltip-text">Apply delay effect to Deck 2</span>
                                </div>
                                <div class="fx-button tooltip" onclick="toggleEffect(1, 'flanger')">
                                    Flanger
                                    <span class="tooltip-text">Apply flanger effect to Deck 2</span>
                                </div>
                                <div class="fx-button tooltip" onclick="toggleEffect(1, 'filter')">
                                    Filter
                                    <span class="tooltip-text">Apply filter effect to Deck 2</span>
                                </div>
                            </div>
                            <div class="mt-4">
                                <span class="control-label">Effect Mix</span>
                                <input type="range" min="0" max="100" value="50" class="slider"
                                       oninput="updateEffectMix(1, this.value)" title="Adjust effect mix level">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Broadcast Status -->
                <div class="bg-[#1a1a1a] p-4 rounded-lg" id="broadcastStatus">
                    <div class="section-label">Broadcast Status</div>
                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            <div class="w-3 h-3 rounded-full bg-red-500 mr-2" id="broadcastStatusIndicator"></div>
                            <span id="broadcastStatusText">Not broadcasting</span>
                        </div>
                        <div>
                            <button id="startStopBroadcastBtn" onclick="toggleBroadcast()" class="dj-button">
                                <i class="fas fa-play-circle mr-2"></i> Start Broadcasting
                            </button>
                        </div>
                    </div>
                    <div class="text-xs text-gray-500 mt-2" id="broadcastStats">
                        Configure your Icecast settings using the Broadcast Settings button in the toolbar.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="alertModal" class="modal">
        <div class="modal-content">
            <h3 class="text-xl font-medium mb-4" id="modalTitle">Alert</h3>
            <p id="modalMessage" class="mb-4">Message content will appear here.</p>
            <div class="flex justify-end">
                <button onclick="closeModal('alertModal')" class="dj-button">Close</button>
            </div>
        </div>
    </div>

    <script>
        // Audio Context and Processor
        let audioContext;
        let masterGain;
        const decks = [{}, {}];
        let scratching = [false, false];
        let lastY = [0, 0];
        let broadcasting = false;

        class AudioProcessor {
            constructor(context, masterNode) {
                this.context = context;
                this.masterNode = masterNode;
                this.source = null;
                this.gainNode = context.createGain();
                this.lowEQ = context.createBiquadFilter();
                this.midEQ = context.createBiquadFilter();
                this.highEQ = context.createBiquadFilter();
                
                // Set up filter types
                this.lowEQ.type = 'lowshelf';
                this.lowEQ.frequency.value = 320;
                this.lowEQ.gain.value = 0;
                
                this.midEQ.type = 'peaking';
                this.midEQ.frequency.value = 1000;
                this.midEQ.Q.value = 1;
                this.midEQ.gain.value = 0;
                
                this.highEQ.type = 'highshelf';
                this.highEQ.frequency.value = 3200;
                this.highEQ.gain.value = 0;
                
                // Connect the nodes
                this.gainNode.connect(this.lowEQ);
                this.lowEQ.connect(this.midEQ);
                this.midEQ.connect(this.highEQ);
                this.highEQ.connect(this.masterNode);
                
                // Initialize properties
                this.playing = false;
                this.looping = false;
                this.buffer = null;
                this.deckIndex = 0;
                this.trackTitle = "No track loaded";
                this.trackArtist = "--";
                this.duration = 0;
                this.offset = 0;
                this.startTime = 0;
            }
            
            loadBuffer(buffer, title = "Untitled Track", artist = "Unknown Artist") {
                this.buffer = buffer;
                this.duration = buffer.duration;
                this.trackTitle = title;
                this.trackArtist = artist;
                this.offset = 0;
                
                // Draw waveform
                this.drawWaveform();
                
                // Update the track info display
                this.updateTrackInfo();
                
                // Update the progress display
                this.updateProgressDisplay();
            }
            
            play() {
                if (!this.buffer) return;
                
                if (this.playing) {
                    this.pause();
                    return;
                }
                
                // Create a new source node
                this.source = this.context.createBufferSource();
                this.source.buffer = this.buffer;
                this.source.loop = this.looping;
                this.source.connect(this.gainNode);
                
                // If we have an offset set, start from there
                this.source.start(0, this.offset);
                this.startTime = this.context.currentTime - this.offset;
                this.playing = true;
                
                // Update UI
                const playIcon = document.getElementById(`playIcon${this.deckIndex + 1}`);
                if (playIcon) {
                    playIcon.className = "fas fa-pause";
                }
                
                const vinyl = document.getElementById(`vinyl${this.deckIndex + 1}`);
                if (vinyl) {
                    vinyl.classList.add('playing');
                }
                
                // Start updating progress
                this.startProgressUpdate();
            }
            
            pause() {
                if (!this.playing || !this.source) return;
                
                // Stop the source and update offset
                this.source.stop(0);
                this.offset = this.context.currentTime - this.startTime;
                if (this.offset > this.duration) {
                    this.offset = 0;
                }
                
                this.playing = false;
                
                // Update UI
                const playIcon = document.getElementById(`playIcon${this.deckIndex + 1}`);
                if (playIcon) {
                    playIcon.className = "fas fa-play";
                }
                
                const vinyl = document.getElementById(`vinyl${this.deckIndex + 1}`);
                if (vinyl) {
                    vinyl.classList.remove('playing');
                }
            }
            
            startProgressUpdate() {
                if (!this.playing) return;
                
                requestAnimationFrame(() => this.updateProgressDisplay());
            }
            
            updateProgressDisplay() {
                if (!this.buffer) return;
                
                let currentTime;
                if (this.playing) {
                    currentTime = this.context.currentTime - this.startTime;
                    if (currentTime > this.duration) {
                        if (this.looping) {
                            this.startTime = this.context.currentTime - (currentTime % this.duration);
                            currentTime = this.context.currentTime - this.startTime;
                        } else {
                            this.pause();
                            currentTime = this.duration;
                        }
                    }
                } else {
                    currentTime = this.offset;
                }
                
                // Update progress bar
                const progressElement = document.getElementById(`deck${this.deckIndex + 1}Progress`);
                if (progressElement) {
                    const progressPercentage = (currentTime / this.duration) * 100;
                    progressElement.style.width = `${progressPercentage}%`;
                }
                
                // Update current time display
                const currentTimeElement = document.getElementById(`deck${this.deckIndex + 1}CurrentTime`);
                if (currentTimeElement) {
                    currentTimeElement.textContent = formatTime(currentTime);
                }
                
                if (this.playing) {
                    requestAnimationFrame(() => this.updateProgressDisplay());
                }
            }
            
            setCuePoint() {
                if (!this.buffer) return;
                
                if (this.playing) {
                    this.offset = this.context.currentTime - this.startTime;
                    if (this.offset > this.duration) {
                        this.offset = 0;
                    }
                } else {
                    // If not playing, just use the current offset
                    // This will be where playback starts next time
                    this.updateProgressDisplay();
                }
                
                // Show visual feedback
                const cueBtn = document.querySelector(`button[onclick="cuePoint(${this.deckIndex})"]`);
                if (cueBtn) {
                    cueBtn.classList.add('active');
                    setTimeout(() => cueBtn.classList.remove('active'), 200);
                }
                
                // Update time display
                const currentTimeElement = document.getElementById(`deck${this.deckIndex + 1}CurrentTime`);
                if (currentTimeElement) {
                    currentTimeElement.textContent = formatTime(this.offset);
                }
            }
            
            setPlaybackRate(rate) {
                if (this.source) {
                    this.source.playbackRate.value = rate;
                }
            }
            
            setVolume(value) {
                this.gainNode.gain.value = value;
                // Update volume display
                const volumeValueElement = document.getElementById(`volume${this.deckIndex + 1}Value`);
                if (volumeValueElement) {
                    volumeValueElement.textContent = `${Math.round(value * 100)}%`;
                }
            }
            
            setEQ(type, value) {
                // Convert from percentage (-100 to 100) to dB (-12 to 12)
                const dbValue = (value / 100) * 12;
                
                switch(type) {
                    case 'low':
                        this.lowEQ.gain.value = dbValue;
                        break;
                    case 'mid':
                        this.midEQ.gain.value = dbValue;
                        break;
                    case 'high':
                        this.highEQ.gain.value = dbValue;
                        break;
                }
            }
            
            applyScratchEffect(delta) {
                const direction = delta > 0 ? 1 : -1;
                const speed = Math.min(Math.abs(delta) * 0.01, 4);
                this.setPlaybackRate(direction * speed);
                
                // Enhanced scratch sound effect
                // Apply frequency shaping for more realistic vinyl scratch
                this.lowEQ.gain.value = -3; // Reduce bass slightly during scratch
                this.highEQ.gain.value = direction > 0 ? 4 : -6; // Dynamic high frequency response
            }
            
            toggleLoop() {
                this.looping = !this.looping;
                if (this.source) {
                    this.source.loop = this.looping;
                }
                return this.looping;
            }
            
            updateTrackInfo() {
                const titleElement = document.getElementById(`deck${this.deckIndex + 1}Title`);
                const artistElement = document.getElementById(`deck${this.deckIndex + 1}Artist`);
                const totalTimeElement = document.getElementById(`deck${this.deckIndex + 1}TotalTime`);
                
                if (titleElement) titleElement.textContent = this.trackTitle;
                if (artistElement) artistElement.textContent = this.trackArtist;
                if (totalTimeElement) totalTimeElement.textContent = formatTime(this.duration);
            }
            
            drawWaveform() {
                const canvas = document.getElementById(`waveform${this.deckIndex + 1}`);
                if (!canvas) return;
                
                const ctx = canvas.getContext('2d');
                const data = this.buffer.getChannelData(0);
                const width = canvas.width;
                const height = canvas.height;
                
                // Set canvas dimensions if needed
                if (canvas.width !== canvas.offsetWidth) {
                    canvas.width = canvas.offsetWidth;
                    canvas.height = canvas.offsetHeight;
                }
                
                ctx.clearRect(0, 0, width, height);
                ctx.lineWidth = 1;
                ctx.strokeStyle = '#D46400';
                ctx.beginPath();
                
                // Draw the waveform
                const step = Math.ceil(data.length / width);
                for (let i = 0; i < width; i++) {
                    let min = 1.0;
                    let max = -1.0;
                    
                    // Get min and max values for this segment
                    for (let j = 0; j < step; j++) {
                        const datum = data[(i * step) + j];
                        if (datum < min) min = datum;
                        if (datum > max) max = datum;
                    }
                    
                    // Draw the line
                    const y1 = (1 + min) * height / 2;
                    const y2 = (1 + max) * height / 2;
                    ctx.moveTo(i, y1);
                    ctx.lineTo(i, y2);
                }
                
                ctx.stroke();
            }
            
            skipForward() {
                if (!this.buffer) return;
                
                this.offset = Math.min(this.offset + 10, this.buffer.duration);
                if (this.playing) {
                    this.pause();
                    this.play();
                } else {
                    this.updateProgressDisplay();
                }
            }
            
            skipBackward() {
                if (!this.buffer) return;
                
                this.offset = Math.max(this.offset - 10, 0);
                if (this.playing) {
                    this.pause();
                    this.play();
                } else {
                    this.updateProgressDisplay();
                }
            }
        }
        
        // Initialize audio context on user interaction
        document.addEventListener('click', () => {
            if (!audioContext) {
                try {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    masterGain = audioContext.createGain();
                    masterGain.connect(audioContext.destination);
                    
                    // Initialize deck processors
                    decks[0].processor = new AudioProcessor(audioContext, masterGain);
                    decks[1].processor = new AudioProcessor(audioContext, masterGain);
                    decks[0].processor.deckIndex = 0;
                    decks[1].processor.deckIndex = 1;
                    
                    // Initialize canvas for waveforms
                    initializeCanvases();
                } catch (error) {
                    console.error('Failed to initialize audio context:', error);
                    showAlert('Error', 'Failed to initialize audio. Please check your browser settings.');
                }
            }
        });
        
        function initializeCanvases() {
            const canvas1 = document.getElementById('waveform1');
            const canvas2 = document.getElementById('waveform2');
            
            if (canvas1) {
                canvas1.width = canvas1.offsetWidth;
                canvas1.height = canvas1.offsetHeight;
            }
            
            if (canvas2) {
                canvas2.width = canvas2.offsetWidth;
                canvas2.height = canvas2.offsetHeight;
            }
        }
        
        // Utility function to format time in MM:SS
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }
        
        // Helper function to get current rotation of an element
        function getRotation(el) {
            const style = window.getComputedStyle(el);
            const matrix = new DOMMatrix(style.transform);
            const angle = Math.atan2(matrix.b, matrix.a) * (180 / Math.PI);
            return angle;
        }
        
        // Vinyl control functions - IMPROVED SCRATCHING
        function startScratch(deckIndex, event) {
            scratching[deckIndex] = true;
            lastY[deckIndex] = event.clientY;
            event.preventDefault();
            
            const vinyl = document.getElementById(`vinyl${deckIndex + 1}`);
            vinyl.classList.add('scratching');
            vinyl.style.cursor = 'grabbing';
            
            // Add visual animation effect - more responsive
            vinyl.style.transform = 'scale(1.02)';
            setTimeout(() => {
                if (scratching[deckIndex]) {
                    vinyl.style.transform = '';
                }
            }, 150);
        }
        
        function scratch(deckIndex, event) {
            if (!scratching[deckIndex]) return;
            
            const delta = event.clientY - lastY[deckIndex];
            if (decks[deckIndex].processor) {
                decks[deckIndex].processor.applyScratchEffect(delta);
            }
            
            // Enhanced visual scratch effects
            const vinyl = document.getElementById(`vinyl${deckIndex + 1}`);
            const speed = Math.abs(delta);
            
            // Dynamic rotation based on scratch movement
            const currentRotation = getRotation(vinyl) || 0;
            vinyl.style.transform = `rotate(${currentRotation + delta}deg)`;
            
            // Enhanced visual effects based on scratch speed
            if (document.getElementById('highQualityVinylToggle')?.checked) {
                if (speed > 10) {
                    vinyl.style.boxShadow = '0 4px 25px rgba(212,47,0,0.3)';
                } else if (speed > 5) {
                    vinyl.style.boxShadow = '0 4px 20px rgba(0,0,0,0.6)';
                } else {
                    vinyl.style.boxShadow = '0 4px 20px rgba(0,0,0,0.5)';
                }
            }
            
            lastY[deckIndex] = event.clientY;
            event.preventDefault();
        }
        
        function stopScratch(deckIndex) {
            if (!scratching[deckIndex]) return;
            
            scratching[deckIndex] = false;
            if (decks[deckIndex].processor) {
                decks[deckIndex].processor.setPlaybackRate(1);
                // Reset EQ
                decks[deckIndex].processor.lowEQ.gain.value = 0;
                decks[deckIndex].processor.highEQ.gain.value = 0;
            }
            
            const vinyl = document.getElementById(`vinyl${deckIndex + 1}`);
            vinyl.classList.remove('scratching');
            vinyl.style.cursor = 'grab';
            vinyl.style.boxShadow = '0 4px 20px rgba(0,0,0,0.5)';
            
            // Smooth bounce-back effect
            vinyl.style.transition = 'transform 0.3s ease-out';
            vinyl.style.transform = 'rotate(0deg)';
            setTimeout(() => {
                vinyl.style.transition = 'transform 0.05s linear';
            }, 300);
        }
        
        // Fullscreen toggle function
        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                // Enter fullscreen
                if (document.documentElement.requestFullscreen) {
                    document.documentElement.requestFullscreen();
                } else if (document.documentElement.webkitRequestFullscreen) { /* Safari */
                    document.documentElement.webkitRequestFullscreen();
                } else if (document.documentElement.msRequestFullscreen) { /* IE11 */
                    document.documentElement.msRequestFullscreen();
                }
                
                // Change button text
                const fullscreenBtn = document.querySelector('button[onclick="toggleFullscreen()"]');
                if (fullscreenBtn) {
                    fullscreenBtn.innerHTML = '<i class="fas fa-compress mr-2"></i> Exit Fullscreen';
                }
                
                showAlert("Fullscreen Mode", "Entering fullscreen mode. Press ESC or click the button again to exit.");
            } else {
                // Exit fullscreen
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.webkitExitFullscreen) { /* Safari */
                    document.webkitExitFullscreen();
                } else if (document.msExitFullscreen) { /* IE11 */
                    document.msExitFullscreen();
                }
                
                // Change button text back
                const fullscreenBtn = document.querySelector('button[onclick="toggleFullscreen()"]');
                if (fullscreenBtn) {
                    fullscreenBtn.innerHTML = '<i class="fas fa-expand mr-2"></i> Toggle Fullscreen';
                }
            }
        }
        
        // Detect hardware function for audio interface and controllers
        function detectHardware() {
            showAlert("Detecting Hardware", "Scanning for audio interfaces and DJ controllers...");
            
            // This would normally use Web MIDI API or Web Audio API to detect hardware
            // For demonstration, we'll simulate finding devices after a delay
            setTimeout(() => {
                // Update audio device dropdown
                const audioOutputDevice = document.getElementById('audioOutputDevice');
                if (audioOutputDevice) {
                    audioOutputDevice.innerHTML = `
                        <option value="default" selected>Default Output</option>
                        <option value="interface1">External Audio Interface</option>
                        <option value="hdmi">HDMI Audio Output</option>
                        <option value="bluetooth">Bluetooth Speakers</option>
                        <option value="usb_headphones">USB Headphones</option>
                    `;
                }
                
                // Update microphone dropdown
                const micInputDevice = document.getElementById('micInputDevice');
                if (micInputDevice) {
                    micInputDevice.innerHTML = `
                        <option value="none">No Microphone</option>
                        <option value="default" selected>Built-in Microphone</option>
                        <option value="usb">USB Microphone</option>
                        <option value="xlr">XLR Microphone (via Interface)</option>
                        <option value="bluetooth_mic">Bluetooth Headset Mic</option>
                    `;
                }
                
                // Update controller dropdown
                const djControllerDevice = document.getElementById('djControllerDevice');
                if (djControllerDevice) {
                    djControllerDevice.innerHTML = `
                        <option value="none">No Controller</option>
                        <option value="pioneer" selected>Pioneer DDJ-400 (Connected)</option>
                        <option value="numark">Numark Controller</option>
                        <option value="traktor">Traktor Controller</option>
                        <option value="denon">Denon DJ Controller</option>
                    `;
                }
                
                showAlert("Hardware Detected", "Found 1 audio interface and 1 DJ controller. Settings have been updated.");
            }, 1500);
        }
        
        // Control functions
        function updateMasterTempo(value) {
            document.getElementById('tempoValue').textContent = `${value} BPM`;
            
            // Update deck tempos if sync is enabled
            const syncModeEnabled = document.getElementById('syncModeToggle').checked;
            if (syncModeEnabled) {
                // Update both decks to match master tempo
                for (let i = 0; i < 2; i++) {
                    if (decks[i].processor) {
                        decks[i].processor.setPlaybackRate(value / 128);
                        document.getElementById(`deck${i+1}Tempo`).textContent = `${value} BPM`;
                    }
                }
            }
        }
        
        function updateMasterVolume(value) {
            if (masterGain) {
                masterGain.gain.value = value / 100;
            }
        }
        
        function updateTempo(deckIndex, value) {
            if (decks[deckIndex].processor) {
                decks[deckIndex].processor.setPlaybackRate(value / 128);
                document.getElementById(`deck${deckIndex+1}Tempo`).textContent = `${value} BPM`;
            }
        }
        
        function updateKey(deckIndex, value) {
            // Placeholder for key/pitch shifting
            // In a real implementation, this would change the pitch without affecting tempo
            const keyNames = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];
            const semitones = parseInt(value);
            
            let keyText;
            if (semitones === 0) {
                keyText = 'Original Key';
            } else {
                const direction = semitones > 0 ? '+' : '';
                keyText = `${direction}${semitones} semitones`;
            }
            
            document.getElementById(`deck${deckIndex+1}Key`).textContent = keyText;
        }
        
        function updateVolume(deckIndex, value) {
            if (decks[deckIndex].processor) {
                decks[deckIndex].processor.setVolume(value / 100);
            }
        }
        
        function updateCrossfader(value) {
            const normalizedValue = parseInt(value);
            let leftGain, rightGain;
            
            // Implement non-linear crossfader curve for better mixing
            if (normalizedValue <= 50) {
                leftGain = 1;
                rightGain = Math.sin((normalizedValue / 50) * Math.PI/2);
            } else {
                leftGain = Math.sin(((100 - normalizedValue) / 50) * Math.PI/2);
                rightGain = 1;
            }
            
            if (decks[0].processor) decks[0].processor.setVolume(leftGain);
            if (decks[1].processor) decks[1].processor.setVolume(rightGain);
            
            // Update display
            let crossfaderText = "";
            if (normalizedValue < 25) {
                crossfaderText = "Deck 1";
            } else if (normalizedValue > 75) {
                crossfaderText = "Deck 2";
            } else if (normalizedValue === 50) {
                crossfaderText = "Center";
            } else {
                crossfaderText = normalizedValue < 50 ? "Mixing (Deck 1)" : "Mixing (Deck 2)";
            }
            document.getElementById('crossfaderValue').textContent = crossfaderText;
        }
        
        // Button toggle functions
        function toggleSync(deckIndex) {
            const button = event.currentTarget;
            button.classList.toggle('active');
            
            // Apply master tempo to this deck
            if (button.classList.contains('active')) {
                const masterTempo = document.getElementById('tempoValue').textContent;
                const tempoValue = parseInt(masterTempo);
                updateTempo(deckIndex, tempoValue);
            }
        }
        
        function toggleKeyLock(deckIndex) {
            const button = event.currentTarget;
            button.classList.toggle('active');
            // Key lock functionality would maintain the pitch when tempo is changed
        }
        
        function toggleLoop(deckIndex) {
            if (!decks[deckIndex].processor) return;
            
            const button = event.currentTarget;
            const looping = decks[deckIndex].processor.toggleLoop();
            button.classList.toggle('active', looping);
        }
        
        // Deck playback control
        function playDeck(deckIndex) {
            if (!decks[deckIndex].processor) return;
            decks[deckIndex].processor.play();
        }
        
        function cuePoint(deckIndex) {
            if (!decks[deckIndex].processor) return;
            decks[deckIndex].processor.setCuePoint();
        }
        
        function skipBackward(deckIndex) {
            if (!decks[deckIndex].processor) return;
            decks[deckIndex].processor.skipBackward();
        }
        
        function skipForward(deckIndex) {
            if (!decks[deckIndex].processor) return;
            decks[deckIndex].processor.skipForward();
        }
        
        // Enhanced 3D EQ Control
        function rotateEQ(element, type, deckIndex) {
            // Get current value and calculate new one with finer control
            const currentValue = parseInt(element.getAttribute('data-value') || 0);
            let newValue;
            
            // Improve progression with 5 steps instead of 3
            if (currentValue <= -75) newValue = -50;
            else if (currentValue <= -25) newValue = 0;
            else if (currentValue < 25) newValue = 50;
            else if (currentValue < 75) newValue = 100;
            else newValue = -100;
            
            // Update data attribute
            element.setAttribute('data-value', newValue);
            
            // Enhanced visual rotation with 3D perspective
            // The pointer line inside the knob rotates
            const rotationDegrees = (newValue * 1.8); // 180 degrees max rotation
            element.querySelector('::after').style.transform = `translate(-50%, -50%) rotate(${rotationDegrees}deg)`;
            
            // Apply 3D tilt effect based on rotation
            const xTilt = Math.sin(rotationDegrees * Math.PI / 180) * 5;
            const yTilt = Math.cos(rotationDegrees * Math.PI / 180) * 5;
            element.style.transform = `perspective(500px) rotateX(${25 + xTilt}deg) rotateY(${yTilt}deg)`;
            
            // Visual feedback - active class temporarily 
            element.classList.add('active');
            setTimeout(() => {
                element.classList.remove('active');
            }, 200);
            
            // Apply EQ to the audio
            if (decks[deckIndex].processor) {
                decks[deckIndex].processor.setEQ(type, newValue);
            }
            
            // Update display value if it exists
            const valueDisplay = document.getElementById(`${type}EQValue${deckIndex + 1}`);
            if (valueDisplay) {
                valueDisplay.textContent = newValue > 0 ? `+${newValue}%` : `${newValue}%`;
            }
        }
        
        // FX Functions
        function toggleEffect(deckIndex, effectType) {
            // Placeholder for effect toggle
            // In a real app, this would enable audio effects like reverb, delay, etc.
            const button = event.currentTarget;
            button.classList.toggle('active');
            
            if (button.classList.contains('active')) {
                showAlert(`Effect Enabled`, `${effectType.charAt(0).toUpperCase() + effectType.slice(1)} effect enabled on Deck ${deckIndex + 1}`);
            }
        }
        
        function updateEffectMix(deckIndex, value) {
            // Placeholder for effect mix level
            // In a real app, this would adjust the wet/dry mix of active effects
        }
        
        // Broadcast functions
        function toggleBroadcastSettings() {
            const dropdown = document.getElementById('broadcastSettings');
            const button = document.getElementById('broadcastBtn');
            
            if (dropdown.style.display === 'block') {
                dropdown.style.display = 'none';
                button.classList.remove('active');
            } else {
                dropdown.style.display = 'block';
                button.classList.add('active');
            }
        }
        
        function toggleAppSettings() {
            const dropdown = document.getElementById('appSettings');
            const button = document.getElementById('settingsBtn');
            
            if (dropdown.style.display === 'block') {
                dropdown.style.display = 'none';
                button.classList.remove('active');
            } else {
                dropdown.style.display = 'block';
                button.classList.add('active');
            }
        }
        
        function toggleBroadcast() {
            broadcasting = !broadcasting;
            updateBroadcastStatus();
            
            if (broadcasting) {
                showAlert("Broadcasting Started", "Your mix is now being broadcast to your configured Icecast server.");
            } else {
                showAlert("Broadcasting Stopped", "Your broadcast has been ended.");
            }
        }
        
        function updateBroadcastStatus() {
            const indicator = document.getElementById('broadcastStatusIndicator');
            const text = document.getElementById('broadcastStatusText');
            const button = document.getElementById('startStopBroadcastBtn');
            const stats = document.getElementById('broadcastStats');
            
            if (broadcasting) {
                indicator.classList.remove('bg-red-500');
                indicator.classList.add('bg-green-500');
                text.textContent = "Broadcasting";
                button.innerHTML = '<i class="fas fa-stop-circle mr-2"></i> Stop Broadcasting';
                stats.textContent = "Streaming at 128 kbps MP3 format. 12 listeners currently connected.";
            } else {
                indicator.classList.remove('bg-green-500');
                indicator.classList.add('bg-red-500');
                text.textContent = "Not broadcasting";
                button.innerHTML = '<i class="fas fa-play-circle mr-2"></i> Start Broadcasting';
                stats.textContent = "Configure your Icecast settings using the Broadcast Settings button in the toolbar.";
            }
        }
        
        // Library management functions
        function loadTrack() {
            if (!audioContext) {
                try {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    masterGain = audioContext.createGain();
                    masterGain.connect(audioContext.destination);
                    
                    decks[0].processor = new AudioProcessor(audioContext, masterGain);
                    decks[1].processor = new AudioProcessor(audioContext, masterGain);
                    decks[0].processor.deckIndex = 0;
                    decks[1].processor.deckIndex = 1;
                    
                    initializeCanvases();
                } catch (error) {
                    console.error('Failed to initialize audio context:', error);
                    showAlert('Error', 'Failed to initialize audio. Please check your browser settings.');
                    return;
                }
            }
            
            // Simulate loading audio
            // In a real app, this would open a file dialog
            showAlert("Load Track", "In a real application, this would open a file dialog to select audio files. For this demo, we'll load a simulated track.");
            
            // Generate a simulated audio buffer
            const sampleRate = audioContext.sampleRate;
            const duration = 180; // 3 minutes
            const frameCount = sampleRate * duration;
            
            const audioBuffer = audioContext.createBuffer(2, frameCount, sampleRate);
            
            // Generate simple test tone with decay
            for (let channel = 0; channel < 2; channel++) {
                const channelData = audioBuffer.getChannelData(channel);
                
                for (let i = 0; i < frameCount; i++) {
                    // Test tone with multiple frequencies to make it more interesting
                    const t = i / sampleRate;
                    
                    // Add some rhythm
                    const beat = Math.sin(2 * Math.PI * 2 * (t % 0.5) / 0.5) * 0.3;
                    
                    // Add some bass notes
                    const bass = Math.sin(2 * Math.PI * 80 * t) * 0.4 * (Math.sin(2 * Math.PI * 0.5 * t) * 0.5 + 0.5);
                    
                    // Add some mid notes
                    const mid = Math.sin(2 * Math.PI * 320 * t) * 0.2 * (Math.sin(2 * Math.PI * 0.25 * t + 0.2) * 0.5 + 0.5);
                    
                    // Add some high notes
                    const high = Math.sin(2 * Math.PI * 1200 * t) * 0.1 * (Math.sin(2 * Math.PI * 2 * t + 0.5) * 0.5 + 0.5);
                    
                    // Combined waveform
                    const sample = (beat + bass + mid + high) / 2;
                    
                    // Apply overall volume envelope
                    const envelope = Math.min(1, 10 * (1 - i / frameCount) + 0.1);
                    
                    channelData[i] = sample * envelope;
                }
            }
            
            // Create random deck assignment
            const deckIndex = Math.floor(Math.random() * 2);
            const titles = [
                "Summer Vibes", "Midnight Run", "Electric Dreams", "Urban Rhythm", 
                "Chill Out Zone", "Club Anthems", "Retro Wave", "Bass Drop"
            ];
            const artists = [
                "DJ Sunshine", "Beat Masters", "Synth Wave", "City Beats", 
                "Ambient Sounds", "Party DJs", "80s Revival", "Dubstep Kings"
            ];
            
            const title = titles[Math.floor(Math.random() * titles.length)];
            const artist = artists[Math.floor(Math.random() * artists.length)];
            
            // Load buffer to processor
            decks[deckIndex].processor.loadBuffer(audioBuffer, title, artist);
            
            showAlert("Track Loaded", `"${title}" by ${artist} loaded to Deck ${deckIndex + 1}. Press play to start.`);
        }
        
        function saveMix() {
            showAlert("Save Mix", "This would save the current mix session including tracks, cue points, and settings.");
        }
        
        function openLibraryFolder() {
            showAlert("Open Library Folder", "This would open a folder dialog to import multiple tracks at once.");
        }
        
        function createPlaylist() {
            showAlert("Create Playlist", "This would create a new playlist in your library.");
        }
        
        function exportLibrary() {
            showAlert("Export Library", "This would export your track library to a file.");
        }
        
        function connectGoogleDrive() {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'flex';
            modal.innerHTML = `
                <div class="modal-content w-96 max-w-full">
                    <h3 class="text-xl font-medium mb-4">Connect to Google Drive</h3>
                    <div class="mb-6 flex flex-col items-center justify-center text-center">
                        <i class="fab fa-google-drive text-5xl text-[#4285F4] mb-3"></i>
                        <p class="mb-4">Connect to your Google Drive to access your music files. You will need to authorize access to your Google account.</p>
                        <div class="bg-[#1a1a1a] p-4 rounded-md w-full text-left mb-4">
                            <div class="text-sm font-bold mb-2">This will allow Kirk Radio DJ to:</div>
                            <ul class="text-xs space-y-1 text-gray-300">
                                <li class="flex items-start">
                                    <i class="fas fa-check text-green-500 mr-2 mt-0.5"></i>
                                    <span>View and download audio files from your Google Drive</span>
                                </li>
                                <li class="flex items-start">
                                    <i class="fas fa-check text-green-500 mr-2 mt-0.5"></i>
                                    <span>Create a folder for storing mixes and playlists</span>
                                </li>
                                <li class="flex items-start">
                                    <i class="fas fa-times text-red-500 mr-2 mt-0.5"></i>
                                    <span>Cannot access your personal files or documents</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="flex justify-between">
                        <button onclick="cancelServiceConnection(this)" class="dj-button bg-[#333]">Cancel</button>
                        <button onclick="simulateServiceConnection('Google Drive')" class="dj-button bg-[#4285F4]">
                            <i class="fab fa-google mr-2"></i> Connect with Google
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        function connectOneDrive() {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'flex';
            modal.innerHTML = `
                <div class="modal-content w-96 max-w-full">
                    <h3 class="text-xl font-medium mb-4">Connect to OneDrive</h3>
                    <div class="mb-6 flex flex-col items-center justify-center text-center">
                        <i class="fab fa-microsoft text-5xl text-[#0078D4] mb-3"></i>
                        <p class="mb-4">Connect to your Microsoft OneDrive to access your music files. You will need to authorize access to your Microsoft account.</p>
                        <div class="bg-[#1a1a1a] p-4 rounded-md w-full text-left mb-4">
                            <div class="text-sm font-bold mb-2">This will allow Kirk Radio DJ to:</div>
                            <ul class="text-xs space-y-1 text-gray-300">
                                <li class="flex items-start">
                                    <i class="fas fa-check text-green-500 mr-2 mt-0.5"></i>
                                    <span>View and download audio files from your OneDrive</span>
                                </li>
                                <li class="flex items-start">
                                    <i class="fas fa-check text-green-500 mr-2 mt-0.5"></i>
                                    <span>Create a folder for storing mixes and playlists</span>
                                </li>
                                <li class="flex items-start">
                                    <i class="fas fa-times text-red-500 mr-2 mt-0.5"></i>
                                    <span>Cannot access your personal files or documents</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="flex justify-between">
                        <button onclick="cancelServiceConnection(this)" class="dj-button bg-[#333]">Cancel</button>
                        <button onclick="simulateServiceConnection('OneDrive')" class="dj-button bg-[#0078D4]">
                            <i class="fab fa-microsoft mr-2"></i> Connect with Microsoft
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        function connectYouTube() {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'flex';
            modal.innerHTML = `
                <div class="modal-content w-96 max-w-full">
                    <h3 class="text-xl font-medium mb-4">Connect to YouTube</h3>
                    <div class="mb-6 flex flex-col items-center justify-center text-center">
                        <i class="fab fa-youtube text-5xl text-[#FF0000] mb-3"></i>
                        <p class="mb-4">Connect to YouTube to access music, DJ mixes, and more. You will need to authorize access to your YouTube account.</p>
                        <div class="bg-[#1a1a1a] p-4 rounded-md w-full text-left mb-4">
                            <div class="text-sm font-bold mb-2">This will allow Kirk Radio DJ to:</div>
                            <ul class="text-xs space-y-1 text-gray-300">
                                <li class="flex items-start">
                                    <i class="fas fa-check text-green-500 mr-2 mt-0.5"></i>
                                    <span>Search and stream music from YouTube</span>
                                </li>
                                <li class="flex items-start">
                                    <i class="fas fa-check text-green-500 mr-2 mt-0.5"></i>
                                    <span>Access your YouTube playlists</span>
                                </li>
                                <li class="flex items-start">
                                    <i class="fas fa-check text-green-500 mr-2 mt-0.5"></i>
                                    <span>Create playlists for your mixes</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="flex justify-between">
                        <button onclick="cancelServiceConnection(this)" class="dj-button bg-[#333]">Cancel</button>
                        <button onclick="simulateServiceConnection('YouTube')" class="dj-button bg-[#FF0000]">
                            <i class="fab fa-youtube mr-2"></i> Connect with YouTube
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        function connectSoundCloud() {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'flex';
            modal.innerHTML = `
                <div class="modal-content w-96 max-w-full">
                    <h3 class="text-xl font-medium mb-4">Connect to SoundCloud</h3>
                    <div class="mb-6 flex flex-col items-center justify-center text-center">
                        <i class="fab fa-soundcloud text-5xl text-[#FF5500] mb-3"></i>
                        <p class="mb-4">Connect to SoundCloud to access millions of tracks, remixes, and DJ sets. You will need to authorize access to your SoundCloud account.</p>
                        <div class="bg-[#1a1a1a] p-4 rounded-md w-full text-left mb-4">
                            <div class="text-sm font-bold mb-2">This will allow Kirk Radio DJ to:</div>
                            <ul class="text-xs space-y-1 text-gray-300">
                                <li class="flex items-start">
                                    <i class="fas fa-check text-green-500 mr-2 mt-0.5"></i>
                                    <span>Search and stream music from SoundCloud</span>
                                </li>
                                <li class="flex items-start">
                                    <i class="fas fa-check text-green-500 mr-2 mt-0.5"></i>
                                    <span>Access your SoundCloud playlists and likes</span>
                                </li>
                                <li class="flex items-start">
                                    <i class="fas fa-check text-green-500 mr-2 mt-0.5"></i>
                                    <span>Follow artists and add tracks to your favorites</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="flex justify-between">
                        <button onclick="cancelServiceConnection(this)" class="dj-button bg-[#333]">Cancel</button>
                        <button onclick="simulateServiceConnection('SoundCloud')" class="dj-button bg-[#FF5500]">
                            <i class="fab fa-soundcloud mr-2"></i> Connect with SoundCloud
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        function cancelServiceConnection(button) {
            // Find the parent modal and remove it
            const modal = button.closest('.modal');
            if (modal) {
                document.body.removeChild(modal);
            }
        }
        
        function simulateServiceConnection(service) {
            // Close the connection modal
            const modal = document.querySelector('.modal:not(#alertModal)');
            if (modal) {
                document.body.removeChild(modal);
            }
            
            // Show a loading alert
            showAlert(`Connecting to ${service}`, `Establishing connection to ${service}. Please wait...`);
            
            // After a delay, show success and populate tracks
            setTimeout(() => {
                closeModal('alertModal');
                
                // Populate the track list with service-specific tracks
                const trackList = document.getElementById('trackList');
                
                // Generate service-specific tracks
                let tracks = [];
                let serviceIcon = '';
                let primaryColor = '';
                
                switch(service) {
                    case 'Google Drive':
                        tracks = [
                            { id: 101, title: "Road Trip Mix", artist: "Your Collection", genre: "Mix", duration: "45:20" },
                            { id: 102, title: "Summer Party 2024", artist: "Your Collection", genre: "Various", duration: "62:15" },
                            { id: 103, title: "Workout Beats", artist: "Your Collection", genre: "Electronic", duration: "32:40" },
                            { id: 104, title: "Chill Evening", artist: "Your Collection", genre: "Ambient", duration: "51:10" }
                        ];
                        serviceIcon = 'fa-google-drive';
                        primaryColor = '#4285F4';
                        break;
                    case 'OneDrive':
                        tracks = [
                            { id: 201, title: "80s Greatest Hits", artist: "Your Collection", genre: "Pop/Rock", duration: "58:30" },
                            { id: 202, title: "Jazz Classics", artist: "Your Collection", genre: "Jazz", duration: "47:15" },
                            { id: 203, title: "Classical Moments", artist: "Your Collection", genre: "Classical", duration: "63:40" },
                            { id: 204, title: "Hip Hop Selection", artist: "Your Collection", genre: "Hip Hop", duration: "42:50" }
                        ];
                        serviceIcon = 'fa-microsoft';
                        primaryColor = '#0078D4';
                        break;
                    case 'YouTube':
                        tracks = [
                            { id: 301, title: "EDM Festival Mix 2024", artist: "DJ Markus", genre: "EDM", duration: "120:00" },
                            { id: 302, title: "Lo-Fi Beats to Study To", artist: "ChillBeats", genre: "Lo-Fi", duration: "180:00" },
                            { id: 303, title: "Best of Techno 2023", artist: "TechnoChannel", genre: "Techno", duration: "95:20" },
                            { id: 304, title: "Deep House Mix April 2024", artist: "DeepVibes", genre: "House", duration: "75:30" },
                            { id: 305, title: "Hip Hop Classics", artist: "UrbanBeats", genre: "Hip Hop", duration: "60:45" },
                            { id: 306, title: "Tomorrowland 2023 Highlights", artist: "Festival Channel", genre: "EDM", duration: "45:10" }
                        ];
                        serviceIcon = 'fa-youtube';
                        primaryColor = '#FF0000';
                        break;
                    case 'SoundCloud':
                        tracks = [
                            { id: 401, title: "Underground House Mix", artist: "DJ Shadow", genre: "House", duration: "58:24" },
                            { id: 402, title: "Liquid Drum & Bass Set", artist: "LiquidFlow", genre: "D&B", duration: "62:37" },
                            { id: 403, title: "Ambient Textures", artist: "Dreamscape", genre: "Ambient", duration: "47:15" },
                            { id: 404, title: "Future Beats", artist: "CloudBeats", genre: "Electronic", duration: "53:20" },
                            { id: 405, title: "Minimal Techno Session", artist: "MinimalMinds", genre: "Techno", duration: "67:40" },
                            { id: 406, title: "Chill Wave", artist: "WaveForms", genre: "Chill", duration: "42:18" }
                        ];
                        serviceIcon = 'fa-soundcloud';
                        primaryColor = '#FF5500';
                        break;
                }
                
                // Display the tracks
                trackList.innerHTML = `
                    <div class="flex justify-between items-center mb-4">
                        <div class="flex items-center">
                            <i class="fab ${serviceIcon} text-[${primaryColor}] text-2xl mr-2"></i>
                            <div class="text-sm font-bold">${service} Music</div>
                        </div>
                        <div class="text-xs text-gray-400">${tracks.length} tracks</div>
                    </div>
                `;
                
                // Add tracks
                const trackItems = tracks.map(track => `
                    <div class="flex items-center p-3 hover:bg-gray-800 rounded cursor-pointer mb-2 bg-[#1a1a1a]"
                         onclick="loadServiceTrack(${track.id}, '${service}')">
                        <div class="w-10 h-10 bg-[${primaryColor}20] rounded flex items-center justify-center mr-3 text-[${primaryColor}]">
                            <i class="fab ${serviceIcon}"></i>
                        </div>
                        <div class="flex-1">
                            <div class="font-medium text-white">${track.title}</div>
                            <div class="text-xs text-gray-400 flex justify-between">
                                <span>${track.artist}</span>
                                <span>${track.duration}</span>
                            </div>
                            <div class="text-xs text-gray-500">${track.genre}</div>
                        </div>
                    </div>
                `).join('');
                
                trackList.innerHTML += trackItems;
                
                // Show success message
                showAlert(`${service} Connected`, `Successfully connected to ${service}. You can now browse and play tracks from your collection.`);
            }, 2000);
        }
        
        function loadServiceTrack(id, service) {
            // Similar to loadSampleTrack but for service tracks
            // For now, just show a modal with the deck selector
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'flex';
            modal.innerHTML = `
                <div class="modal-content">
                    <h3 class="text-xl font-medium mb-4">Load ${service} Track</h3>
                    <p class="mb-4">Select which deck to load this track to:</p>
                    <div class="flex justify-center space-x-4">
                        <button onclick="simulateLoadServiceTrack(${id}, '${service}', 0)" class="dj-button">Deck 1</button>
                        <button onclick="simulateLoadServiceTrack(${id}, '${service}', 1)" class="dj-button">Deck 2</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Add click handler to close modal when clicking outside
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    document.body.removeChild(modal);
                }
            });
        }
        
        function simulateLoadServiceTrack(id, service, deckIndex) {
            // Close the modal
            const modal = document.querySelector('.modal:not(#alertModal)');
            if (modal) {
                document.body.removeChild(modal);
            }
            
            // Show loading indicator
            showAlert("Loading Track", `Loading track from ${service} to Deck ${deckIndex + 1}...`);
            
            // Initialize audio context if needed
            if (!audioContext) {
                try {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    masterGain = audioContext.createGain();
                    masterGain.connect(audioContext.destination);
                    
                    decks[0].processor = new AudioProcessor(audioContext, masterGain);
                    decks[1].processor = new AudioProcessor(audioContext, masterGain);
                    decks[0].processor.deckIndex = 0;
                    decks[1].processor.deckIndex = 1;
                    
                    initializeCanvases();
                } catch (error) {
                    console.error('Failed to initialize audio context:', error);
                    showAlert('Error', 'Failed to initialize audio. Please check your browser settings.');
                    return;
                }
            }
            
            // Get track info based on service and id
            let track = { title: "Unknown Track", artist: "Unknown Artist", duration: "3:30" };
            
            // Generate a simulated track based on service and id
            switch(service) {
                case 'Google Drive':
                    if (id === 101) track = { title: "Road Trip Mix", artist: "Your Collection", genre: "Mix", duration: "45:20" };
                    else if (id === 102) track = { title: "Summer Party 2024", artist: "Your Collection", genre: "Various", duration: "62:15" };
                    else if (id === 103) track = { title: "Workout Beats", artist: "Your Collection", genre: "Electronic", duration: "32:40" };
                    else if (id === 104) track = { title: "Chill Evening", artist: "Your Collection", genre: "Ambient", duration: "51:10" };
                    break;
                case 'OneDrive':
                    if (id === 201) track = { title: "80s Greatest Hits", artist: "Your Collection", genre: "Pop/Rock", duration: "58:30" };
                    else if (id === 202) track = { title: "Jazz Classics", artist: "Your Collection", genre: "Jazz", duration: "47:15" };
                    else if (id === 203) track = { title: "Classical Moments", artist: "Your Collection", genre: "Classical", duration: "63:40" };
                    else if (id === 204) track = { title: "Hip Hop Selection", artist: "Your Collection", genre: "Hip Hop", duration: "42:50" };
                    break;
                case 'YouTube':
                    if (id === 301) track = { title: "EDM Festival Mix 2024", artist: "DJ Markus", genre: "EDM", duration: "120:00" };
                    else if (id === 302) track = { title: "Lo-Fi Beats to Study To", artist: "ChillBeats", genre: "Lo-Fi", duration: "180:00" };
                    else if (id === 303) track = { title: "Best of Techno 2023", artist: "TechnoChannel", genre: "Techno", duration: "95:20" };
                    else if (id === 304) track = { title: "Deep House Mix April 2024", artist: "DeepVibes", genre: "House", duration: "75:30" };
                    else if (id === 305) track = { title: "Hip Hop Classics", artist: "UrbanBeats", genre: "Hip Hop", duration: "60:45" };
                    else if (id === 306) track = { title: "Tomorrowland 2023 Highlights", artist: "Festival Channel", genre: "EDM", duration: "45:10" };
                    break;
                case 'SoundCloud':
                    if (id === 401) track = { title: "Underground House Mix", artist: "DJ Shadow", genre: "House", duration: "58:24" };
                    else if (id === 402) track = { title: "Liquid Drum & Bass Set", artist: "LiquidFlow", genre: "D&B", duration: "62:37" };
                    else if (id === 403) track = { title: "Ambient Textures", artist: "Dreamscape", genre: "Ambient", duration: "47:15" };
                    else if (id === 404) track = { title: "Future Beats", artist: "CloudBeats", genre: "Electronic", duration: "53:20" };
                    else if (id === 405) track = { title: "Minimal Techno Session", artist: "MinimalMinds", genre: "Techno", duration: "67:40" };
                    else if (id === 406) track = { title: "Chill Wave", artist: "WaveForms", genre: "Chill", duration: "42:18" };
                    break;
            }
            
            // Simulate loading by waiting
            setTimeout(() => {
                // Generate audio buffer for track
                const sampleRate = audioContext.sampleRate;
                const durationParts = track.duration.split(':');
                const durationInSeconds = parseInt(durationParts[0]) * 60 + parseInt(durationParts[1]);
                const frameCount = sampleRate * durationInSeconds;
                
                const audioBuffer = audioContext.createBuffer(2, frameCount, sampleRate);
                
                // Generate different test tones based on genre
                for (let channel = 0; channel < 2; channel++) {
                    const channelData = audioBuffer.getChannelData(channel);
                    
                    // Base frequency depends on genre
                    let baseFreq = 110; // default
                    let rhythm = 2.0; // beats per second (120 BPM)
                    
                    if (track.genre === "House") { baseFreq = 110; rhythm = 2.2; } // 132 BPM
                    else if (track.genre === "Techno") { baseFreq = 100; rhythm = 2.3; } // 138 BPM
                    else if (track.genre === "Hip Hop") { baseFreq = 80; rhythm = 1.5; } // 90 BPM
                    else if (track.genre === "D&B") { baseFreq = 140; rhythm = 2.83; } // 170 BPM
                    else if (track.genre === "Ambient") { baseFreq = 220; rhythm = 0.8; } // Slow
                    else if (track.genre === "Jazz") { baseFreq = 220; rhythm = 1.8; } // 108 BPM, jazzy
                    else if (track.genre === "Lo-Fi") { baseFreq = 110; rhythm = 1.42; } // 85 BPM
                    
                    for (let i = 0; i < frameCount; i++) {
                        const t = i / sampleRate;
                        
                        // Add some rhythm
                        const beat = Math.sin(2 * Math.PI * rhythm * (t % 1)) * 0.3;
                        
                        // Add some bass notes
                        const bass = Math.sin(2 * Math.PI * baseFreq * t) * 0.4 * (Math.sin(2 * Math.PI * 0.5 * t) * 0.5 + 0.5);
                        
                        // Add some mid notes
                        const mid = Math.sin(2 * Math.PI * baseFreq * 3 * t) * 0.2 * (Math.sin(2 * Math.PI * 0.25 * t + 0.2) * 0.5 + 0.5);
                        
                        // Add some high notes
                        const high = Math.sin(2 * Math.PI * baseFreq * 10 * t) * 0.1 * (Math.sin(2 * Math.PI * 2 * t + 0.5) * 0.5 + 0.5);
                        
                        // Combined waveform with random variations to make it sound more like music
                        const sample = (beat + bass + mid + high) / 2;
                        
                        // Apply volume envelope
                        const envelope = Math.min(1, 10 * (1 - i / frameCount) + 0.1);
                        
                        channelData[i] = sample * envelope;
                    }
                }
                
                // Load buffer to processor
                decks[deckIndex].processor.loadBuffer(audioBuffer, track.title, track.artist);
                
                // Close alert and show confirmation
                closeModal('alertModal');
                showAlert("Track Loaded", `"${track.title}" by ${track.artist} from ${service} successfully loaded to Deck ${deckIndex + 1}. Press play to start.`);
                
                // Add to recent tracks
                const recentTrack = {
                    id: id,
                    title: track.title,
                    artist: track.artist,
                    service: service,
                    genre: track.genre,
                    duration: track.duration
                };
                
                addToRecentTracks(recentTrack, deckIndex);
            }, 2000);
        }
        
        function browseMusicDatabase() {
            // Populate the library with tracks from our music database
            const musicDatabase = [
                { id: 1, title: "Summer Vibes", artist: "DJ Sunshine", genre: "House", duration: "3:45", image: "summer.jpg" },
                { id: 2, title: "Midnight Run", artist: "Beat Masters", genre: "Techno", duration: "4:12", image: "midnight.jpg" },
                { id: 3, title: "Electric Dreams", artist: "Synth Wave", genre: "Electronic", duration: "5:30", image: "dreams.jpg" },
                { id: 4, title: "Urban Rhythm", artist: "City Beats", genre: "Hip Hop", duration: "3:22", image: "urban.jpg" },
                { id: 5, title: "Chill Out Zone", artist: "Ambient Sounds", genre: "Ambient", duration: "6:15", image: "chill.jpg" },
                { id: 6, title: "Club Anthems", artist: "Party DJs", genre: "Dance", duration: "4:45", image: "club.jpg" },
                { id: 7, title: "Retro Wave", artist: "80s Revival", genre: "Synthwave", duration: "4:30", image: "retro.jpg" },
                { id: 8, title: "Bass Drop", artist: "Dubstep Kings", genre: "Dubstep", duration: "3:50", image: "bass.jpg" },
                { id: 9, title: "Smooth Jazz", artist: "Saxophone Soul", genre: "Jazz", duration: "5:20", image: "jazz.jpg" },
                { id: 10, title: "Tropical House", artist: "Beach Vibes", genre: "House", duration: "4:10", image: "tropical.jpg" },
                { id: 11, title: "Rock Classics", artist: "Guitar Heroes", genre: "Rock", duration: "5:15", image: "rock.jpg" },
                { id: 12, title: "Deep House Journey", artist: "Underground DJs", genre: "House", duration: "7:20", image: "deep.jpg" },
                { id: 13, title: "Hip Hop Beats", artist: "Urban Producers", genre: "Hip Hop", duration: "3:45", image: "hiphop.jpg" },
                { id: 14, title: "EDM Festival", artist: "Main Stage", genre: "EDM", duration: "5:30", image: "edm.jpg" },
                { id: 15, title: "Classical Remix", artist: "Orchestra X", genre: "Classical", duration: "6:10", image: "classical.jpg" },
                { id: 16, title: "Reggae Roots", artist: "Island Crew", genre: "Reggae", duration: "4:20", image: "reggae.jpg" },
                { id: 17, title: "Drum & Bass", artist: "Beat Surgeons", genre: "D&B", duration: "5:45", image: "dnb.jpg" },
                { id: 18, title: "Trance Nation", artist: "Euphoria", genre: "Trance", duration: "8:30", image: "trance.jpg" },
                { id: 19, title: "Lo-Fi Beats", artist: "Chill Study", genre: "Lo-Fi", duration: "3:33", image: "lofi.jpg" },
                { id: 20, title: "Funky Grooves", artist: "Disco Funk", genre: "Funk", duration: "4:50", image: "funk.jpg" }
            ];
            
            const trackList = document.getElementById('trackList');
            trackList.innerHTML = '<div class="flex justify-between items-center mb-3"><div class="text-sm text-primary font-bold">KIRK RADIO MUSIC DATABASE</div><div class="text-xs text-gray-400">' + musicDatabase.length + ' tracks available</div></div>';
            
            // Create genre filter buttons
            const genres = [...new Set(musicDatabase.map(track => track.genre))];
            let genreHTML = '<div class="flex flex-wrap gap-2 mb-4">';
            genreHTML += '<button onclick="filterTracks(\'all\')" class="px-2 py-1 bg-[#D42F00] text-white text-xs rounded">All</button>';
            
            genres.forEach(genre => {
                genreHTML += `<button onclick="filterTracks('${genre}')" class="px-2 py-1 bg-[#333] text-white text-xs rounded hover:bg-[#444]">${genre}</button>`;
            });
            
            genreHTML += '</div>';
            trackList.innerHTML += genreHTML;
            
            // Add tracks with cover art (using gradient backgrounds as placeholders)
            trackList.innerHTML += '<div id="trackGrid" class="grid grid-cols-2 gap-3">';
            
            const trackGrid = musicDatabase.map(track => {
                // Generate a color based on the genre for the background
                const colors = {
                    'House': '#3498db',
                    'Techno': '#1abc9c', 
                    'Electronic': '#9b59b6',
                    'Hip Hop': '#e74c3c',
                    'Ambient': '#2ecc71',
                    'Dance': '#f39c12',
                    'Synthwave': '#8e44ad',
                    'Dubstep': '#c0392b',
                    'Jazz': '#16a085',
                    'Rock': '#d35400',
                    'EDM': '#e67e22',
                    'Classical': '#2980b9',
                    'Reggae': '#27ae60',
                    'D&B': '#e84393',
                    'Trance': '#74b9ff',
                    'Lo-Fi': '#6c5ce7',
                    'Funk': '#fd79a8'
                };
                
                const bgColor = colors[track.genre] || '#D42F00';
                
                return `
                <div class="track-item flex flex-col bg-[#1a1a1a] rounded-lg overflow-hidden hover:bg-[#252525] cursor-pointer transition-all duration-200" 
                     data-genre="${track.genre}" onclick="loadSampleTrack(${track.id})">
                    <div class="h-24 w-full bg-gradient-to-br from-${bgColor.replace('#', '')} to-[#111] flex items-center justify-center">
                        <i class="fas fa-music text-white text-2xl opacity-50"></i>
                    </div>
                    <div class="p-2">
                        <div class="font-medium text-white text-sm truncate">${track.title}</div>
                        <div class="text-xs text-gray-400 truncate">${track.artist}</div>
                        <div class="flex justify-between items-center mt-1">
                            <span class="text-xs px-2 py-0.5 bg-[#333] rounded-full">${track.genre}</span>
                            <span class="text-xs text-gray-500">${track.duration}</span>
                        </div>
                    </div>
                </div>
                `;
            }).join('');
            
            document.getElementById('trackGrid').innerHTML = trackGrid;
            
            // Show confirmation
            showAlert("Music Database Connected", "Successfully connected to the Kirk Radio Music Database. Browse and play tracks from our collection.");
        }
        
        // Filter tracks by genre
        function filterTracks(genre) {
            const tracks = document.querySelectorAll('.track-item');
            
            tracks.forEach(track => {
                if (genre === 'all' || track.dataset.genre === genre) {
                    track.style.display = 'flex';
                } else {
                    track.style.display = 'none';
                }
            });
        }
        
        function loadSampleTrack(id) {
            // Load sample track to the selected deck
            if (!audioContext) {
                try {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    masterGain = audioContext.createGain();
                    masterGain.connect(audioContext.destination);
                    
                    decks[0].processor = new AudioProcessor(audioContext, masterGain);
                    decks[1].processor = new AudioProcessor(audioContext, masterGain);
                    decks[0].processor.deckIndex = 0;
                    decks[1].processor.deckIndex = 1;
                    
                    initializeCanvases();
                } catch (error) {
                    console.error('Failed to initialize audio context:', error);
                    showAlert('Error', 'Failed to initialize audio. Please check your browser settings.');
                    return;
                }
            }
            
            // Ask which deck to load to
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'flex';
            modal.innerHTML = `
                <div class="modal-content">
                    <h3 class="text-xl font-medium mb-4">Choose Deck</h3>
                    <p class="mb-4">Select which deck to load this track to:</p>
                    <div class="flex justify-center space-x-4">
                        <button onclick="loadTrackToDeck(${id}, 0)" class="dj-button">Deck 1</button>
                        <button onclick="loadTrackToDeck(${id}, 1)" class="dj-button">Deck 2</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Add click handler to close modal when clicking outside
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    document.body.removeChild(modal);
                }
            });
        }
        
        function loadTrackToDeck(id, deckIndex) {
            // Close any open modal
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (modal.style.display === 'flex' && modal !== document.getElementById('alertModal')) {
                    document.body.removeChild(modal);
                }
            });
            
            // Get the track info from our database
            const musicDatabase = [
                { id: 1, title: "Summer Vibes", artist: "DJ Sunshine", genre: "House", duration: "3:45" },
                { id: 2, title: "Midnight Run", artist: "Beat Masters", genre: "Techno", duration: "4:12" },
                { id: 3, title: "Electric Dreams", artist: "Synth Wave", genre: "Electronic", duration: "5:30" },
                { id: 4, title: "Urban Rhythm", artist: "City Beats", genre: "Hip Hop", duration: "3:22" },
                { id: 5, title: "Chill Out Zone", artist: "Ambient Sounds", genre: "Ambient", duration: "6:15" },
                { id: 6, title: "Club Anthems", artist: "Party DJs", genre: "Dance", duration: "4:45" },
                { id: 7, title: "Retro Wave", artist: "80s Revival", genre: "Synthwave", duration: "4:30" },
                { id: 8, title: "Bass Drop", artist: "Dubstep Kings", genre: "Dubstep", duration: "3:50" },
                { id: 9, title: "Smooth Jazz", artist: "Saxophone Soul", genre: "Jazz", duration: "5:20" },
                { id: 10, title: "Tropical House", artist: "Beach Vibes", genre: "House", duration: "4:10" },
                { id: 11, title: "Rock Classics", artist: "Guitar Heroes", genre: "Rock", duration: "5:15" },
                { id: 12, title: "Deep House Journey", artist: "Underground DJs", genre: "House", duration: "7:20" },
                { id: 13, title: "Hip Hop Beats", artist: "Urban Producers", genre: "Hip Hop", duration: "3:45" },
                { id: 14, title: "EDM Festival", artist: "Main Stage", genre: "EDM", duration: "5:30" },
                { id: 15, title: "Classical Remix", artist: "Orchestra X", genre: "Classical", duration: "6:10" },
                { id: 16, title: "Reggae Roots", artist: "Island Crew", genre: "Reggae", duration: "4:20" },
                { id: 17, title: "Drum & Bass", artist: "Beat Surgeons", genre: "D&B", duration: "5:45" },
                { id: 18, title: "Trance Nation", artist: "Euphoria", genre: "Trance", duration: "8:30" },
                { id: 19, title: "Lo-Fi Beats", artist: "Chill Study", genre: "Lo-Fi", duration: "3:33" },
                { id: 20, title: "Funky Grooves", artist: "Disco Funk", genre: "Funk", duration: "4:50" }
            ];
            
            const track = musicDatabase.find(t => t.id === id);
            
            if (!track) {
                showAlert("Error", "Track not found in database.");
                return;
            }
            
            // Show loading indicator
            showAlert("Loading Track", `Loading "${track.title}" by ${track.artist} to Deck ${deckIndex + 1}...`);
            
            // Simulate loading audio from a server
            setTimeout(() => {
                // Generate a simulated audio buffer based on the track genre
                const sampleRate = audioContext.sampleRate;
                const durationInSeconds = parseInt(track.duration.split(':')[0]) * 60 + parseInt(track.duration.split(':')[1]);
                const frameCount = sampleRate * durationInSeconds;
                
                const audioBuffer = audioContext.createBuffer(2, frameCount, sampleRate);
                
                // Generate different test tones based on genre
                for (let channel = 0; channel < 2; channel++) {
                    const channelData = audioBuffer.getChannelData(channel);
                    
                    // Base frequency depends on genre
                    let baseFreq = 440; // default A note
                    let rhythm = 1; // beats per second
                    
                    switch (track.genre) {
                        case 'House':
                            baseFreq = 110;
                            rhythm = 2.2; // 132 BPM
                            break;
                        case 'Techno':
                            baseFreq = 100;
                            rhythm = 2.3; // 138 BPM
                            break;
                        case 'Hip Hop':
                            baseFreq = 80;
                            rhythm = 1.5; // 90 BPM
                            break;
                        case 'Dubstep':
                            baseFreq = 75;
                            rhythm = 1.16; // 70 BPM with half-time feel
                            break;
                        case 'Ambient':
                            baseFreq = 220;
                            rhythm = 0.8; // Slow
                            break;
                        default:
                            baseFreq = 110;
                            rhythm = 2.0; // 120 BPM
                    }
                    
                    for (let i = 0; i < frameCount; i++) {
                        const t = i / sampleRate;
                        
                        // Add some rhythm
                        const beat = Math.sin(2 * Math.PI * rhythm * (t % 1)) * 0.3;
                        
                        // Add some bass notes
                        const bass = Math.sin(2 * Math.PI * baseFreq * t) * 0.4 * (Math.sin(2 * Math.PI * 0.5 * t) * 0.5 + 0.5);
                        
                        // Add some mid notes
                        const mid = Math.sin(2 * Math.PI * baseFreq * 3 * t) * 0.2 * (Math.sin(2 * Math.PI * 0.25 * t + 0.2) * 0.5 + 0.5);
                        
                        // Add some high notes
                        const high = Math.sin(2 * Math.PI * baseFreq * 10 * t) * 0.1 * (Math.sin(2 * Math.PI * 2 * t + 0.5) * 0.5 + 0.5);
                        
                        // Combined waveform
                        const sample = (beat + bass + mid + high) / 2;
                        
                        // Apply overall volume envelope
                        const envelope = Math.min(1, 10 * (1 - i / frameCount) + 0.1);
                        
                        channelData[i] = sample * envelope;
                    }
                }
                
                // Load buffer to processor
                decks[deckIndex].processor.loadBuffer(audioBuffer, track.title, track.artist);
                
                // Close alert and show confirmation
                closeModal('alertModal');
                showAlert("Track Loaded", `"${track.title}" by ${track.artist} successfully loaded to Deck ${deckIndex + 1}. Press play to start.`);
                
                // Add to recent tracks if not already there
                addToRecentTracks(track, deckIndex);
            }, 1000);
        }
        
        // Add track to recent tracks list
        function addToRecentTracks(track, deckIndex) {
            // Check if we have a recents section
            let recentsContainer = document.getElementById('recentTracks');
            
            // If not, create it
            if (!recentsContainer) {
                const trackList = document.getElementById('trackList');
                const recentsHTML = `
                <div id="recentTracksSection" class="mt-6 border-t border-[#333] pt-4">
                    <div class="text-sm text-primary font-bold mb-2">RECENT TRACKS</div>
                    <div id="recentTracks" class="space-y-2"></div>
                </div>`;
                
                // Add it after any existing content
                trackList.innerHTML += recentsHTML;
                recentsContainer = document.getElementById('recentTracks');
            }
            
            // Create the track item
            const trackItem = document.createElement('div');
            trackItem.className = 'flex items-center p-2 bg-[#1a1a1a] rounded';
            trackItem.innerHTML = `
                <div class="w-8 h-8 bg-[#333] rounded flex items-center justify-center mr-2">
                    <span class="text-xs font-bold text-white">D${deckIndex + 1}</span>
                </div>
                <div class="flex-1 min-w-0">
                    <div class="font-medium text-white text-sm truncate">${track.title}</div>
                    <div class="text-xs text-gray-400 truncate">${track.artist}</div>
                </div>
                <div class="ml-2">
                    <button onclick="loadTrackToDeck(${track.id}, ${deckIndex})" class="text-xs px-2 py-1 bg-[#333] hover:bg-[#444] rounded">
                        Reload
                    </button>
                </div>
            `;
            
            // Add to recents container (at the top)
            recentsContainer.insertBefore(trackItem, recentsContainer.firstChild);
            
            // Limit to 5 recent tracks
            if (recentsContainer.children.length > 5) {
                recentsContainer.removeChild(recentsContainer.lastChild);
            }
        }
        
        // Utility functions
        function showAlert(title, message) {
            const modal = document.getElementById('alertModal');
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalMessage').textContent = message;
            modal.style.display = 'flex';
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        // Placeholder search functions
        function searchTracks(query) {
            if (!query || query.length < 3) return;
            
            // This would normally search through a database or media library
            // For now, we'll just show a message
            const library = document.getElementById('trackList');
            library.innerHTML = '<div class="text-center py-4"><i class="fas fa-spinner fa-spin fa-2x text-gray-500"></i></div>';
            
            // Simulate loading
            setTimeout(() => {
                library.innerHTML = '<div class="text-center text-gray-500 mt-10"><p>No tracks found matching "' + query + '"</p></div>';
            }, 1000);
        }
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', () => {
            // Add global mouse event listeners for scratch effect
            document.addEventListener('mousemove', (e) => {
                scratching.forEach((isScratch, index) => {
                    if (isScratch) {
                        scratch(index, e);
                    }
                });
            });
            
            document.addEventListener('mouseup', () => {
                scratching.forEach((isScratch, index) => {
                    if (isScratch) {
                        stopScratch(index);
                    }
                });
            });
            
            // Close dropdowns when clicking outside
            document.addEventListener('click', (e) => {
                if (!e.target.closest('#broadcastBtn') && !e.target.closest('#broadcastSettings')) {
                    const dropdown = document.getElementById('broadcastSettings');
                    if (dropdown.style.display === 'block') {
                        dropdown.style.display = 'none';
                        document.getElementById('broadcastBtn').classList.remove('active');
                    }
                }
                
                if (!e.target.closest('#settingsBtn') && !e.target.closest('#appSettings')) {
                    const dropdown = document.getElementById('appSettings');
                    if (dropdown.style.display === 'block') {
                        dropdown.style.display = 'none';
                        document.getElementById('settingsBtn').classList.remove('active');
                    }
                }
            });
            
            // Close modal when clicking outside the content
            document.getElementById('alertModal').addEventListener('click', (e) => {
                if (e.target === document.getElementById('alertModal')) {
                    closeModal('alertModal');
                }
            });
            
            // Initialize broadcast status
            updateBroadcastStatus();
            
            // Setup window resize handler for waveform canvases
            window.addEventListener('resize', () => {
                // Redraw waveforms if decks have tracks loaded
                if (decks[0].processor?.buffer) decks[0].processor.drawWaveform();
                if (decks[1].processor?.buffer) decks[1].processor.drawWaveform();
            });
        });
    </script>
</body>
</html>
