<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kirk Radio DJ - Professional DJ Software</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary: #D42F00;
            --background: #111;
            --secondary: #222;
            --border: #333;
            --highlight-active: #D42F00;
            --highlight-inactive: #555;
            --text-primary: #fff;
            --text-secondary: #aaa;
        }

        body {
            background-color: var(--background);
            color: var(--text-primary);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            position: relative;
            min-height: 100vh;
            overflow-x: hidden;
        }

        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('data:image/svg+xml;charset=utf8,...');
            background-size: 400px;
            background-position: center center;
            background-repeat: no-repeat;
            background-attachment: fixed;
            opacity: 0.25;
            z-index: -2;
        }

        body::after {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: -1;
        }

        .deck {
            background-color: var(--secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }

        .deck:hover {
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.5);
        }

        /* Additional styles */
    </style>
</head>
<body>
    <div class="flex h-screen">
        <!-- Left Sidebar - Track Library -->
        <div class="w-64 bg-[#1a1a1a] border-r border-[#333] flex flex-col">
            <div class="p-4 border-b border-[#333]">
                <h2 class="text-lg font-medium mb-3">Track Library</h2>
                <div class="relative">
                    <input type="text" placeholder="Search tracks..." 
                           class="w-full bg-[#222] border border-[#333] rounded px-4 py-2 pl-10 text-white" 
                           onkeyup="searchTracks(this.value)">
                    <i class="fas fa-search absolute left-3 top-3 text-gray-500"></i>
                </div>
            </div>
            <div class="flex-1 max-h-fit p-4" id="trackList">
                <div class="text-center text-gray-500 mt-10">
                    <p>No tracks loaded</p>
                    <p class="mt-2">Use "Load Track" button or click "Music Database" to see available tracks</p>
                </div>
            </div>
            <!-- Library Controls -->
            <div class="p-4 border-t border-[#333]">
                <div class="section-label">Library Controls</div>
                <button onclick="openLibraryFolder()" class="dj-button w-full mb-2 tooltip">
                    <i class="fas fa-folder-open mr-2"></i> Open Library Folder
                    <span class="tooltip-text">Open a folder to import multiple tracks at once</span>
                </button>
                <div class="flex gap-2 mb-4">
                    <button onclick="createPlaylist()" class="dj-button flex-1 tooltip">
                        <i class="fas fa-plus mr-1"></i> New Playlist
                        <span class="tooltip-text">Create a new playlist</span>
                    </button>
                    <button onclick="exportLibrary()" class="dj-button flex-1 tooltip">
                        <i class="fas fa-file-export mr-1"></i> Export
                        <span class="tooltip-text">Export your track library</span>
                    </button>
                </div>
                <div class="section-label">Music Services</div>
                <div class="space-y-2">
                    <button onclick="connectGoogleDrive()" class="dj-button w-full flex items-center justify-between tooltip">
                        <div><i class="fab fa-google-drive mr-2"></i> Google Drive</div>
                        <i class="fas fa-link text-xs"></i>
                        <span class="tooltip-text">Connect to your Google Drive music</span>
                    </button>
                    <button onclick="connectOneDrive()" class="dj-button w-full flex items-center justify-between tooltip">
                        <div><i class="fab fa-microsoft mr-2"></i> OneDrive</div>
                        <i class="fas fa-link text-xs"></i>
                        <span class="tooltip-text">Connect to your OneDrive music</span>
                    </button>
                    <button onclick="connectYouTube()" class="dj-button w-full flex items-center justify-between tooltip">
                        <div><i class="fab fa-youtube mr-2"></i> YouTube</div>
                        <i class="fas fa-link text-xs"></i>
                        <span class="tooltip-text">Connect to YouTube for DJ mixes and music</span>
                    </button>
                    <button onclick="connectSoundCloud()" class="dj-button w-full flex items-center justify-between tooltip">
                        <div><i class="fab fa-soundcloud mr-2"></i> SoundCloud</div>
                        <i class="fas fa-link text-xs"></i>
                        <span class="tooltip-text">Connect to SoundCloud for streaming music</span>
                    </button>
                    <button onclick="browseMusicDatabase()" class="dj-button w-full flex items-center justify-between tooltip bg-[#D42F00]">
                        <div><i class="fas fa-database mr-2"></i> Music Database</div>
                        <i class="fas fa-external-link-alt text-xs"></i>
                        <span class="tooltip-text">Browse our extensive online music collection</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="flex-1 flex flex-col bg-[#111]">
            <!-- Top Toolbar -->
            <div class="bg-[#1a1a1a] border-b border-[#333] p-4">
                <div class="flex items-center justify-between">
                    <div class="flex space-x-4">
                        <button onclick="saveMix()" class="dj-button tooltip">
                            <i class="fas fa-save mr-2"></i>Save Mix
                            <span class="tooltip-text">Save the current mix session</span>
                        </button>
                        <button id="loadTrackBtn" onclick="loadTrack()" class="dj-button tooltip">
                            <i class="fas fa-file-audio mr-2"></i>Load Track
                            <span class="tooltip-text">Load an audio track from your device</span>
                        </button>
                        <div class="dropdown relative">
                            <button id="broadcastBtn" onclick="toggleBroadcastSettings()" class="dj-button tooltip">
                                <i class="fas fa-broadcast-tower mr-2"></i>Broadcast Settings
                                <span class="tooltip-text">Configure and start Icecast broadcasting</span>
                            </button>
                            <div id="broadcastSettings" class="dropdown-content">
                                <div class="p-4">
                                    <h3 class="text-white font-medium mb-4">Icecast Broadcast Settings</h3>
                                    <div class="space-y-4">
                                        <div>
                                            <label class="block mb-1 text-sm">Icecast Server URL</label>
                                            <input type="text" id="icecastUrl" placeholder="http://your-server:8000" 
                                                   class="w-full bg-[#333] border border-[#444] rounded px-3 py-2 text-white text-sm">
                                        </div>
                                        <div>
                                            <label class="block mb-1 text-sm">Mount Point</label>
                                            <input type="text" id="mountPoint" placeholder="/stream" 
                                                   class="w-full bg-[#333] border border-[#444] rounded px-3 py-2 text-white text-sm">
                                        </div>
                                        <div>
                                            <label class="block mb-1 text-sm">Username</label>
                                            <input type="text" id="icecastUsername" placeholder="source" 
                                                   class="w-full bg-[#333] border border-[#444] rounded px-3 py-2 text-white text-sm">
                                        </div>
                                        <div>
                                            <label class="block mb-1 text-sm">Password</label>
                                            <input type="password" id="icecastPassword" placeholder="********" 
                                                   class="w-full bg-[#333] border border-[#444] rounded px-3 py-2 text-white text-sm">
                                        </div>
                                        <div>
                                            <label class="block mb-1 text-sm">Stream Name</label>
                                            <input type="text" id="streamName" placeholder="Kirk Radio DJ Live Mix" 
                                                   class="w-full bg-[#333] border border-[#444] rounded px-3 py-2 text-white text-sm">
                                        </div>
                                        <div>
                                            <label class="block mb-1 text-sm">Stream Description</label>
                                            <input type="text" id="streamDescription" placeholder="Live DJ set by Kirk Radio DJ" 
                                                   class="w-full bg-[#333] border border-[#444] rounded px-3 py-2 text-white text-sm">
                                        </div>
                                        <div>
                                            <label class="block mb-1 text-sm">Bitrate</label>
                                            <select id="streamBitrate" class="w-full bg-[#333] border border-[#444] rounded px-3 py-2 text-white text-sm">
                                                <option value="64">64 kbps (Low Quality)</option>
                                                <option value="128" selected>128 kbps (Standard)</option>
                                                <option value="192">192 kbps (Good Quality)</option>
                                                <option value="256">256 kbps (High Quality)</option>
                                                <option value="320">320 kbps (Best Quality)</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label class="block mb-1 text-sm">Format</label>
                                            <select id="streamFormat" class="w-full bg-[#333] border border-[#444] rounded px-3 py-2 text-white text-sm">
                                                <option value="mp3" selected>MP3</option>
                                                <option value="aac">AAC</option>
                                                <option value="ogg">Ogg Vorbis</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="dropdown relative">
                            <button id="settingsBtn" onclick="toggleAppSettings()" class="dj-button tooltip">
                                <i class="fas fa-cog mr-2"></i>Settings
                                <span class="tooltip-text">Configure application settings</span>
                            </button>
                            <div id="appSettings" class="dropdown-content">
                                <div class="p-4">
                                    <h3 class="text-white font-medium mb-4">Application Settings</h3>
                                    <div class="space-y-4">
                                        <div class="section-label">Audio Devices</div>
                                        <div>
                                            <label class="block mb-1 text-sm">Output Device</label>
                                            <select id="audioOutputDevice" class="w-full bg-[#333] border border-[#444] rounded px-3 py-2 text-white text-sm">
                                                <option value="default" selected>Default Output Device</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label class="block mb-1 text-sm">Microphone Input</label>
                                            <select id="micInputDevice" class="w-full bg-[#333] border border-[#444] rounded px-3 py-2 text-white text-sm">
                                                <option value="none">No Microphone</option>
                                                <option value="default" selected>Default Input Device</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label class="block mb-1 text-sm">DJ Controller</label>
                                            <select id="djControllerDevice" class="w-full bg-[#333] border border-[#444] rounded px-3 py-2 text-white text-sm">
                                                <option value="none" selected>No Controller</option>
                                            </select>
                                        </div>
                                        <div>
                                            <button onclick="detectHardware()" class="dj-button w-full mb-3">
                                                <i class="fas fa-search mr-2"></i> Detect Hardware
                                            </button>
                                        </div>
                                        <div class="section-label">Interface Settings</div>
                                        <div>
                                            <label class="flex items-center mb-2">
                                                <input type="checkbox" id="darkModeToggle" class="mr-2" checked> 
                                                <span>Dark Mode</span>
                                            </label>
                                            <label class="flex items-center mb-2">
                                                <input type="checkbox" id="waveformExpandedToggle" class="mr-2"> 
                                                <span>Show Expanded Waveforms</span>
                                            </label>
                                            <label class="flex items-center mb-2">
                                                <input type="checkbox" id="highQualityVinylToggle" class="mr-2" checked> 
                                                <span>High Quality Vinyl Scratch Effect</span>
                                            </label>
                                            <label class="flex items-center mb-4">
                                                <input type="checkbox" id="performanceModeToggle" class="mr-2"> 
                                                <span>Performance Mode (Reduce Visual Effects)</span>
                                            </label>
                                            
                                            <button onclick="toggleFullscreen()" class="dj-button w-full mb-3">
                                                <i class="fas fa-expand mr-2"></i> Toggle Fullscreen
                                            </button>
                                        </div>
                                        <div class="section-label">Audio Processing</div>
                                        <div>
                                            <label class="block mb-1 text-sm">Buffer Size</label>
                                            <select id="bufferSize" class="w-full bg-[#333] border border-[#444] rounded px-3 py-2 text-white text-sm mb-3">
                                                <option value="256">256 (Lowest latency)</option>
                                                <option value="512" selected>512 (Balanced)</option>
                                                <option value="1024">1024 (Best stability)</option>
                                                <option value="2048">2048 (Maximum stability)</option>
                                            </select>
                                            <label class="block mb-1 text-sm">Sample Rate</label>
                                            <select id="sampleRate" class="w-full bg-[#333] border border-[#444] rounded px-3 py-2 text-white text-sm">
                                                <option value="44100">44.1 kHz (Standard)</option>
                                                <option value="48000" selected>48 kHz (Better Quality)</option>
                                                <option value="96000">96 kHz (High Quality)</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="flex items-center space-x-6">
                        <div class="flex items-center">
                            <span class="control-label mr-2">Master Tempo:</span>
                            <input type="range" min="60" max="200" value="128" class="slider w-32"
                                   oninput="updateMasterTempo(this.value)">
                            <span class="text-white ml-2" id="tempoValue">128 BPM</span>
                        </div>
                        <div class="flex items-center">
                            <i class="fas fa-volume-up text-white mr-2" title="Master Volume"></i>
                            <input type="range" min="0" max="100" value="100" class="slider w-24"
                                   oninput="updateMasterVolume(this.value)" title="Master Volume Control">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Decks -->
            <div class="flex-1 p-6 space-y-6">
                <div class="grid grid-cols-2 gap-6">
                    <!-- Deck 1 -->
                    <div class="deck p-6">
                        <div class="flex justify-between mb-4">
                            <h2 class="text-xl font-medium">Deck 1</h2>
                            <div class="flex space-x-2">
                                <button onclick="toggleSync(0)" class="dj-button tooltip" title="Sync Tempo with Master">
                                    <i class="fas fa-sync"></i>
                                    <span class="tooltip-text">Sync Tempo with Master</span>
                                </button>
                                <button onclick="toggleKeyLock(0)" class="dj-button tooltip" title="Key Lock">
                                    <i class="fas fa-key"></i>
                                    <span class="tooltip-text">Lock Key When Changing Tempo</span>
                                </button>
                                <button onclick="toggleLoop(0)" class="dj-button tooltip" title="Loop Current Section">
                                    <i class="fas fa-redo"></i>
                                    <span class="tooltip-text">Loop Current Section</span>
                                </button>
                            </div>
                        </div>

                        <div class="track-info p-2 mb-4">
                            <div id="deck1Title" class="font-medium truncate">No track loaded</div>
                            <div id="deck1Artist" class="text-sm text-gray-400 truncate">--</div>
                            <div class="flex justify-between items-center mt-2 text-xs text-gray-500">
                                <span id="deck1CurrentTime">00:00</span>
                                <div class="progress-bar flex-1 mx-2">
                                    <div id="deck1Progress" class="progress-bar-fill" style="width: 0%"></div>
                                </div>
                                <span id="deck1TotalTime">00:00</span>
                            </div>
                        </div>

                        <div class="flex gap-6">
                            <div class="flex flex-col items-center">
                                <span class="control-label">Turntable Control</span>
                                <div class="turntable-container relative">
                                    <div class="turntable-platter"></div>
                                    <div class="strobe-marks"></div>
                                    <div class="vinyl tooltip" id="vinyl1" onmousedown="startScratch(0, event)" 
                                         onmousemove="scratch(0, event)" onmouseup="stopScratch(0)">
                                        <div class="vinyl-texture"></div>
                                        <div class="vinyl-reflection"></div>
                                        <div class="vinyl-label">KIRK RADIO</div>
                                        <span class="tooltip-text">Click and drag to scratch</span>
                                    </div>
                                </div>
                                <div class="transport-controls mt-4">
                                    <button onclick="playDeck(0)" class="transport-button tooltip" id="playBtn1">
                                        <i class="fas fa-play" id="playIcon1"></i>
                                        <span class="tooltip-text">Play/Pause</span>
                                    </button>
                                    <button onclick="cuePoint(0)" class="transport-button tooltip">
                                        <i class="fas fa-flag"></i>
                                        <span class="tooltip-text">Set Cue Point</span>
                                    </button>
                                    <button onclick="skipBackward(0)" class="transport-button tooltip">
                                        <i class="fas fa-backward"></i>
                                        <span class="tooltip-text">Skip Backward</span>
                                    </button>
                                    <button onclick="skipForward(0)" class="transport-button tooltip">
                                        <i class="fas fa-forward"></i>
                                        <span class="tooltip-text">Skip Forward</span>
                                    </button>
                                </div>
                            </div>
                            <div class="flex-1">
                                <div class="mb-4">
                                    <span class="control-label">Waveform</span>
                                    <div class="waveform">
                                        <canvas id="waveform1" class="waveform-data"></canvas>
                                    </div>
                                </div>
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <span class="control-label">Tempo Control</span>
                                        <input type="range" min="60" max="200" value="128" class="slider"
                                               oninput="updateTempo(0, this.value)" title="Adjust track tempo">
                                        <div class="text-center text-sm mt-1" id="deck1Tempo">128 BPM</div>
                                    </div>
                                    <div>
                                        <span class="control-label">Key/Pitch Control</span>
                                        <input type="range" min="-12" max="12" value="0" class="slider"
                                               oninput="updateKey(0, this.value)" title="Adjust track key/pitch">
                                        <div class="text-center text-sm mt-1" id="deck1Key">Original Key</div>
                                    </div>
                                </div>
                                <div class="grid grid-cols-3 gap-4 mt-4">
                                    <div>
                                        <span class="control-label">Low EQ</span>
                                        <div class="eq-knob" id="lowEQ1" data-value="0" onclick="rotateEQ(this, 'low', 0)" title="Low Frequency EQ"></div>
                                    </div>
                                    <div>
                                        <span class="control-label">Mid EQ</span>
                                        <div class="eq-knob" id="midEQ1" data-value="0" onclick="rotateEQ(this, 'mid', 0)" title="Mid Frequency EQ"></div>
                                    </div>
                                    <div>
                                        <span class="control-label">High EQ</span>
                                        <div class="eq-knob" id="highEQ1" data-value="0" onclick="rotateEQ(this, 'high', 0)" title="High Frequency EQ"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Deck 2 -->
                    <div class="deck p-6">
                        <div class="flex justify-between mb-4">
                            <h2 class="text-xl font-medium">Deck 2</h2>
                            <div class="flex space-x-2">
                                <button onclick="toggleSync(1)" class="dj-button tooltip" title="Sync Tempo with Master">
                                    <i class="fas fa-sync"></i>
                                    <span class="tooltip-text">Sync Tempo with Master</span>
                                </button>
                                <button onclick="toggleKeyLock(1)" class="dj-button tooltip" title="Key Lock">
                                    <i class="fas fa-key"></i>
                                    <span class="tooltip-text">Lock Key When Changing Tempo</span>
                                </button>
                                <button onclick="toggleLoop(1)" class="dj-button tooltip" title="Loop Current Section">
                                    <i class="fas fa-redo"></i>
                                    <span class="tooltip-text">Loop Current Section</span>
                                </button>
                            </div>
                        </div>

                        <div class="track-info p-2 mb-4">
                            <div id="deck2Title" class="font-medium truncate">No track loaded</div>
                            <div id="deck2Artist" class="text-sm text-gray-400 truncate">--</div>
                            <div class="flex justify-between items-center mt-2 text-xs text-gray-500">
                                <span id="deck2CurrentTime">00:00</span>
                                <div class="progress-bar flex-1 mx-2">
                                    <div id="deck2Progress" class="progress-bar-fill" style="width: 0%"></div>
                                </div>
                                <span id="deck2TotalTime">00:00</span>
                            </div>
                        </div>

                        <div class="flex gap-6">
                            <div class="flex flex-col items-center">
                                <span class="control-label">Turntable Control</span>
                                <div class="turntable-container relative">
                                    <div class="turntable-platter"></div>
                                    <div class="strobe-marks"></div>
                                    <div class="vinyl tooltip" id="vinyl2" onmousedown="startScratch(1, event)" 
                                         onmousemove="scratch(1, event)" onmouseup="stopScratch(1)">
                                        <div class="vinyl-texture"></div>
                                        <div class="vinyl-reflection"></div>
                                        <div class="vinyl-label">KIRK RADIO</div>
                                        <span class="tooltip-text">Click and drag to scratch</span>
                                    </div>
                                </div>
                                <div class="transport-controls mt-4">
                                    <button onclick="playDeck(1)" class="transport-button tooltip" id="playBtn2">
                                        <i class="fas fa-play" id="playIcon2"></i>
                                        <span class="tooltip-text">Play/Pause</span>
                                    </button>
                                    <button onclick="cuePoint(1)" class="transport-button tooltip">
                                        <i class="fas fa-flag"></i>
                                        <span class="tooltip-text">Set Cue Point</span>
                                    </button>
                                    <button onclick="skipBackward(1)" class="transport-button tooltip">
                                        <i class="fas fa-backward"></i>
                                        <span class="tooltip-text">Skip Backward</span>
                                    </button>
                                    <button onclick="skipForward(1)" class="transport-button tooltip">
                                        <i class="fas fa-forward"></i>
                                        <span class="tooltip-text">Skip Forward</span>
                                    </button>
                                </div>
                            </div>
                            <div class="flex-1">
                                <div class="mb-4">
                                    <span class="control-label">Waveform</span>
                                    <div class="waveform">
                                        <canvas id="waveform2" class="waveform-data"></canvas>
                                    </div>
                                </div>
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <span class="control-label">Tempo Control</span>
                                        <input type="range" min="60" max="200" value="128" class="slider"
                                               oninput="updateTempo(1, this.value)" title="Adjust track tempo">
                                        <div class="text-center text-sm mt-1" id="deck2Tempo">128 BPM</div>
                                    </div>
                                    <div>
                                        <span class="control-label">Key/Pitch Control</span>
                                        <input type="range" min="-12" max="12" value="0" class="slider"
                                               oninput="updateKey(1, this.value)" title="Adjust track key/pitch">
                                        <div class="text-center text-sm mt-1" id="deck2Key">Original Key</div>
                                    </div>
                                </div>
                                <div class="grid grid-cols-3 gap-4 mt-4">
                                    <div>
                                        <span class="control-label">Low EQ</span>
                                        <div class="eq-knob" id="lowEQ2" data-value="0" onclick="rotateEQ(this, 'low', 1)" title="Low Frequency EQ"></div>
                                    </div>
                                    <div>
                                        <span class="control-label">Mid EQ</span>
                                        <div class="eq-knob" id="midEQ2" data-value="0" onclick="rotateEQ(this, 'mid', 1)" title="Mid Frequency EQ"></div>
                                    </div>
                                    <div>
                                        <span class="control-label">High EQ</span>
                                        <div class="eq-knob" id="highEQ2" data-value="0" onclick="rotateEQ(this, 'high', 1)" title="High Frequency EQ"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Mixer Controls -->
                <div class="flex justify-center items-center space-x-8 bg-[#1a1a1a] p-6 rounded-lg">
                    <div>
                        <span class="control-label text-center">Deck 1 Volume</span>
                        <input type="range" min="0" max="100" value="100" class="vertical-slider"
                               oninput="updateVolume(0, this.value)" title="Deck 1 Volume Control">
                        <div class="text-center text-xs mt-2" id="volume1Value">100%</div>
                    </div>
                    <div class="flex-1">
                        <span class="control-label">Crossfader</span>
                        <div class="flex items-center">
                            <span class="text-xs mr-2">Deck 1</span>
                            <input type="range" min="0" max="100" value="50" class="slider w-full"
                                   oninput="updateCrossfader(this.value)" title="Mix between Deck 1 and Deck 2">
                            <span class="text-xs ml-2">Deck 2</span>
                        </div>
                        <div class="text-center text-xs mt-2" id="crossfaderValue">Center</div>
                    </div>
                    <div>
                        <span class="control-label text-center">Deck 2 Volume</span>
                        <input type="range" min="0" max="100" value="100" class="vertical-slider"
                               oninput="updateVolume(1, this.value)" title="Deck 2 Volume Control">
                        <div class="text-center text-xs mt-2" id="volume2Value">100%</div>
                    </div>
                </div>

                <!-- FX Section -->
                <div class="bg-[#1a1a1a] p-6 rounded-lg">
                    <div class="section-label">Effects Panel</div>
                    <div class="grid grid-cols-2 gap-6">
                        <div>
                            <span class="control-label">Deck 1 Effects</span>
                            <div class="grid grid-cols-4 gap-2">
                                <div class="fx-button tooltip" onclick="toggleEffect(0, 'reverb')">
                                    Reverb
                                    <span class="tooltip-text">Apply reverb effect to Deck 1</span>
                                </div>
                                <div class="fx-button tooltip" onclick="toggleEffect(0, 'delay')">
                                    Delay
                                    <span class="tooltip-text">Apply delay effect to Deck 1</span>
                                </div>
                                <div class="fx-button tooltip" onclick="toggleEffect(0, 'flanger')">
                                    Flanger
                                    <span class="tooltip-text">Apply flanger effect to Deck 1</span>
                                </div>
                                <div class="fx-button tooltip" onclick="toggleEffect(0, 'filter')">
                                    Filter
                                    <span class="tooltip-text">Apply filter effect to Deck 1</span>
                                </div>
                            </div>
                            <div class="mt-4">
                                <span class="control-label">Effect Mix</span>
                                <input type="range" min="0" max="100" value="50" class="slider"
                                       oninput="updateEffectMix(0, this.value)" title="Adjust effect mix level">
                            </div>
                        </div>
                        <div>
                            <span class="control-label">Deck 2 Effects</span>
                            <div class="grid grid-cols-4 gap-2">
                                <div class="fx-button tooltip" onclick="toggleEffect(1, 'reverb')">
                                    Reverb
                                    <span class="tooltip-text">Apply reverb effect to Deck 2</span>
                                </div>
                                <div class="fx-button tooltip" onclick="toggleEffect(1, 'delay')">
                                    Delay
                                    <span class="tooltip-text">Apply delay effect to Deck 2</span>
                                </div>
                                <div class="fx-button tooltip" onclick="toggleEffect(1, 'flanger')">
                                    Flanger
                                    <span class="tooltip-text">Apply flanger effect to Deck 2</span>
                                </div>
                                <div class="fx-button tooltip" onclick="toggleEffect(1, 'filter')">
                                    Filter
                                    <span class="tooltip-text">Apply filter effect to Deck 2</span>
                                </div>
                            </div>
                            <div class="mt-4">
                                <span class="control-label">Effect Mix</span>
                                <input type="range" min="0" max="100" value="50" class="slider"
                                       oninput="updateEffectMix(1, this.value)" title="Adjust effect mix level">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Broadcast Status -->
                <div class="bg-[#1a1a1a] p-4 rounded-lg" id="broadcastStatus">
                    <div class="section-label">Broadcast Status</div>
                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            <div class="w-3 h-3 rounded-full bg-red-500 mr-2" id="broadcastStatusIndicator"></div>
                            <span id="broadcastStatusText">Not broadcasting</span>
                        </div>
                        <div>
                            <button id="startStopBroadcastBtn" onclick="toggleBroadcast()" class="dj-button">
                                <i class="fas fa-play-circle mr-2"></i> Start Broadcasting
                            </button>
                        </div>
                    </div>
                    <div class="text-xs text-gray-500 mt-2" id="broadcastStats">
                        Configure your Icecast settings using the Broadcast Settings button in the toolbar.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Alert Modal -->
    <div id="alertModal" class="modal">
        <div class="modal-content">
            <h3 class="text-xl font-medium mb-4" id="modalTitle">Alert</h3>
            <p id="modalMessage" class="mb-4">Message content will appear here.</p>
            <div class="flex justify-end">
                <button onclick="closeModal('alertModal')" class="dj-button">Close</button>
            </div>
        </div>
    </div>

    <script>
        let audioContext;
        let masterGain;
        const decks = [{}, {}];
        let scratching = [false, false];
        let lastY = [0, 0];
        let broadcasting = false;

        class AudioProcessor {
            constructor(context, masterNode) {
                this.context = context;
                this.masterNode = masterNode;
                this.source = null;
                this.gainNode = context.createGain();
                this.lowEQ = context.createBiquadFilter();
                this.midEQ = context.createBiquadFilter();
                this.highEQ = context.createBiquadFilter();

                // Set up filter types
                this.lowEQ.type = 'lowshelf';
                this.lowEQ.frequency.value = 320;
                this.lowEQ.gain.value = 0;

                this.midEQ.type = 'peaking';
                this.midEQ.frequency.value = 1000;
                this.midEQ.Q.value = 1;
                this.midEQ.gain.value = 0;

                this.highEQ.type = 'highshelf';
                this.highEQ.frequency.value = 3200;
                this.highEQ.gain.value = 0;

                // Connect the nodes
                this.gainNode.connect(this.lowEQ);
                this.lowEQ.connect(this.midEQ);
                this.midEQ.connect(this.highEQ);
                this.highEQ.connect(this.masterNode);

                // Initialize properties
                this.playing = false;
                this.looping = false;
                this.buffer = null;
                this.deckIndex = 0;
                this.trackTitle = "No track loaded";
                this.trackArtist = "--";
                this.duration = 0;
                this.offset = 0;
                this.startTime = 0;
            }

            loadBuffer(buffer, title = "Untitled Track", artist = "Unknown Artist") {
                this.buffer = buffer;
                this.duration = buffer.duration;
                this.trackTitle = title;
                this.trackArtist = artist;
                this.offset = 0;

                // Draw waveform
                this.drawWaveform();
                // Update the track info display
                this.updateTrackInfo();
                // Update the progress display
                this.updateProgressDisplay();
            }

            play() {
                if (!this.buffer) return;

                if (this.playing) {
                    this.pause();
                    return;
                }

                // Create a new source node
                this.source = this.context.createBufferSource();
                this.source.buffer = this.buffer;
                this.source.loop = this.looping;
                this.source.connect(this.gainNode);

                // Start playback
                this.source.start(0, this.offset);
                this.startTime = this.context.currentTime - this.offset;
                this.playing = true;

                // Update UI
                const playIcon = document.getElementById(`playIcon${this.deckIndex + 1}`);
                if (playIcon) {
                    playIcon.className = "fas fa-pause";
                }

                const vinyl = document.getElementById(`vinyl${this.deckIndex + 1}`);
                if (vinyl) {
                    vinyl.classList.add('playing');
                }

                // Start updating progress
                this.startProgressUpdate();
            }

            pause() {
                if (!this.playing || !this.source) return;

                // Stop the source and update offset
                this.source.stop(0);
                this.offset = this.context.currentTime - this.startTime;
                if (this.offset > this.duration) {
                    this.offset = 0;
                }

                this.playing = false;

                // Update UI
                const playIcon = document.getElementById(`playIcon${this.deckIndex + 1}`);
                if (playIcon) {
                    playIcon.className = "fas fa-play";
                }

                const vinyl = document.getElementById(`vinyl${this.deckIndex + 1}`);
                if (vinyl) {
                    vinyl.classList.remove('playing');
                }
            }

            startProgressUpdate() {
                if (!this.playing) return;

                requestAnimationFrame(() => this.updateProgressDisplay());
            }

            updateProgressDisplay() {
                if (!this.buffer) return;

                let currentTime;
                if (this.playing) {
                    currentTime = this.context.currentTime - this.startTime;
                    if (currentTime > this.duration) {
                        if (this.looping) {
                            this.startTime = this.context.currentTime - (currentTime % this.duration);
                            currentTime = this.context.currentTime - this.startTime;
                        } else {
                            this.pause();
                            currentTime = this.duration;
                        }
                    }
                } else {
                    currentTime = this.offset;
                }

                // Update progress bar
                const progressElement = document.getElementById(`deck${this.deckIndex + 1}Progress`);
                if (progressElement) {
                    const progressPercentage = (currentTime / this.duration) * 100;
                    progressElement.style.width = `${progressPercentage}%`;
                }

                // Update current time display
                const currentTimeElement = document.getElementById(`deck${this.deckIndex + 1}CurrentTime`);
                if (currentTimeElement) {
                    currentTimeElement.textContent = this.formatTime(currentTime);
                }

                if (this.playing) {
                    requestAnimationFrame(() => this.updateProgressDisplay());
                }
            }

            setCuePoint() {
                if (!this.buffer) return;

                if (this.playing) {
                    this.offset = this.context.currentTime - this.startTime;
                    if (this.offset > this.duration) {
                        this.offset = 0;
                    }
                } else {
                    this.updateProgressDisplay();
                }

                const cueBtn = document.querySelector(`button[onclick="cuePoint(${this.deckIndex})"]`);
                if (cueBtn) {
                    cueBtn.classList.add('active');
                    setTimeout(() => cueBtn.classList.remove('active'), 200);
                }

                const currentTimeElement = document.getElementById(`deck${this.deckIndex + 1}CurrentTime`);
                if (currentTimeElement) {
                    currentTimeElement.textContent = this.formatTime(this.offset);
                }
            }

            setPlaybackRate(rate) {
                if (this.source) {
                    this.source.playbackRate.value = rate;
                }
            }

            setVolume(value) {
                this.gainNode.gain.value = value;
                const volumeValueElement = document.getElementById(`volume${this.deckIndex + 1}Value`);
                if (volumeValueElement) {
                    volumeValueElement.textContent = `${Math.round(value * 100)}%`;
                }
            }

            setEQ(type, value) {
                const dbValue = (value / 100) * 12;

                switch(type) {
                    case 'low':
                        this.lowEQ.gain.value = dbValue;
                        break;
                    case 'mid':
                        this.midEQ.gain.value = dbValue;
                        break;
                    case 'high':
                        this.highEQ.gain.value = dbValue;
                        break;
                }
            }

            applyScratchEffect(delta) {
                const direction = delta > 0 ? 1 : -1;
                const speed = Math.min(Math.abs(delta) * 0.01, 4);
                this.setPlaybackRate(direction * speed);
            }

            toggleLoop() {
                this.looping = !this.looping;
                if (this.source) {
                    this.source.loop = this.looping;
                }
                return this.looping;
            }

            updateTrackInfo() {
                const titleElement = document.getElementById(`deck${this.deckIndex + 1}Title`);
                const artistElement = document.getElementById(`deck${this.deckIndex + 1}Artist`);
                const totalTimeElement = document.getElementById(`deck${this.deckIndex + 1}TotalTime`);

                if (titleElement) titleElement.textContent = this.trackTitle;
                if (artistElement) artistElement.textContent = this.trackArtist;
                if (totalTimeElement) totalTimeElement.textContent = this.formatTime(this.duration);
            }

            drawWaveform() {
                const canvas = document.getElementById(`waveform${this.deckIndex + 1}`);
                if (!canvas) return;

                const ctx = canvas.getContext('2d');
                const data = this.buffer.getChannelData(0);
                const width = canvas.width;
                const height = canvas.height;

                if (canvas.width !== canvas.offsetWidth) {
                    canvas.width = canvas.offsetWidth;
                    canvas.height = canvas.offsetHeight;
                }

                ctx.clearRect(0, 0, width, height);
                ctx.lineWidth = 1;
                ctx.strokeStyle = '#D46400';
                ctx.beginPath();

                const step = Math.ceil(data.length / width);
                for (let i = 0; i < width; i++) {
                    let min = 1.0;
                    let max = -1.0;
                    
                    for (let j = 0; j < step; j++) {
                        const datum = data[(i * step) + j];
                        if (datum < min) min = datum;
                        if (datum > max) max = datum;
                    }

                    const y1 = (1 + min) * height / 2;
                    const y2 = (1 + max) * height / 2;
                    ctx.moveTo(i, y1);
                    ctx.lineTo(i, y2);
                }

                ctx.stroke();
            }

            skipForward() {
                if (!this.buffer) return;

                this.offset = Math.min(this.offset + 10, this.buffer.duration);
                if (this.playing) {
                    this.pause();
                    this.play();
                } else {
                    this.updateProgressDisplay();
                }
            }
            
            skipBackward() {
                if (!this.buffer) return;

                this.offset = Math.max(this.offset - 10, 0);
                if (this.playing) {
                    this.pause();
                    this.play();
                } else {
                    this.updateProgressDisplay();
                }
            }

            formatTime(seconds) {
                const mins = Math.floor(seconds / 60);
                const secs = Math.floor(seconds % 60);
                return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            }
        }

        document.addEventListener('click', () => {
            if (!audioContext) {
                try {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    masterGain = audioContext.createGain();
                    masterGain.connect(audioContext.destination);
                    // Initialize Audio Processors
                    decks[0].processor = new AudioProcessor(audioContext, masterGain);
                    decks[1].processor = new AudioProcessor(audioContext, masterGain);
                    decks[0].processor.deckIndex = 0;
                    decks[1].processor.deckIndex = 1;
                } catch (error) {
                    console.error('Failed to initialize audio context:', error);
                    alert('Audio initialization failed. Please check your browser settings.');
                }
            }
        });

        // Additional JavaScript functions to implement event listeners and audio controls...

    </script>
</body>
</html>
