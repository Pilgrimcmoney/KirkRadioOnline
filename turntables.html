<!-- Add before closing </body> tag -->
<!-- Core scripts -->
<script src="js/config.js"></script>

<!-- Audio processing -->
<script src="js/audio.js"></script>
<script src="js/effects.js"></script>

<!-- Library and controls -->
<script src="js/library.js"></script>
<script src="js/turntable.js"></script>

<!-- Broadcasting -->
<script src="js/broadcast.js"></script>

<!-- UI and interface -->
<script src="js/ui.js"></script>

<!-- Initialize app -->
<script>
    // Global state
    let currentDeck = 0;
    let broadcasting = false;

    // Initialize components on page load
    document.addEventListener('DOMContentLoaded', () => {
        // Initialize audio system
        if (initializeAudio()) {
            // Initialize UI components
            initializeTurntables();
            
            // Load any saved settings
            loadSettings();
            
            // Setup broadcast capabilities
            initializeBroadcast();

            showToast('Virtual Turntables initialized successfully', 'success');
        } else {
            showToast('Error initializing audio system', 'error');
        }
    });

    // Handle window resize
    window.addEventListener('resize', () => {
        // Update UI layouts if needed
        if (decks[0]) decks[0].updateWaveform();
        if (decks[1]) decks[1].updateWaveform();
    });

    // Handle visibility change
    document.addEventListener('visibilitychange', () => {
        if (document.hidden) {
            // Pause animations when tab is not visible
            turntables.forEach(tt => tt.stopNormalRotation());
        } else {
            // Resume animations when tab becomes visible
            turntables.forEach((tt, i) => {
                if (decks[i] && decks[i].isPlaying) {
                    tt.startNormalRotation();
                }
            });
        }
    });
</script>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kirk Radio DJ - Professional DJ Software</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="icon" href="https://raw.githubusercontent.com/Pilgrimcmoney/KirkRadioOnline/main/favicon.svg" type="image/svg+xml">
    <style>
        :root {
            --primary: #D42F00; 
            --primary-dark: #A82600;
            --primary-light: #FF4F1F;
            --background: #111; 
            --background-dark: #0A0A0A;
            --secondary: #222; 
            --secondary-light: #2A2A2A;
            --border: #333; 
            --highlight-active: #D42F00; 
            --highlight-inactive: #555; 
            --text-primary: #fff; 
            --text-secondary: #aaa; 
            --kirk-radio-accent: #D42F00;
            --accent-glow: rgba(212, 47, 0, 0.5);
            --gradient-primary: linear-gradient(135deg, #D42F00, #FF4F1F);
            --glass-bg: rgba(26, 26, 26, 0.7);
            --glass-border: rgba(255, 255, 255, 0.1);
            --glass-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.36);
            --deck-gradient: linear-gradient(145deg, #1a1a1a, #0f0f0f);
            --control-gradient: linear-gradient(145deg, #222, #1a1a1a);
            --highlight-gradient: linear-gradient(135deg, #D42F00, #FF4F1F);
            --panel-blur: blur(12px);
        }

        body {
            background-color: var(--background); 
            color: var(--text-primary); 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; 
            position: relative; 
            min-height: 100vh; 
            overflow-x: hidden; 
            background-image: 
                url('https://raw.githubusercontent.com/Pilgrimcmoney/KirkRadioOnline/main/favicon.svg'),
                radial-gradient(circle at center, rgba(212, 47, 0, 0.08) 0%, rgba(17, 17, 17, 0) 80%);
            background-repeat: no-repeat;
            background-position: center center, center center;
            background-size: 50% auto, 100% 100%;
            background-attachment: fixed;
            background-blend-mode: soft-light, normal;
            position: relative;
        }

        /* Responsive background adjustments */
        @media (max-width: 768px) {
            body {
                background-size: 80% auto;
            }
        }
        
        /* Enhanced SVG background effect */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(to right, rgba(212, 47, 0, 0.03) 1px, transparent 1px),
                linear-gradient(to bottom, rgba(212, 47, 0, 0.03) 1px, transparent 1px);
            background-size: 20px 20px;
            z-index: -2;
            pointer-events: none;
            opacity: 0.4;
        }
        /* Overlay to make background subtle */
        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, rgba(10, 10, 10, 0.96), rgba(17, 17, 17, 0.90), rgba(10, 10, 10, 0.96));
            z-index: -1;
            pointer-events: none;
            backdrop-filter: blur(1px);
            -webkit-backdrop-filter: blur(1px);
        }
        
        /* Enhanced Panel Styling with Glassmorphism */
        .deck, .bg-\[\#1a1a1a\], .kirk-radio-panel {
            background: var(--glass-bg);
            backdrop-filter: var(--panel-blur);
            -webkit-backdrop-filter: var(--panel-blur);
            border: 1px solid var(--glass-border);
            box-shadow: var(--glass-shadow);
            border-radius: 12px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .deck:hover, .kirk-radio-panel:hover {
            box-shadow: 0 10px 40px 0 rgba(0, 0, 0, 0.5);
            border-color: rgba(212, 47, 0, 0.2);
        }
        
        .deck::before, .kirk-radio-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--highlight-gradient);
            opacity: 0.7;
            z-index: 1;
        }
        
        /* Enhanced Button Styling */
        .dj-button {
            background: var(--control-gradient);
            color: var(--text-primary);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 0.2rem 0.4rem;
            font-weight: 500;
            transition: all 0.2s ease;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
            font-size: 0.7rem;
        }
        
        .dj-button::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            background: linear-gradient(rgba(255, 255, 255, 0.1), transparent);
            opacity: 0;
            transition: opacity 0.2s ease;
            pointer-events: none;
        }
        
        .dj-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            border-color: var(--kirk-radio-accent);
        }
        
        .dj-button:hover::after {
            opacity: 1;
        }
        
        .dj-button:active {
            transform: translateY(1px);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        
        .dj-button.bg-\[\#D42F00\] {
            background: var(--highlight-gradient);
            box-shadow: 0 4px 15px rgba(212, 47, 0, 0.3);
            border-color: rgba(255, 255, 255, 0.2);
        }
        
        /* Enhanced Slider Controls */
        input[type="range"].slider {
            -webkit-appearance: none;
            background: linear-gradient(to right, rgba(26, 26, 26, 0.8), rgba(17, 17, 17, 0.8));
            border-radius: 8px;
            height: 8px;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.4);
            outline: none;
            transition: background 0.3s;
            cursor: pointer;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        input[type="range"].slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--highlight-gradient);
            box-shadow: 0 1px 5px rgba(0, 0, 0, 0.5);
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        input[type="range"].slider::-webkit-slider-thumb:hover {
            transform: scale(1.1);
            box-shadow: 0 2px 10px rgba(212, 47, 0, 0.6);
        }
        
        input[type="range"].slider::-webkit-slider-thumb:active {
            transform: scale(0.95);
        }
        
        input[type="range"].vertical-slider {
            -webkit-appearance: none;
            height: 60px;
            width: 5px;
            background: linear-gradient(to bottom, rgba(26, 26, 26, 0.8), rgba(17, 17, 17, 0.8));
            border-radius: 6px;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.4);
            outline: none;
            writing-mode: bt-lr;
            -webkit-appearance: slider-vertical;
            cursor: pointer;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        input[type="range"].vertical-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--highlight-gradient);
            box-shadow: 0 1px 5px rgba(0, 0, 0, 0.5);
            cursor: pointer;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        input[type="range"].vertical-slider::-webkit-slider-thumb:hover {
            transform: scale(1.1);
            box-shadow: 0 2px 10px rgba(212, 47, 0, 0.6);
        }
        
        /* Progress Bar Enhancement */
        .progress-bar {
            background: linear-gradient(to right, rgba(40, 40, 40, 0.8), rgba(30, 30, 30, 0.8));
            height: 6px;
            border-radius: 3px;
            overflow: hidden;
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.5);
            position: relative;
        }
        
        .progress-bar-fill {
            background: var(--highlight-gradient);
            height: 100%;
            border-radius: 3px;
            position: relative;
            box-shadow: 0 0 10px rgba(212, 47, 0, 0.5);
            transition: width 0.05s linear;
        }
        
        .progress-bar-fill::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 4px;
            height: 100%;
            background: #fff;
            opacity: 0.7;
            border-radius: 0 3px 3px 0;
        }
        
        /* Track Info Enhancement */
        .track-info {
            background: rgba(17, 17, 17, 0.7);
            border-radius: 8px;
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
        }
        
        .track-info:hover {
            background: rgba(26, 26, 26, 0.8);
            border-color: rgba(212, 47, 0, 0.3);
        }
        
        /* Section Label Enhancement */
        .section-label {
            font-size: 0.8rem;
            font-weight: 600;
            letter-spacing: 1px;
            text-transform: uppercase;
            color: var(--kirk-radio-accent);
            margin-bottom: 0.75rem;
            position: relative;
            padding-left: 14px;
        }
        
        .section-label::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 8px;
            height: 8px;
            background: var(--highlight-gradient);
            border-radius: 50%;
        }
        
        /* Enhanced Control Label */
        .control-label {
            font-size: 0.75rem;
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
            text-align: center;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }
        
        /* Your existing CSS styles go here */
        .waveform {
            background: rgba(26, 26, 26, 0.8);
            border-radius: 4px;
            padding: 10px;
            margin-bottom: 1rem;
            position: relative;
            overflow: hidden;
        }

        .waveform-data {
            width: 100%;
            height: 60px;
            background: transparent;
        }

        .waveform::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            background: linear-gradient(90deg, 
                rgba(26, 26, 26, 0.2) 0%,
                rgba(26, 26, 26, 0) 2%,
                rgba(26, 26, 26, 0) 98%,
                rgba(26, 26, 26, 0.2) 100%
            );
        }
/* Enhanced Turntable Styles */
.turntable-container {
    width: 200px;
    height: 200px;
    margin: 0 auto;
    position: relative;
}

.turntable-3d-container {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 1;
}

.turntable-platter {
    transform: rotateX(20deg) rotateY(0deg);
    transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    width: 90px; /* Further reduced platter size */
    height: 90px; /* Maintain aspect ratio */
    border-radius: 50%;
    position: relative;
    background: linear-gradient(145deg, #1e1e1e, #0a0a0a);
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3), 
                inset 0 2px 5px rgba(255, 255, 255, 0.1),
                0 0 10px var(--accent-glow);
    overflow: hidden;
}

/* 3D effect on hover */
.turntable-container:hover .turntable-platter {
    transform: rotateX(5deg) rotateY(15deg) translateZ(10px);
    box-shadow: 0 15px 25px rgba(0, 0, 0, 0.5), 
                inset 0 2px 5px rgba(255, 255, 255, 0.1),
                0 0 15px var(--accent-glow);
}

/* Add motor spindle simulation */
.turntable-platter::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 15px;
    height: 15px;
    background: linear-gradient(145deg, #333, #222);
    border-radius: 50%;
    border: 2px solid var(--kirk-radio-accent);
    box-shadow: 0 0 5px var(--accent-glow);
    z-index: 5;
}

        /* Kirk Radio Vinyl Label Styling */
        .vinyl-label {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 70%;
            height: 70%;
            border-radius: 50%;
            background-color: white;
            color: #111;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9rem;
            text-align: center;
            z-index: 2;
            background-image: url('https://raw.githubusercontent.com/Pilgrimcmoney/KirkRadioOnline/main/favicon.svg');
            background-size: 80% 80%;
            background-position: center;
            background-repeat: no-repeat;
            border: 4px solid var(--kirk-radio-accent);
            box-shadow: 0 0 10px var(--accent-glow);
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            animation: pulseLight 3s infinite alternate;
            filter: drop-shadow(0 0 2px rgba(212, 47, 0, 0.8));
        }

        .vinyl-label::before {
            content: 'KIRK RADIO';
            position: absolute;
            bottom: 10%;
            left: 0;
            width: 100%;
            text-align: center;
            font-size: 0.7rem;
            font-weight: bold;
            color: var(--kirk-radio-accent);
            letter-spacing: 1px;
            text-shadow: 0 0 2px rgba(0, 0, 0, 0.5);
            z-index: 3;
        }

.vinyl-label::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 15%;
    height: 15%;
    background-color: #111;
    border-radius: 50%;
    border: 2px solid var(--kirk-radio-accent);
    box-shadow: 0 0 5px var(--accent-glow);
    z-index: 3;
}

.vinyl {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background: radial-gradient(circle at center, #333, #222);
    display: flex;
    align-items: center;
    justify-content: center;
    transform-style: preserve-3d;
    transition: transform 0.5s ease;
    cursor: grab;
}

.vinyl:hover .vinyl-label {
    box-shadow: 0 0 20px var(--accent-glow);
    transform: translate(-50%, -50%) scale(1.05);
}

.vinyl:active {
    cursor: grabbing;
}

.vinyl-texture {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background: repeating-radial-gradient(
        circle at center,
        #111,
        #111 1px,
        #222 2px,
        #222 4px
    );
    opacity: 0.3;
    pointer-events: none;
}

.vinyl-reflection {
    position: absolute;
    top: 5%;
    left: 30%;
    width: 40%;
    height: 10%;
    border-radius: 50%;
    background: linear-gradient(to bottom, rgba(255, 255, 255, 0.2), transparent);
    transform: rotate(-30deg);
    filter: blur(3px);
    opacity: 0.5;
    pointer-events: none;
}

@keyframes pulseLight {
    0% { 
        box-shadow: 0 0 10px var(--accent-glow);
        filter: drop-shadow(0 0 2px rgba(212, 47, 0, 0.8));
    }
    100% { 
        box-shadow: 0 0 20px var(--accent-glow), 0 0 30px var(--accent-glow);
        filter: drop-shadow(0 0 4px rgba(212, 47, 0, 0.9));
    }
}

.vinyl.scratching {
    animation: scratchAnimation 0.2s linear;
}

@keyframes scratchAnimation {
    0%, 100% { transform: rotate(0); }
    25% { transform: rotate(2deg); }
    75% { transform: rotate(-2deg); }
}

/* Preload Kirk Radio logo */
.preload-images {
    position: absolute;
    width: 0;
    height: 0;
    overflow: hidden;
    z-index: -1;
}
        position: absolute;
        width: 0;
        height: 0;
        overflow: hidden;
        z-index: -1;
    }

    /* SVG enhancements */
    svg path {
        transition: all 0.3s ease;
    }
    
    .svg-container {
        display: inline-block;
        position: relative;
        width: 100%;
        padding-bottom: 100%;
        vertical-align: middle;
        overflow: hidden;
    }
    
    .svg-content {
        display: inline-block;
        position: absolute;
        top: 0;
        left: 0;
    }
            transition: all 0.3s ease;
            width: 12px;
            height: 12px;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }
        .mic-indicator.active {
            background-color: #4CAF50;
            box-shadow: 0 0 12px rgba(76, 175, 80, 0.8);
            border-color: rgba(76, 175, 80, 0.3);
            transform: scale(1.1);
        }
        
        .vu-meter-container {
            position: relative;
            width: 100%;
        }
        
        .vu-meter-label {
            font-size: 0.75rem;
            color: #ccc;
            margin-bottom: 4px;
            font-weight: 500;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }
        
        .vu-meter {
            height: 8px;
            background: linear-gradient(to right, rgba(40, 40, 40, 0.6), rgba(30, 30, 30, 0.6));
            border-radius: 4px;
            overflow: hidden;
            position: relative;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
        }
        
        .vu-meter::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(
                90deg,
                transparent,
                transparent 5px,
                rgba(255, 255, 255, 0.03) 5px,
                rgba(255, 255, 255, 0.03) 6px
            );
            pointer-events: none;
            z-index: 1;
        }
        
        .vu-meter-fill {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, 
                rgba(76, 175, 80, 0.9), 
                rgba(76, 175, 80, 0.9) 60%, 
                rgba(255, 193, 7, 0.9) 70%, 
                rgba(255, 193, 7, 0.9) 85%, 
                rgba(244, 67, 54, 0.9) 90%,
                rgba(244, 67, 54, 0.9) 100%
            );
            transition: width 0.1s ease-out;
            position: relative;
            transform-origin: left center;
            animation: pulseGlow 2s infinite alternate;
        }
        
        .vu-meter-peak-indicator {
        .vu-meter-peak-indicator {
            position: absolute;
            top: 0;
            right: 0;
            opacity: 0;
            transition: right 0.3s ease-out, opacity 0.3s ease;
            box-shadow: 0 0 5px rgba(255, 255, 255, 0.8), 0 0 10px rgba(255, 0, 0, 0.5);
            z-index: 10;
            border-radius: 0 6px 6px 0;
            height: 100%;
            width: 2px;
            background-color: rgba(255, 255, 255, 0.9);
        }
        .vu-meter-peak-indicator.active {
            animation: peakPulse 1.5s ease-in-out infinite;
        }
        
        @keyframes peakPulse {
            0%, 100% { box-shadow: 0 0 5px rgba(255, 255, 255, 0.8), 0 0 10px rgba(255, 0, 0, 0.5); }
            50% { box-shadow: 0 0 8px rgba(255, 255, 255, 0.9), 0 0 15px rgba(255, 0, 0, 0.7); }
        }
        
        @keyframes pulseGlow {
            0% { box-shadow: 0 0 5px rgba(76, 175, 80, 0.3); }
            100% { box-shadow: 0 0 10px rgba(76, 175, 80, 0.6); }
        }
        
        .on-air-text {
            color: #555;
            font-weight: bold;
            font-size: 0.85rem;
            padding: 0.15rem 0.5rem;
            border-radius: 4px;
            border: 2px solid #555;
            letter-spacing: 1px;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: inset 0 0 0 rgba(255, 0, 0, 0);
            text-shadow: 0 0 0 rgba(255, 0, 0, 0);
            position: relative;
            overflow: hidden;
            display: inline-block;
        }
        
        .on-air-text::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, rgba(255, 0, 0, 0) 0%, rgba(255, 0, 0, 0.1) 50%, rgba(255, 0, 0, 0) 100%);
            transform: translateX(-100%);
            transition: transform 0.3s ease;
        }
        
        .on-air-text.active {
            color: #FF0000;
            border-color: #FF0000;
            background-color: rgba(255, 0, 0, 0.1);
            animation: pulseLive 1.5s ease-in-out infinite;
            box-shadow: 0 0 15px rgba(255, 0, 0, 0.4), inset 0 0 8px rgba(255, 0, 0, 0.3);
            text-shadow: 0 0 10px rgba(255, 0, 0, 0.5);
        }
        
        .on-air-text.active::after {
            animation: shimmer 2s infinite;
        }
        
        @keyframes pulseLive {
            0%, 100% { opacity: 1; text-shadow: 0 0 10px rgba(255, 0, 0, 0.5); }
            50% { opacity: 0.7; text-shadow: 0 0 5px rgba(255, 0, 0, 0.3); }
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        /* Active control button states */
        .dj-button.active {
            background: var(--highlight-gradient);
            border-color: rgba(255, 255, 255, 0.2);
            box-shadow: 0 0 15px rgba(212, 47, 0, 0.4);
            transform: translateY(-1px);
            transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        .dj-button.active:hover {
            box-shadow: 0 0 20px rgba(212, 47, 0, 0.6);
        }
        /* Style for active buttons */
        .dj-button.active {
            background: var(--highlight-gradient);
            border-color: rgba(255, 255, 255, 0.2);
            box-shadow: 0 0 15px rgba(212, 47, 0, 0.4);
            transform: translateY(-1px);
            transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        /* Connection status styling */
        .connection-status {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #666;
            display: inline-block;
            transition: background-color 0.3s ease;
        }

        .connection-status.connected {
            background-color: #4CAF50;
            box-shadow: 0 0 5px rgba(76, 175, 80, 0.5);
        }

        .dropdown {
            position: relative;
            display: inline-block;
        }

        /* Hover effect for connection status */
        .dj-button:hover .connection-status {
            transform: scale(1.2);
        }
        .kirk-radio-panel {
            position: relative;
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border-color: rgba(212, 47, 0, 0.2);
        }
        
        .kirk-radio-panel:hover {
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), 0 0 15px rgba(212, 47, 0, 0.2);
            transform: translateY(-2px);
        }
        
        .kirk-radio-panel::before {
            content: '';
            position: absolute;
            top: 10px;
            right: 10px;
            width: 50px;
            width: 50px;
            height: 50px;
            background-image: url('https://raw.githubusercontent.com/Pilgrimcmoney/KirkRadioOnline/main/favicon.svg');
            background-size: contain;
            background-repeat: no-repeat;
            opacity: 0.3;
            z-index: 1;
            filter: drop-shadow(0 0 2px rgba(212, 47, 0, 0.3));
        
        @media (max-width: 768px) {
            .kirk-radio-panel::before {
                width: 30px;
                height: 30px;
                top: 5px;
                right: 5px;
            }
        }
    </style>
</head>
<body>
    <!-- Preload images -->
    <div class="preload-images">
        <img src="https://raw.githubusercontent.com/Pilgrimcmoney/KirkRadioOnline/main/favicon.svg" alt="Kirk Radio Logo">
    </div>
    <div class="menu">
    <button onclick="saveMix()" class="menu-button">Save Mix</button>
    <button onclick="loadTrack()" class="menu-button">Load Track</button>
    <button onclick="openLibraryFolder()" class="menu-button">Open Library Folder</button>
    <button onclick="createPlaylist()" class="menu-button">New Playlist</button>
</div>
    <div class="flex h-screen">
        <!-- Left Sidebar - Track Library -->
        <div class="bg-[#1a1a1a] border-r border-[#333] flex flex-col" style="min-width: 260px; max-width: 260px; overflow-x: hidden;">
            <div class="p-1 border-b border-[#333]">
                <h2 class="text-sm font-medium mb-0.5 flex items-center">
                    <i class="fas fa-music mr-1 text-[#D42F00]"></i> Track Library
                </h2>
                <div class="relative">
                    <input type="text" 
                           placeholder="Search tracks..." 
                           class="w-full bg-[#222] border border-[#333] rounded px-2 py-0.5 pl-6 text-white text-xs"
                           onkeyup="searchTracks(this.value)">
                    <i class="fas fa-search absolute left-2 top-1 text-gray-500 text-xs"></i>
                </div>
            </div>
            <div class="flex-1 overflow-y-auto p-0.5" id="trackList" style="max-height: calc(100vh - 480px);">
                <div class="text-center text-gray-500 mt-4">
                    <p class="text-xs">No tracks loaded</p>
                    <p class="mt-1 text-xs">Use "Load Track" button or click "Music Database"</p>
                </div>
            </div>
            <div class="bg-[#222] p-2 rounded-lg m-1 border border-[#333] shadow-inner">
                <h3 class="section-label text-xs flex items-center">
                    <i class="fas fa-list-ul mr-1"></i> Playlist Panel
                </h3>
                <div id="playlistContainer" class="overflow-y-auto max-h-52">
                    <div class="text-center text-gray-500 my-2">
                        <p class="text-xs">No playlists created</p>
                        <p class="text-xs mt-1">Create a playlist to organize your tracks</p>
                    </div>
                </div>
                <div class="mt-2 text-center">
                    <button onclick="createPlaylist()" class="dj-button text-xs py-1">
                        <i class="fas fa-plus mr-1"></i> Create New Playlist
                    </button>
                </div>
                <div class="mt-2">
                    <p class="text-xs font-medium text-[#D42F00] mb-1">
                        <i class="fas fa-info-circle mr-1"></i> How to use:
                    </p>
                    <ul class="text-xs text-gray-300 ml-2">
                        <li class="mb-0.5"><i class="fas fa-angle-right mr-1"></i> Create playlists to organize tracks</li>
                        <li class="mb-0.5"><i class="fas fa-angle-right mr-1"></i> Drag songs from library to playlists</li>
                        <li class="mb-0.5"><i class="fas fa-angle-right mr-1"></i> Double-click to load a track to a deck</li>
                    </ul>
                </div>
            </div>
            <div class="p-1 border-t border-[#333]">
                <button onclick="openLibraryFolder()" class="dj-button w-full mb-1 tooltip py-0.5 text-xs">
                    <i class="fas fa-folder-open mr-1"></i> Open Library Folder
                    <span class="tooltip-text">Open a folder to import multiple tracks at once</span>
                </button>
                <div class="flex gap-1 mb-1">
                    <button onclick="createPlaylist()" class="dj-button flex-1 tooltip py-0.5 text-xs">
                        <i class="fas fa-plus mr-1"></i> New Playlist
                        <span class="tooltip-text">Create a new playlist</span>
                    </button>
                    <button onclick="exportLibrary()" class="dj-button flex-1 tooltip py-0.5 text-xs">
                        <i class="fas fa-file-export mr-1"></i> Export
                        <span class="tooltip-text">Export your track library</span>
                    </button>
                </div>
                
                <!-- Enhanced Music Services Section -->
                <div class="section-label mb-0.5 text-xs flex items-center justify-between">
                    <span>Music Services</span>
                    <span class="text-xs font-normal text-gray-400" id="servicesConnected">0/6 Connected</span>
                </div>
                
                <!-- Music Service Connection Status Panel -->
                <div class="bg-[#222] p-2 rounded-lg border border-[#333] mb-2">
                    <div class="text-xs mb-2">Service Status</div>
                    <div class="grid grid-cols-3 gap-1">
                        <div class="service-status-item" id="googleStatus">
                            <i class="fab fa-google-drive text-gray-500"></i>
                            <span class="connection-status" title="Google Drive: Disconnected"></span>
                        </div>
                        <div class="service-status-item" id="oneDriveStatus">
                            <i class="fab fa-microsoft text-gray-500"></i>
                            <span class="connection-status" title="OneDrive: Disconnected"></span>
                        </div>
                        <div class="service-status-item" id="youtubeStatus">
                            <i class="fab fa-youtube text-gray-500"></i>
                            <span class="connection-status" title="YouTube: Disconnected"></span>
                        </div>
                        <div class="service-status-item" id="spotifyStatus">
                            <i class="fab fa-spotify text-gray-500"></i>
                            <span class="connection-status" title="Spotify: Disconnected"></span>
                        </div>
                        <div class="service-status-item" id="soundCloudStatus">
                            <i class="fab fa-soundcloud text-gray-500"></i>
                            <span class="connection-status" title="SoundCloud: Disconnected"></span>
                        </div>
                        <div class="service-status-item" id="appleMusicStatus">
                            <i class="fab fa-apple text-gray-500"></i>
                            <span class="connection-status" title="Apple Music: Disconnected"></span>
                        </div>
                    </div>
                </div>
                
                <!-- Quick Access Music Service Buttons -->
                <div class="space-y-1">
                    <button onclick="connectGoogleDrive()" class="dj-button w-full flex items-center justify-between py-0.5 text-xs" id="googleDriveBtn">
                        <div><i class="fab fa-google-drive mr-0.5"></i> Google Drive</div>
                        <span class="connection-status"></span>
                    </button>
                    <button onclick="connectOneDrive()" class="dj-button w-full flex items-center justify-between py-0.5 text-xs" id="oneDriveBtn">
                        <div><i class="fab fa-microsoft mr-1"></i> OneDrive</div>
                        <span class="connection-status"></span>
                    </button>
                    <button onclick="connectYouTube()" class="dj-button w-full flex items-center justify-between py-0.5 text-xs" id="youtubeBtn">
                        <div><i class="fab fa-youtube mr-1"></i> YouTube</div>
                        <span class="connection-status"></span>
                    </button>
                    <button onclick="connectSpotify()" class="dj-button w-full flex items-center justify-between py-0.5 text-xs" id="spotifyBtn">
                        <div><i class="fab fa-spotify mr-1"></i> Spotify</div>
                        <span class="connection-status"></span>
                    </button>
                    <button onclick="connectSoundCloud()" class="dj-button w-full flex items-center justify-between py-0.5 text-xs" id="soundCloudBtn">
                        <div><i class="fab fa-soundcloud mr-1"></i> SoundCloud</div>
                        <span class="connection-status"></span>
                    </button>
                    <button onclick="connectAppleMusic()" class="dj-button w-full flex items-center justify-between py-0.5 text-xs" id="appleMusicBtn">
                        <div><i class="fab fa-apple mr-1"></i> Apple Music</div>
                        <span class="connection-status"></span>
                    </button>
                    <button onclick="browseMusicDatabase()" class="dj-button w-full flex items-center justify-between py-0.5 text-xs bg-[#D42F00]">
                        <div><i class="fas fa-database mr-1"></i> Music Database</div>
                        <span class="tooltip-text">Browse our extensive online music collection</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="flex-1 flex flex-col bg-[#111] overflow-hidden">
            <!-- Top Toolbar -->
            <div class="bg-[#1a1a1a] border-b border-[#333] p-1">
                <div class="flex items-center justify-between">
                    <div class="flex space-x-1">
                        <button onclick="saveMix()" class="dj-button tooltip text-xs py-0.5 px-1.5">
                            <i class="fas fa-save mr-1"></i> Save Mix
                            <span class="tooltip-text">Save the current mix session</span>
                        </button>
                        <button id="loadTrackBtn" onclick="loadTrack()" class="dj-button tooltip text-xs py-0.5 px-1.5">
                            <i class="fas fa-file-audio mr-1"></i> Load Track
                            <span class="tooltip-text">Load an audio track</span>
                        </button>
                        <div class="dropdown relative">
                            <button id="broadcastBtn" onclick="toggleBroadcastSettings()" class="dj-button tooltip text-xs py-0.5 px-1.5">
                                <i class="fas fa-broadcast-tower mr-1"></i> Broadcast
                                <span class="tooltip-text">Configure broadcasting</span>
                            </button>
                            <div id="broadcastSettings" class="dropdown-content">
                                <!-- Broadcast settings content -->
                                <div class="p-4">
                                    <!-- Your broadcast settings inputs here -->
                                </div>
                            </div>
                        </div>
                        <div class="dropdown relative">
                            <button id="settingsBtn" onclick="toggleDropdownMenu('settingsDropdown')" class="dj-button tooltip text-xs py-0.5 px-1.5">
                                <i class="fas fa-cog mr-1"></i> Settings
                            </button>
                            <div id="appSettings" class="dropdown-content">
                                <!-- App settings content -->
                                <div class="p-4">
                                    <!-- Your app settings inputs here -->
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="flex items-center space-x-2">
                        <div class="flex items-center">
                            <span class="control-label text-xs mr-1">Tempo:</span>
                            <input type="range" min="60" max="200" value="128" class="slider w-24" oninput="updateMasterTempo(this.value)">
                            <span class="text-white text-xs ml-1" id="tempoValue">128</span>
                        </div>
                        <div class="flex items-center">
                            <i class="fas fa-volume-up text-white text-xs mr-1"></i>
                            <input type="range" min="0" max="100" value="100" class="slider w-16" oninput="updateMasterVolume(this.value)">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Decks -->
            <div class="flex-1 p-1 space-y-2 overflow-y-auto">
                <div class="grid grid-cols-2 gap-1">
                    <!-- Deck 1 -->
                    <div class="deck p-1">
                        <div class="flex justify-between mb-1">
                            <h2 class="text-sm font-medium">Deck 1</h2>
                            <div class="flex space-x-2">
                                <button onclick="toggleSync(0)" class="dj-button tooltip" title="Sync Tempo with Master">
                                    <i class="fas fa-sync"></i>
                                    <span class="tooltip-text">Sync Tempo with Master</span>
                                </button>
                                <button onclick="toggleKeyLock(0)" class="dj-button tooltip" title="Key Lock">
                                    <i class="fas fa-key"></i>
                                    <span class="tooltip-text">Lock Key When Changing Tempo</span>
                                </button>
                                <button onclick="toggleLoop(0)" class="dj-button tooltip" title="Loop Current Section">
                                    <i class="fas fa-redo"></i>
                                    <span class="tooltip-text">Loop Current Section</span>
                                </button>
                            </div>
                        </div>
                        <div class="track-info p-1 mb-1 text-xs">
                            <div id="deck1Title" class="font-medium truncate">No track loaded</div>
                            <div id="deck1Artist" class="text-xs text-gray-400 truncate">--</div>
                            <div class="flex justify-between items-center mt-2 text-xs text-gray-500">
                                <span id="deck1CurrentTime">00:00</span>
                                <div class="progress-bar flex-1 mx-2">
                                    <div id="deck1Progress" class="progress-bar-fill" style="width: 0%"></div>
                                </div>
                                <span id="deck1TotalTime">00:00</span>
                            </div>
                        </div>
                        <div class="flex gap-1">
                            <div class="flex flex-col items-center">
                                <span class="control-label text-xs">Turntable Control</span>
                                <div class="turntable-container relative">
                                    <div id="turntable3d1" class="turntable-3d-container"></div>
                                    <div class="turntable-platter"></div>
                                    <div class="strobe-marks"></div>
                                    <div class="vinyl tooltip" id="vinyl1" onmousedown="startScratch(0, event)" 
                                         onmousemove="scratch(0, event)" onmouseup="stopScratch(0)">
                                        <div class="vinyl-texture"></div>
                                        <div class="vinyl-reflection"></div>
                                        <div class="vinyl-label"></div>
                                        <span class="tooltip-text">Click and drag to scratch</span>
                                    </div>
                                </div>
                                <div class="transport-controls mt-2">
                                    <button onclick="playDeck(0)" class="transport-button tooltip" id="playBtn1">
                                        <i class="fas fa-play" id="playIcon1"></i>
                                        <span class="tooltip-text">Play/Pause</span>
                                    </button>
                                    <button onclick="cuePoint(0)" class="transport-button tooltip">
                                        <i class="fas fa-flag"></i>
                                        <span class="tooltip-text">Set Cue Point</span>
                                    </button>
                                    <button onclick="skipBackward(0)" class="transport-button tooltip">
                                        <i class="fas fa-backward"></i>
                                        <span class="tooltip-text">Skip Backward</span>
                                    </button>
                                    <button onclick="skipForward(0)" class="transport-button tooltip">
                                        <i class="fas fa-forward"></i>
                                        <span class="tooltip-text">Skip Forward</span>
                                    </button>
                                </div>
                            </div>
                            <div class="flex-1">
                                <div class="mb-2">
                                    <span class="control-label text-xs">Waveform</span>
                                    <div class="waveform">
                                        <canvas id="waveform1" class="waveform-data" width="400" height="100"></canvas>
                                    </div>
                                </div>
                                <div class="grid grid-cols-2 gap-2">
                                    <div>
                                        <span class="control-label text-xs">Tempo Control</span>
                                        <input type="range" min="60" max="200" value="128" class="slider"
                                               oninput="updateTempo(0, this.value)" title="Adjust track tempo">
                                        <div class="text-center text-xs mt-1" id="deck1Tempo">128 BPM</div>
                                    </div>
                                    <div>
                                        <span class="control-label text-xs">Key/Pitch Control</span>
                                        <input type="range" min="-12" max="12" value="0" class="slider"
                                               oninput="updateKey(0, this.value)" title="Adjust track key/pitch">
                                        <div class="text-center text-xs mt-1" id="deck1Key">Original Key</div>
                                    </div>
                                </div>
                                <div class="grid grid-cols-3 gap-2 mt-2">
                                    <div>
                                        <span class="control-label text-xs">Low EQ</span>
                                        <div class="eq-knob" id="lowEQ1" data-value="0" onclick="rotateEQ(this, 'low', 0)" title="Low Frequency EQ"></div>
                                    </div>
                                    <div>
                                        <span class="control-label text-xs">Mid EQ</span>
                                        <div class="eq-knob" id="midEQ1" data-value="0" onclick="rotateEQ(this, 'mid', 0)" title="Mid Frequency EQ"></div>
                                    </div>
                                    <div>
                                        <span class="control-label text-xs">High EQ</span>
                                        <div class="eq-knob" id="highEQ1" data-value="0" onclick="rotateEQ(this, 'high', 0)" title="High Frequency EQ"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Deck 2 -->
                    <div class="deck p-1">
                        <div class="flex justify-between mb-1">
                            <h2 class="text-sm font-medium">Deck 2</h2>
                            <div class="flex space-x-2">
                                <button onclick="toggleSync(1)" class="dj-button tooltip" title="Sync Tempo with Master">
                                    <i class="fas fa-sync"></i>
                                    <span class="tooltip-text">Sync Tempo with Master</span>
                                </button>
                                <button onclick="toggleKeyLock(1)" class="dj-button tooltip" title="Key Lock">
                                    <i class="fas fa-key"></i>
                                    <span class="tooltip-text">Lock Key When Changing Tempo</span>
                                </button>
                                <button onclick="toggleLoop(1)" class="dj-button tooltip" title="Loop Current Section">
                                    <i class="fas fa-redo"></i>
                                    <span class="tooltip-text">Loop Current Section</span>
                                </button>
                            </div>
                        </div>

                        <div class="track-info p-1 mb-1 text-xs">
                            <div id="deck2Title" class="font-medium truncate">No track loaded</div>
                            <div id="deck2Artist" class="text-xs text-gray-400 truncate">--</div>
                            <div class="flex justify-between items-center mt-2 text-xs text-gray-500">
                                <span id="deck2CurrentTime">00:00</span>
                                <div class="progress-bar flex-1 mx-2">
                                    <div id="deck2Progress" class="progress-bar-fill" style="width: 0%"></div>
                                </div>
                                <span id="deck2TotalTime">00:00</span>
                            </div>
                        </div>

                        <div class="flex gap-1">
                            <div class="flex flex-col items-center">
                                <span class="control-label text-xs">Turntable Control</span>
                                <div class="turntable-container relative">
                                    <div id="turntable3d2" class="turntable-3d-container"></div>
                                    <div class="turntable-platter"></div>
                                    <div class="strobe-marks"></div>
                                    <div class="vinyl tooltip" id="vinyl2" onmousedown="startScratch(1, event)" 
                                         onmousemove="scratch(1, event)" onmouseup="stopScratch(1)">
                                        <div class="vinyl-texture"></div>
                                        <div class="vinyl-reflection"></div>
                                        <div class="vinyl-label"></div>
                                        <span class="tooltip-text">Click and drag to scratch</span>
                                    </div>
                                </div>
                                <div class="transport-controls mt-2">
                                    <button onclick="playDeck(1)" class="transport-button tooltip" id="playBtn2">
                                        <i class="fas fa-play" id="playIcon2"></i>
                                        <span class="tooltip-text">Play/Pause</span>
                                    </button>
                                    <button onclick="cuePoint(1)" class="transport-button tooltip">
                                        <i class="fas fa-flag"></i>
                                        <span class="tooltip-text">Set Cue Point</span>
                                    </button>
                                    <button onclick="skipBackward(1)" class="transport-button tooltip">
                                        <i class="fas fa-backward"></i>
                                        <span class="tooltip-text">Skip Backward</span>
                                    </button>
                                    <button onclick="skipForward(1)" class="transport-button tooltip">
                                        <i class="fas fa-forward"></i>
                                        <span class="tooltip-text">Skip Forward</span>
                                    </button>
                                </div>
                            </div>
                            <div class="flex-1">
                                <div class="mb-4">
                                    <span class="control-label">Waveform</span>
                                    <div class="waveform">
                                        <canvas id="waveform2" class="waveform-data" width="400" height="100"></canvas>
                                    </div>
                                </div>
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <span class="control-label">Tempo Control</span>
                                        <input type="range" min="60" max="200" value="128" class="slider"
                                               oninput="updateTempo(1, this.value)" title="Adjust track tempo">
                                        <div class="text-center text-sm mt-1" id="deck2Tempo">128 BPM</div>
                                    </div>
                                    <div>
                                        <span class="control-label">Key/Pitch Control</span>
                                        <input type="range" min="-12" max="12" value="0" class="slider"
                                               oninput="updateKey(1, this.value)" title="Adjust track key/pitch">
                                        <div class="text-center text-sm mt-1" id="deck2Key">Original Key</div>
                                    </div>
                                </div>
                                <div class="grid grid-cols-3 gap-4 mt-4">
                                    <div>
                                        <span class="control-label">Low EQ</span>
                                        <div class="eq-knob" id="lowEQ2" data-value="0" onclick="rotateEQ(this, 'low', 1)" title="Low Frequency EQ"></div>
                                    </div>
                                    <div>
                                        <span class="control-label">Mid EQ</span>
                                        <div class="eq-knob" id="midEQ2" data-value="0" onclick="rotateEQ(this, 'mid', 1)" title="Mid Frequency EQ"></div>
                                    </div>
                                    <div>
                                        <span class="control-label">High EQ</span>
                                        <div class="eq-knob" id="highEQ2" data-value="0" onclick="rotateEQ(this, 'high', 1)" title="High Frequency EQ"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Mixer Controls -->
                <div class="flex justify-center items-center space-x-4 bg-[#1a1a1a] p-2 rounded-lg">
                    <div>
                        <span class="control-label text-center">Deck 1 Volume</span>
                        <input type="range" min="0" max="100" value="100" class="vertical-slider"
                               oninput="updateVolume(0, this.value)" title="Deck 1 Volume Control">
                        <div class="text-center text-xs mt-2" id="volume1Value">100%</div>
                    </div>
                    <div class="flex-1">
                        <span class="control-label">Crossfader</span>
                        <div class="flex items-center">
                            <span class="text-xs mr-2">Deck 1</span>
                            <input type="range" min="0" max="100" value="50" class="slider w-full"
                                   oninput="updateCrossfader(this.value)" title="Mix between Deck 1 and Deck 2">
                            <span class="text-xs ml-2">Deck 2</span>
                        </div>
                        <div class="text-center text-xs mt-2" id="crossfaderValue">Center</div>
                    </div>
                    <div>
                        <span class="control-label text-center">Deck 2 Volume</span>
                        <input type="range" min="0" max="100" value="100" class="vertical-slider"
                               oninput="updateVolume(1, this.value)" title="Deck 2 Volume Control">
                        <div class="text-center text-xs mt-2" id="volume2Value">100%</div>
                    </div>
                </div>

                <!-- FX Section -->
                <div class="bg-[#1a1a1a] p-2 rounded-lg">
                    <div class="section-label">Effects Panel</div>
                    <div class="grid grid-cols-2 gap-2">
                        <div>
                            <span class="control-label">Deck 1 Effects</span>
                            <div class="grid grid-cols-4 gap-2">
                                <div class="fx-button tooltip" onclick="toggleEffect(0, 'reverb')">
                                    Reverb
                                    <span class="tooltip-text">Apply reverb effect to Deck 1</span>
                                </div>
                                <div class="fx-button tooltip" onclick="toggleEffect(0, 'delay')">
                                    Delay
                                    <span class="tooltip-text">Apply delay effect to Deck 1</span>
                                </div>
                                <div class="fx-button tooltip" onclick="toggleEffect(0, 'flanger')">
                                    Flanger
                                    <span class="tooltip-text">Apply flanger effect to Deck 1</span>
                                </div>
                                <div class="fx-button tooltip" onclick="toggleEffect(0, 'filter')">
                                    Filter
                                    <span class="tooltip-text">Apply filter effect to Deck 1</span>
                                </div>
                            </div>
                            <div class="mt-4">
                                <span class="control-label">Effect Mix</span>
                                <input type="range" min="0" max="100" value="50" class="slider"
                                       oninput="updateEffectMix(0, this.value)" title="Adjust effect mix level">
                            </div>
                        </div>
                        <div>
                            <span class="control-label">Deck 2 Effects</span>
                            <div class="grid grid-cols-4 gap-2">
                                <div class="fx-button tooltip" onclick="toggleEffect(1, 'reverb')">
                                    Reverb
                                    <span class="tooltip-text">Apply reverb effect to Deck 2</span>
                                </div>
                                <div class="fx-button tooltip" onclick="toggleEffect(1, 'delay')">
                                    Delay
                                    <span class="tooltip-text">Apply delay effect to Deck 2</span>
                                </div>
                                <div class="fx-button tooltip" onclick="toggleEffect(1, 'flanger')">
                                    Flanger
                                    <span class="tooltip-text">Apply flanger effect to Deck 2</span>
                                </div>
                                <div class="fx-button tooltip" onclick="toggleEffect(1, 'filter')">
                                    Filter
                                    <span class="tooltip-text">Apply filter effect to Deck 2</span>
                                </div>
                            </div>
                            <div class="mt-4">
                                <span class="control-label">Effect Mix</span>
                                <input type="range" min="0" max="100" value="50" class="slider"
                                       oninput="updateEffectMix(1, this.value)" title="Adjust effect mix level">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Broadcast Status -->
                <!-- Broadcast Controls and Status -->
                <div class="bg-[#1a1a1a] p-2 rounded-lg kirk-radio-panel broadcast-panel" id="broadcastStatus">
                    <div class="section-label">Broadcast Controls</div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-2 mb-2">
                        <!-- Mic Controls -->
                        <div class="p-2 bg-[#222] rounded-lg transition-all duration-300 hover:bg-[#2a2a2a] mic-control-panel">
                            <div class="flex items-center justify-between mb-2">
                                <div class="flex items-center">
                                    <div class="text-sm font-medium">Microphone</div>
                                    <div class="w-2 h-2 rounded-full ml-2 mic-indicator" id="micStatusIndicator"></div>
                                </div>
                                <div>
                                    <button id="micToggleBtn" onclick="toggleMic()" class="dj-button text-xs py-0.5 px-1">
                                        <i class="fas fa-microphone mr-2"></i> Mic OFF
                                    </button>
                                </div>
                            </div>
                            <!-- Mic VU Meter -->
                            <div class="vu-meter-container mt-2">
                                <div class="vu-meter-label">Level</div>
                                <div class="vu-meter">
                                    <div class="vu-meter-fill" id="micLevelMeter"></div>
                                </div>
                                <div class="vu-meter-peak-indicator" id="micPeakIndicator"></div>
                            </div>
                            <div class="flex justify-between mt-2">
                                <div class="text-xs text-gray-400">-40dB</div>
                                <div class="text-xs text-gray-400">-20dB</div>
                                <div class="text-xs text-gray-400">-10dB</div>
                                <div class="text-xs text-gray-400">0dB</div>
                            </div>
                        </div>
                        
                        <!-- ON AIR Controls -->
                        <div class="p-2 bg-[#222] rounded-lg transition-all duration-300 hover:bg-[#2a2a2a] on-air-control-panel">
                            <div class="flex items-center justify-between mb-3">
                                <div class="flex items-center">
                                    <div class="on-air-text text-sm" id="onAirIndicator">ON AIR</div>
                                </div>
                                <div>
                                    <button id="onAirToggleBtn" onclick="toggleOnAir()" class="dj-button bg-[#D42F00]">
                                        <i class="fas fa-broadcast-tower mr-2"></i> Start Live
                                    </button>
                                </div>
                            </div>
                            <!-- Master Output VU Meter -->
                            <div class="vu-meter-container mt-2">
                                <div class="vu-meter-label">Output</div>
                                <div class="vu-meter">
                                    <div class="vu-meter-fill" id="outputLevelMeter"></div>
                                </div>
                                <div class="vu-meter-peak-indicator" id="outputPeakIndicator"></div>
                            </div>
                            <div class="flex justify-between mt-2">
                                <div class="text-xs text-gray-400">-40dB</div>
                                <div class="text-xs text-gray-400">-20dB</div>
                                <div class="text-xs text-gray-400">-10dB</div>
                                <div class="text-xs text-gray-400">0dB</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Broadcast Status Info -->
                    <div class="flex flex-col md:flex-row md:items-center justify-between bg-[#222] p-3 rounded-lg transition-all duration-300 hover:bg-[#2a2a2a] broadcast-status-panel">
                        <div class="flex items-center">
                            <div class="w-3 h-3 rounded-full bg-red-500 mr-2" id="broadcastStatusIndicator"></div>
                            <span id="broadcastStatusText">Not broadcasting</span>
                        </div>
                        <div class="mt-2 md:mt-0">
                            <button id="startStopBroadcastBtn" onclick="toggleBroadcast()" class="dj-button">
                                <i class="fas fa-play-circle mr-2"></i> Start Broadcasting
                            </button>
                        </div>
                    </div>
                    <div class="text-xs text-gray-500 mt-2" id="broadcastStats">
                        Configure your Icecast settings using the Broadcast Settings button in the toolbar.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="alertModal" class="modal">
        <div class="modal-content">
            <h3 class="text-xl font-medium mb-4" id="modalTitle">Alert</h3>
            <p id="modalMessage" class="mb-4">Message content will appear here.</p>
            <div class="flex justify-end">
                <button onclick="closeModal('alertModal')" class="dj-button">Close</button>
            </div>
        </div>
    </div>

    <!-- Music Service Login Modals -->
    <div id="musicServiceModals" class="modal-container">
        <!-- Google Drive Login Modal -->
        <div id="googleDriveModal" class="modal">
            <div class="modal-content bg-[#1a1a1a] p-4 rounded-lg max-w-md mx-auto">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-xl font-medium flex items-center">
                        <i class="fab fa-google-drive mr-2 text-[#4285F4]"></i> Google Drive Login
                    </h3>
                    <button onclick="closeModal('googleDriveModal')" class="text-gray-400 hover:text-white">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <!-- Connection Status Indicator -->
                <div class="bg-[#222] p-3 rounded-lg mb-4">
                    <div class="flex items-center">
                        <div id="googleDriveConnStatus" class="connection-status mr-2"></div>
                        <span id="googleDriveStatusText" class="text-sm">Not connected</span>
                    </div>
                    <div id="googleDriveErrorMsg" class="text-red-500 text-xs mt-2 hidden">
                        Connection error: Please check your credentials and try again.
                    </div>
                </div>
                
                <form id="googleDriveLoginForm" class="space-y-3">
                    <div>
                        <label class="text-xs">Email</label>
                        <input type="email" id="googleDriveEmail" 
                               class="w-full bg-[#333] border border-[#444] rounded p-2 text-sm"
                               placeholder="your.email@gmail.com">
                    </div>
                    <div>
                        <label class="text-xs">Password</label>
                        <input type="password" id="googleDrivePassword" 
                               class="w-full bg-[#333] border border-[#444] rounded p-2 text-sm"
                               placeholder="•••••••••••">
                    </div>
                    
                    <div class="flex items-center">
                        <input type="checkbox" id="googleDriveRemember" class="mr-2">
                        <label for="googleDriveRemember" class="text-xs text-gray-300">Remember me</label>
                    </div>
                    
                    <div class="flex items-center">
                        <input type="checkbox" id="googleDriveAutoLogin" class="mr-2">
                        <label for="googleDriveAutoLogin" class="text-xs text-gray-300">Auto-login next time</label>
                    </div>
                    
                    <div class="text-xs text-gray-400 mt-2">
                        By connecting, you agree to Google's 
                        <a href="https://policies.google.com/terms" target="_blank" class="text-[#D42F00] hover:underline">Terms of Service</a>
                        and 
                        <a href="https://policies.google.com/privacy" target="_blank" class="text-[#D42F00] hover:underline">Privacy Policy</a>.
                    </div>
                    
                    <div class="flex justify-between mt-4">
                        <button type="button" onclick="retryGoogleDriveConnection()" 
                                class="dj-button" id="googleDriveRetryBtn" disabled>
                            <i class="fas fa-sync-alt mr-1"></i> Retry
                        </button>
                        <button type="button" onclick="authenticateGoogleDrive()" 
                                class="dj-button bg-[#D42F00]" id="googleDriveConnectBtn">
                            <i class="fas fa-sign-in-alt mr-1"></i> Connect
                        </button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Spotify Login Modal -->
        <div id="spotifyModal" class="modal">
            <div class="modal-content bg-[#1a1a1a] p-4 rounded-lg max-w-md mx-auto">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-xl font-medium flex items-center">
                        <i class="fab fa-spotify mr-2 text-[#1DB954]"></i> Spotify Login
                    </h3>
                    <button onclick="closeModal('spotifyModal')" class="text-gray-400 hover:text-white">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <!-- Connection Status Indicator -->
                <div class="bg-[#222] p-3 rounded-lg mb-4">
                    <div class="flex items-center">
                        <div id="spotifyConnStatus" class="connection-status mr-2"></div>
                        <span id="spotifyStatusText" class="text-sm">Not connected</span>
                    </div>
                    <div id="spotifyErrorMsg" class="text-red-500 text-xs mt-2 hidden">
                        Connection error: Please check your credentials and try again.
                    </div>
                </div>
                
                <form id="spotifyLoginForm" class="space-y-3">
                    <div>
                        <label class="text-xs">Username or Email</label>
                        <input type="text" id="spotifyUsername" 
                               class="w-full bg-[#333] border border-[#444] rounded p-2 text-sm"
                               placeholder="username or email">
                    </div>
                    <div>
                        <label class="text-xs">Password</label>
                        <input type="password" id="spotifyPassword" 
                               class="w-full bg-[#333] border border-[#444] rounded p-2 text-sm"
                               placeholder="•••••••••••">
                    </div>
                    
                    <div class="flex items-center">
                        <input type="checkbox" id="spotifyRemember" class="mr-2">
                        <label for="spotifyRemember" class="text-xs text-gray-300">Remember me</label>
                    </div>
                    
                    <div class="flex items-center">
                        <input type="checkbox" id="spotifyAutoLogin" class="mr-2">
                        <label for="spotifyAutoLogin" class="text-xs text-gray-300">Auto-login next time</label>
                    </div>
                    
                    <div class="text-xs text-gray-400 mt-2">
                        By connecting, you agree to Spotify's 
                        <a href="https://www.spotify.com/us/legal/end-user-agreement/" target="_blank" class="text-[#D42F00] hover:underline">Terms of Service</a>
                        and 
                        <a href="https://www.spotify.com/us/legal/privacy-policy/" target="_blank" class="text-[#D42F00] hover:underline">Privacy Policy</a>.
                    </div>
                    
                    <div class="flex justify-between mt-4">
                        <button type="button" onclick="retrySpotifyConnection()" 
                                class="dj-button" id="spotifyRetryBtn" disabled>
                            <i class="fas fa-sync-alt mr-1"></i> Retry
                        </button>
                        <button type="button" onclick="authenticateSpotify()" 
                                class="dj-button bg-[#D42F00]" id="spotifyConnectBtn">
                            <i class="fas fa-sign-in-alt mr-1"></i> Connect
                        </button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- SoundCloud Login Modal -->
        <div id="soundCloudModal" class="modal">
            <div class="modal-content bg-[#1a1a1a] p-4 rounded-lg max-w-md mx-auto">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-xl font-medium flex items-center">
                        <i class="fab fa-soundcloud mr-2 text-[#FF5500]"></i> SoundCloud Login
                    </h3>
                    <button onclick="closeModal('soundCloudModal')" class="text-gray-400 hover:text-white">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <!-- Connection Status Indicator -->
                <div class="bg-[#222] p-3 rounded-lg mb-4">
                    <div class="flex items-center">
                        <div id="soundCloudConnStatus" class="connection-status mr-2"></div>
                        <span id="soundCloudStatusText" class="text-sm">Not connected</span>
                    </div>
                    <div id="soundCloudErrorMsg" class="text-red-500 text-xs mt-2 hidden">
                        Connection error: Please check your credentials and try again.
                    </div>
                </div>
                
                <form id="soundCloudLoginForm" class="space-y-3">
                    <div>
                        <label class="text-xs">Email</label>
                        <input type="email" id="soundCloudEmail" 
                               class="w-full bg-[#333] border border-[#444] rounded p-2 text-sm"
                               placeholder="your.email@example.com">
                    </div>
                    <div>
                        <label class="text-xs">Password</label>
                        <input type="password" id="soundCloudPassword" 
                               class="w-full bg-[#333] border border-[#444] rounded p-2 text-sm"
                               placeholder="•••••••••••">
                    </div>
                    
                    <div class="flex items-center">
                        <input type="checkbox" id="soundCloudRemember" class="mr-2">
                        <label for="soundCloudRemember" class="text-xs text-gray-300">Remember me</label>
                    </div>
                    
                    <div class="flex items-center">
                        <input type="checkbox" id="soundCloudAutoLogin" class="mr-2">
                        <label for="soundCloudAutoLogin" class="text-xs text-gray-300">Auto-login next time</label>
                    </div>
                    
                    <div class="text-xs text-gray-400 mt-2">
                        By connecting, you agree to SoundCloud's 
                        <a href="https://soundcloud.com/terms-of-use" target="_blank" class="text-[#D42F00] hover:underline">Terms of Service</a>
                        and 
                        <a href="https://soundcloud.com/pages/privacy" target="_blank" class="text-[#D42F00] hover:underline">Privacy Policy</a>.
                    </div>
                    
                    <div class="flex justify-between mt-4">
                        <button type="button" onclick="retrySoundCloudConnection()" 
                                class="dj-button" id="soundCloudRetryBtn" disabled>
                            <i class="fas fa-sync-alt mr-1"></i> Retry
                        </button>
                        <button type="button" onclick="authenticateSoundCloud()" 
                                class="dj-button bg-[#D42F00]" id="soundCloudConnectBtn">
                            <i class="fas fa-sign-in-alt mr-1"></i> Connect
                        </button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- YouTube Login Modal -->
        <div id="youtubeModal" class="modal">
            <div class="modal-content bg-[#1a1a1a] p-4 rounded-lg max-w-md mx-auto">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-xl font-medium flex items-center">
                        <i class="fab fa-youtube mr-2 text-[#FF0000]"></i> YouTube Login
                    </h3>
                    <button onclick="closeModal('youtubeModal')" class="text-gray-400 hover:text-white">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <!-- Connection Status Indicator -->
                <div class="bg-[#222] p-3 rounded-lg mb-4">
                    <div class="flex items-center">
                        <div id="youtubeConnStatus" class="connection-status mr-2"></div>
                        <span id="youtubeStatusText" class="text-sm">Not connected</span>
                    </div>
                    <div id="youtubeErrorMsg" class="text-red-500 text-xs mt-2 hidden">
                        Connection error: Please check your credentials and try again.
                    </div>
                </div>
                
                <form id="youtubeLoginForm" class="space-y-3">
                    <div>
                        <label class="text-xs">Google Account Email</label>
                        <input type="email" id="youtubeEmail" 
                               class="w-full bg-[#333] border border-[#444] rounded p-2 text-sm"
                               placeholder="your.email@gmail.com">
                    </div>
                    <div>
                        <label class="text-xs">Password</label>
                        <input type="password" id="youtubePassword" 
                               class="w-full bg-[#333] border border-[#444] rounded p-2 text-sm"
                               placeholder="•••••••••••">
                    </div>
                    
                    <div class="flex items-center">
                        <input type="checkbox" id="youtubeRemember" class="mr-2">
                        <label for="youtubeRemember" class="text-xs text-gray-300">Remember me</label>
                    </div>
                    
                    <div class="flex items-center">
                        <input type="checkbox" id="youtubeAutoLogin" class="mr-2">
                        <label for="youtubeAutoLogin" class="text-xs text-gray-300">Auto-login next time</label>
                    </div>
                    
                    <div class="text-xs text-gray-400 mt-2">
                        By connecting, you agree to YouTube's 
                        <a href="https://www.youtube.com/t/terms" target="_blank" class="text-[#D42F00] hover:underline">Terms of Service</a>
                        and 
                        <a href="https://policies.google.com/privacy"
    <div id="settingsModal" class="modal">
        <div class="modal-content bg-[#1a1a1a] p-4 rounded-lg max-w-2xl mx-auto">
            <h3 class="text-xl font-medium mb-4">App Settings</h3>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- Audio Settings -->
                <div class="bg-[#222] p-3 rounded-lg">
                    <h4 class="text-sm font-medium mb-2">Audio Settings</h4>
                    <div class="space-y-2">
                        <div>
                            <label class="text-xs">Audio Device</label>
                            <select id="audioDevice" class="w-full bg-[#333] text-xs p-1 rounded">
                                <!-- Populated dynamically -->
                            </select>
                        </div>
                        <div>
                            <label class="text-xs">Sample Rate</label>
                            <select id="sampleRate" class="w-full bg-[#333] text-xs p-1 rounded">
                                <option value="44100">44.1 kHz</option>
                                <option value="48000">48 kHz</option>
                                <option value="96000">96 kHz</option>
                            </select>
                        </div>
                        <div>
                            <label class="text-xs">Buffer Size</label>
                            <select id="bufferSize" class="w-full bg-[#333] text-xs p-1 rounded">
                                <option value="256">256</option>
                                <option value="512">512</option>
                                <option value="1024">1024</option>
                                <option value="2048">2048</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Broadcast Settings -->
                <div class="bg-[#222] p-3 rounded-lg">
                    <h4 class="text-sm font-medium mb-2">Broadcast Settings</h4>
                    <div class="space-y-2">
                        <div>
                            <label class="text-xs">Server Type</label>
                            <select id="serverType" class="w-full bg-[#333] text-xs p-1 rounded">
                                <option value="icecast">Icecast</option>
                                <option value="shoutcast">Shoutcast</option>
                            </select>
                        </div>
                        <div>
                            <label class="text-xs">Server URL</label>
                            <input type="text" id="serverUrl" class="w-full bg-[#333] text-xs p-1 rounded"
                                   placeholder="http://your-server:port">
                        </div>
                        <div>
                            <label class="text-xs">Mount Point</label>
                            <input type="text" id="mountPoint" class="w-full bg-[#333] text-xs p-1 rounded"
                                   placeholder="/live">
                        </div>
                        <div>
                            <label class="text-xs">Stream Password</label>
                            <input type="password" id="streamPassword" class="w-full bg-[#333] text-xs p-1 rounded">
                        </div>
                    </div>
                </div>

                <!-- Encoder Settings -->
                <div class="bg-[#222] p-3 rounded-lg">
                    <h4 class="text-sm font-medium mb-2">Encoder Settings</h4>
                    <div class="space-y-2">
                        <div>
                            <label class="text-xs">Bitrate</label>
                            <select id="bitrate" class="w-full bg-[#333] text-xs p-1 rounded">
                                <option value="64">64 kbps</option>
                                <option value="128">128 kbps</option>
                                <option value="192">192 kbps</option>
                                <option value="256">256 kbps</option>
                                <option value="320">320 kbps</option>
                            </select>
                        </div>
                        <div>
                            <label class="text-xs">Format</label>
                            <select id="format" class="w-full bg-[#333] text-xs p-1 rounded">
                                <option value="mp3">MP3</option>
                                <option value="aac">AAC</option>
                                <option value="ogg">OGG</option>
                            </select>
                        </div>
                        <div>
                            <label class="text-xs">Channels</label>
                            <select id="channels" class="w-full bg-[#333] text-xs p-1 rounded">
                                <option value="2">Stereo</option>
                                <option value="1">Mono</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Performance Settings -->
                <div class="bg-[#222] p-3 rounded-lg">
                    <h4 class="text-sm font-medium mb-2">Performance Settings</h4>
                    <div class="space-y-2">
                        <div class="flex items-center">
                            <input type="checkbox" id="lowLatencyMode" class="mr-2">
                            <label class="text-xs">Low Latency Mode</label>
                        </div>
                        <div class="flex items-center">
                            <input type="checkbox" id="hardwareAcceleration" class="mr-2">
                            <label class="text-xs">Hardware Acceleration</label>
                        </div>
                        <div class="flex items-center">
                            <input type="checkbox" id="autoGainControl" class="mr-2">
                            <label class="text-xs">Auto Gain Control</label>
                        </div>
                    </div>
                </div>
            </div>

            <div class="flex justify-end mt-4 space-x-2">
                <button onclick="saveSettings()" class="dj-button bg-[#D42F00]">
                    <i class="fas fa-save mr-1"></i> Save Settings
                </button>
                <button onclick="closeSettingsModal()" class="dj-button">
                    Cancel
                </button>
            </div>
        </div>
    </div>

    <script>
        // Functions for broadcast controls
        function toggleMic() {
            const micToggleBtn = document.getElementById('micToggleBtn');
            const micStatusIndicator = document.getElementById('micStatusIndicator');
            const isActive = micStatusIndicator.classList.contains('active');
            
            if (isActive) {
                // Turn off the mic
                micStatusIndicator.classList.remove('active');
                micToggleBtn.innerHTML = '<i class="fas fa-microphone mr-2"></i> Mic OFF';
                micToggleBtn.classList.remove('bg-[#D42F00]');
                // Here you would add the logic to actually disable the microphone
                showToast('Microphone turned off', 'info');
                stopMicrophoneMonitoring();
            } else {
                // Turn on the mic
                micStatusIndicator.classList.add('active');
                micToggleBtn.innerHTML = '<i class="fas fa-microphone mr-2"></i> Mic ON';
                micToggleBtn.classList.add('bg-[#D42F00]');
                // Here you would add the logic to actually enable the microphone
                showToast('Microphone turned on', 'success');
                startMicrophoneMonitoring();
            }
        }
        
        function toggleOnAir() {
            const onAirToggleBtn = document.getElementById('onAirToggleBtn');
            const onAirIndicator = document.getElementById('onAirIndicator');
            const isActive = onAirIndicator.classList.contains('active');
            
            if (isActive) {
                // Turn off ON AIR
                onAirIndicator.classList.remove('active');
                onAirToggleBtn.innerHTML = '<i class="fas fa-broadcast-tower mr-2"></i> Start Live';
                // Here you would add the logic to actually stop broadcasting
                showToast('Live broadcast ended', 'info');
                stopOutputMonitoring();
            } else {
                // Turn on ON AIR
                onAirIndicator.classList.add('active');
                onAirToggleBtn.innerHTML = '<i class="fas fa-broadcast-tower mr-2"></i> Stop Live';
                // Here you would add the logic to actually start broadcasting
                showToast('Live broadcast started!', 'success');
                startOutputMonitoring();
            }
        }
        
        function startMicrophoneMonitoring() {
            // This is a simulation for the demo
            const micLevelMeter = document.getElementById('micLevelMeter');
            const micPeakIndicator = document.getElementById('micPeakIndicator');
            
            // Clear any existing interval
            if (window.micLevelInterval) {
                clearInterval(window.micLevelInterval);
            }
            
            let peakLevel = 0;
            let peakHold = false;
            
            // Add active class for enhanced styling
            micPeakIndicator.classList.add('active');
            // Update the VU meter at regular intervals
            window.micLevelInterval = setInterval(() => {
                // Simulate microphone level (0-100)
                // In a real implementation, this would get actual audio levels
                const level = Math.min(100, Math.max(0, 40 + Math.random() * 60));
                
                // Update the VU meter display
                micLevelMeter.style.width = `${level}%`;
                
                // Track peak level
                if (level > peakLevel) {
                    peakLevel = level;
                    micPeakIndicator.style.right = `${100 - level}%`;
                    micPeakIndicator.style.opacity = '1';
                    
                    // Reset peak hold state
                    if (peakHold) {
                        clearTimeout(peakHold);
                    }
                    
                    // Hold peak for a moment before decay
                    peakHold = setTimeout(() => {
                        // Gradually fade out peak indicator with a smooth transition
                        micPeakIndicator.style.transition = 'opacity 1.5s ease-out';
                        micPeakIndicator.style.opacity = '0';
                        
                        // Reset peak level after indicator fades
                        setTimeout(() => {
                            peakLevel = 0;
                            // Restore original transition for next peak
                            micPeakIndicator.style.transition = 'right 0.3s ease-out, opacity 0.3s ease';
                        }, 1500);
                    }, 1000);
                }
            }, 100);
        }
        
        function stopMicrophoneMonitoring() {
            // Clear the update interval
            if (window.micLevelInterval) {
                clearInterval(window.micLevelInterval);
            }
            
            // Reset the VU meter
            const micLevelMeter = document.getElementById('micLevelMeter');
            const micPeakIndicator = document.getElementById('micPeakIndicator');
            
            if (micLevelMeter) {
                micLevelMeter.style.width = '0%';
            }
            
            if (micPeakIndicator) {
                micPeakIndicator.style.opacity = '0';
                micPeakIndicator.classList.remove('active');
            }
        }
        
        // Function to start output level monitoring
        function startOutputMonitoring() {
            // This is a simulation for the demo
            const outputLevelMeter = document.getElementById('outputLevelMeter');
            const outputPeakIndicator = document.getElementById('outputPeakIndicator');
            
            // Clear any existing interval
            if (window.outputLevelInterval) {
                clearInterval(window.outputLevelInterval);
            }
            
            let peakLevel = 0;
            let peakHold = false;
            
            // Add active class for enhanced styling
            outputPeakIndicator.classList.add('active');
            
            // Update the VU meter at regular intervals
            window.outputLevelInterval = setInterval(() => {
                // Simulate output level (0-100)
                // In a real implementation, this would get actual audio levels
                const level = Math.min(100, Math.max(0, 30 + Math.random() * 65));
                
                // Update the VU meter display
                outputLevelMeter.style.width = `${level}%`;
                
                // Track peak level
                if (level > peakLevel) {
                    peakLevel = level;
                    outputPeakIndicator.style.right = `${100 - level}%`;
                    outputPeakIndicator.style.opacity = '1';
                    
                    // Reset peak hold state
                    if (peakHold) {
                        clearTimeout(peakHold);
                    }
                    
                    // Hold peak for a moment before decay
                    peakHold = setTimeout(() => {
                        // Gradually fade out peak indicator with a smooth transition
                        outputPeakIndicator.style.transition = 'opacity 1.5s ease-out';
                        outputPeakIndicator.style.opacity = '0';
                        
                        // Reset peak level after indicator fades
                        setTimeout(() => {
                            peakLevel = 0;
                            // Restore original transition for next peak
                            outputPeakIndicator.style.transition = 'right 0.3s ease-out, opacity 0.3s ease';
                        }, 1500);
                    }, 1000);
                }
            }, 100);
        }
        
        // Function to stop output level monitoring
        function stopOutputMonitoring() {
            // Clear the update interval
            if (window.outputLevelInterval) {
                clearInterval(window.outputLevelInterval);
            }
            
            // Reset the VU meter
            const outputLevelMeter = document.getElementById('outputLevelMeter');
            const outputPeakIndicator = document.getElementById('outputPeakIndicator');
            
            if (outputLevelMeter) {
                outputLevelMeter.style.width = '0%';
            }
            
            if (outputPeakIndicator) {
                outputPeakIndicator.style.opacity = '0';
                outputPeakIndicator.classList.remove('active');
            }
        }
        
        // Function to toggle broadcast status
        function toggleBroadcast() {
            const startStopBtn = document.getElementById('startStopBroadcastBtn');
            const statusIndicator = document.getElementById('broadcastStatusIndicator');
            const statusText = document.getElementById('broadcastStatusText');
            const statsText = document.getElementById('broadcastStats');
            
            broadcasting = !broadcasting;
            
            if (broadcasting) {
                // Update UI for active broadcasting
                startStopBtn.innerHTML = '<i class="fas fa-stop-circle mr-2"></i> Stop Broadcasting';
                statusIndicator.classList.remove('bg-red-500');
                statusIndicator.classList.add('bg-green-500');
                statusText.textContent = 'Broadcasting active';
                statsText.innerHTML = `
                    <div class="grid grid-cols-2 gap-2 mt-2">
                        <div>
                            <span class="font-medium">Stream URL:</span> https://kirkradio.net/live
                        </div>
                        <div>
                            <span class="font-medium">Listeners:</span> <span id="listenerCount">0</span>
                        </div>
                        <div>
                            <span class="font-medium">Bitrate:</span> 128 kbps
                        </div>
                        <div>
                            <span class="font-medium">Uptime:</span> <span id="streamUptime">00:00:00</span>
                        </div>
                    </div>
                `;
                
                // Start simulated listener count and uptime
                startBroadcastSimulation();
                
                showToast('Broadcasting started', 'success');
            } else {
                // Update UI for inactive broadcasting
                startStopBtn.innerHTML = '<i class="fas fa-play-circle mr-2"></i> Start Broadcasting';
                statusIndicator.classList.remove('bg-green-500');
                statusIndicator.classList.add('bg-red-500');
                statusText.textContent = 'Not broadcasting';
                statsText.textContent = 'Configure your Icecast settings using the Broadcast Settings button in the toolbar.';
                
                // Stop simulated listener count and uptime
                stopBroadcastSimulation();
                
                showToast('Broadcasting stopped', 'info');
            }
        }
        
        // Variables for broadcast simulation
        let broadcastStartTime;
        let listenerCountInterval;
        let uptimeInterval;
        
        // Function to start broadcast simulation
        function startBroadcastSimulation() {
            broadcastStartTime = new Date();
            
            // Simulate increasing listener count
            let listeners = 0;
            listenerCountInterval = setInterval(() => {
                if (Math.random() > 0.7) {
                    listeners += Math.floor(Math.random() * 3);
                }
                document.getElementById('listenerCount').textContent = listeners;
            }, 5000);
            
            // Update uptime counter
            uptimeInterval = setInterval(() => {
                const now = new Date();
                const diff = now - broadcastStartTime;
                
                const hours = Math.floor(diff / 3600000).toString().padStart(2, '0');
                const minutes = Math.floor((diff % 3600000) / 60000).toString().padStart(2, '0');
                const seconds = Math.floor((diff % 60000) / 1000).toString().padStart(2, '0');
                
                document.getElementById('streamUptime').textContent = `${hours}:${minutes}:${seconds}`;
            }, 1000);
        }
        
        // Function to stop broadcast simulation
        function stopBroadcastSimulation() {
            clearInterval(listenerCountInterval);
            clearInterval(uptimeInterval);
        }
        
        // Function to toggle dropdowns
        function toggleDropdown(dropdownId) {
            const dropdown = document.getElementById(dropdownId);
            dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
        }
        
        // Functions for handling broadcast settings
        function toggleBroadcastSettings() {
            toggleDropdown('broadcastSettings');
        }
        
        // Functions for handling app settings
        function toggleAppSettings() {
            let modal = document.getElementById('settingsModal');
            if (modal) {
                modal.style.display = 'block';
                
                // Load current settings to form
                document.getElementById('sampleRate').value = appSettings.audio.sampleRate.toString();
                document.getElementById('bufferSize').value = appSettings.audio.bufferSize.toString();
                document.getElementById('serverType').value = appSettings.broadcast.serverType;
                document.getElementById('serverUrl').value = appSettings.broadcast.serverUrl;
                document.getElementById('mountPoint').value = appSettings.broadcast.mountPoint;
                document.getElementById('streamPassword').value = appSettings.broadcast.password;
                document.getElementById('bitrate').value = appSettings.encoder.bitrate.toString();
                document.getElementById('format').value = appSettings.encoder.format;
                document.getElementById('channels').value = appSettings.encoder.channels.toString();
                document.getElementById('lowLatencyMode').checked = appSettings.performance.lowLatencyMode;
                document.getElementById('hardwareAcceleration').checked = appSettings.performance.hardwareAcceleration;
                document.getElementById('autoGainControl').checked = appSettings.performance.autoGainControl;
                
                // Set audio device if available
                if (appSettings.audio.device && document.getElementById('audioDevice')) {
                    document.getElementById('audioDevice').value = appSettings.audio.device;
                }
            }
        }
        
        function closeSettingsModal() {
            let modal = document.getElementById('settingsModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }
        
        // General function to close any modal by ID
        function closeModal(modalId) {
            let modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'none';
            }
        }
        // Turntable scratching functionalities
        function startScratch(deckIndex, event) {
            scratching[deckIndex] = true;
            lastY[deckIndex] = event.clientY;
            const vinyl = document.getElementById(`vinyl${deckIndex + 1}`);
            vinyl.classList.add('scratching');
            
            // Handle scratching with mouse movement
            document.onmousemove = (e) => {
                if (scratching[deckIndex]) {
                    const deltaY = e.clientY - lastY[deckIndex];
                    performScratch(deckIndex, deltaY);
                    lastY[deckIndex] = e.clientY; // Update lastY for continuous scratch
                }
            };
            
            // Add document-level event listeners for mouse up
            document.onmouseup = () => {
                stopScratch(deckIndex);
            };
        }
        
        function performScratch(deckIndex, delta) {
            // Update vinyl rotation based on delta
            const vinyl = document.getElementById(`vinyl${deckIndex + 1}`);
            const currentRotation = getRotation(vinyl) || 0;
            vinyl.style.transform = `rotate(${currentRotation + delta}deg)`;
            
            // Update audio playback rate based on delta (if audio processor exists)
            if (decks[deckIndex].processor) {
                const playbackRate = 1 + (delta / 100); // Scale sensitivity
                // In a real implementation, you would call a method to change playback rate
                // decks[deckIndex].processor.setPlaybackRate(playbackRate);
            }
        }
        
        function stopScratch(deckIndex) {
            scratching[deckIndex] = false;
            const vinyl = document.getElementById(`vinyl${deckIndex + 1}`);
            vinyl.classList.remove('scratching');
            
            // Remove document-level event listeners
            document.onmousemove = null;
            document.onmouseup = null;
            
            // Reset playback rate (if audio processor exists)
            if (decks[deckIndex].processor) {
                // In a real implementation, you would call a method to reset playback rate
                // decks[deckIndex].processor.setPlaybackRate(1);
            }
        }
        
        // Helper function to get current rotation
        function getRotation(el) {
            const st = window.getComputedStyle(el);
            const matrix = st.getPropertyValue('transform');
            
            if (matrix === 'none') return 0;
            
            const values = matrix.split('(')[1].split(')')[0].split(',');
            const a = values[0];
            const b = values[1];
            
            return Math.round(Math.atan2(b, a) * (180/Math.PI));
        }
        
        // Basic audio handling
        let audioContext;
        let masterGain;
        const decks = [{}, {}];
        let scratching = [false, false];
        let lastY = [0, 0];
        let broadcasting = false;
        class AudioProcessor {
            constructor(context, masterNode) {
                this.context = context;
                this.masterNode = masterNode;
                this.source = null;
                this.gainNode = context.createGain();
                this.lowEQ = context.createBiquadFilter();
                this.midEQ = context.createBiquadFilter();
                this.highEQ = context.createBiquadFilter();

                this.lowEQ.type = 'lowshelf';
                this.lowEQ.frequency.value = 320;
                this.lowEQ.gain.value = 0;

                this.midEQ.type = 'peaking';
                this.midEQ.frequency.value = 1000;
                this.midEQ.Q.value = 1;
                this.midEQ.gain.value = 0;

                this.highEQ.type = 'highshelf';
                this.highEQ.frequency.value = 3200;
                this.highEQ.gain.value = 0;

                this.gainNode.connect(this.lowEQ);
                this.lowEQ.connect(this.midEQ);
                this.midEQ.connect(this.highEQ);
                this.highEQ.connect(this.masterNode);

                this.playing = false;
                this.looping = false;
                this.buffer = null;
                this.deckIndex = 0;
                this.trackTitle = "No track loaded";
                this.trackArtist = "--";
                this.duration = 0;
                this.offset = 0;
                this.startTime = 0;
            }

            loadBuffer(buffer, title = "Untitled Track", artist = "Unknown Artist") {
                this.buffer = buffer;
                this.duration = buffer.duration;
                this.trackTitle = title;
                this.trackArtist = artist;
                this.offset = 0;
                this.updateTrackInfo();
            }

            play() {
                // Your play logic
            }

            // Other methods...
        }

        // Initialize audio context on user interaction
        function initializeAudioContext() {
            if (!audioContext) {
                try {
                    // Create audio context with fallback for different browsers
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    
                    // Create master gain node for volume control
                    masterGain = audioContext.createGain();
                    masterGain.connect(audioContext.destination);
                    
                    // Initialize processors for both decks
                    decks[0].processor = new AudioProcessor(audioContext, masterGain);
                    decks[0].processor.deckIndex = 0;
                    
                    decks[1].processor = new AudioProcessor(audioContext, masterGain);
                    decks[1].processor.deckIndex = 1;
                    
                    console.log('Audio context initialized successfully');
                    return true;
                } catch (error) {
                    console.error('Failed to initialize audio context:', error);
                    showToast('Audio initialization failed. Please try reloading the page.', 'error');
                    return false;
                }
            }
            return true;
        }
        
        // Initialize audio on first user interaction (required by browsers)
        document.addEventListener('click', initializeAudioContext, { once: true });
        
        // Also try to initialize on page load (may fail due to browser restrictions)
        window.addEventListener('load', () => {
            console.log('Attempting to initialize audio context on load');
            // This will likely be blocked by browsers until user interaction
            initializeAudioContext();
            // Load saved settings
            loadSettings();
            // Initialize audio devices dropdown
            initializeAudioDevices();
        });
        
        function loadSettings() {
            const savedSettings = localStorage.getItem('appSettings');
            if (
        // Music service integration functions
        function connectGoogleDrive() {
            try {
                // Google Drive API integration placeholder
                showServiceConnectModal('Google Drive', 'Connecting to Google Drive...');
                // Simulating API connection process
                setTimeout(() => {
                    // Success case
                    closeModal('serviceConnectModal');
                    showToast('Successfully connected to Google Drive', 'success');
                }, 1500);
            } catch (error) {
                handleServiceError('Google Drive', error);
            }
        }

        function connectOneDrive() {
            try {
                // OneDrive API integration placeholder
                showServiceConnectModal('OneDrive', 'Connecting to OneDrive...');
                // Simulating API connection process
                setTimeout(() => {
                    // Success case
                    closeModal('serviceConnectModal');
                    showToast('Successfully connected to OneDrive', 'success');
                }, 1500);
            } catch (error) {
                handleServiceError('OneDrive', error);
            }
        }

        function connectSpotify() {
            try {
                // Spotify API integration placeholder
                showServiceConnectModal('Spotify', 'Connecting to Spotify...');
                // Simulating API connection process
                setTimeout(() => {
                    // Success case
                    closeModal('serviceConnectModal');
                    showToast('Successfully connected to Spotify', 'success');
                }, 1500);
            } catch (error) {
                handleServiceError('Spotify', error);
            }
        }

        function connectSoundCloud() {
            try {
                // SoundCloud API integration placeholder
                showServiceConnectModal('SoundCloud', 'Connecting to SoundCloud...');
                // Simulating API connection process
                setTimeout(() => {
                    // Success case
                    closeModal('serviceConnectModal');
                    showToast('Successfully connected to SoundCloud', 'success');
                }, 1500);
            } catch (error) {
                handleServiceError('SoundCloud', error);
            }
        }

        function connectAppleMusic() {
            try {
                // Apple Music API integration placeholder
                showServiceConnectModal('Apple Music', 'Connecting to Apple Music...');
                // Simulating API connection process
                setTimeout(() => {
                    // Success case
                    closeModal('serviceConnectModal');
                    showToast('Successfully connected to Apple Music', 'success');
                }, 1500);
            } catch (error) {
                handleServiceError('Apple Music', error);
            }
        }

        function connectYouTube() {
            try {
                // YouTube API integration placeholder
                showServiceConnectModal('YouTube', 'Connecting to YouTube...');
                // Simulating API connection process
                setTimeout(() => {
                    // Success case
                    closeModal('serviceConnectModal');
                    showToast('Successfully connected to YouTube', 'success');
                }, 1500);
            } catch (error) {
                handleServiceError('YouTube', error);
            }
        }

        // Error handling for service connections
        function handleServiceError(serviceName, error) {
            console.error(`Error connecting to ${serviceName}:`, error);
            closeModal('serviceConnectModal');
            
            // Show error modal with details
            const modalTitle = document.getElementById('modalTitle');
            const modalMessage = document.getElementById('modalMessage');
            
            if (modalTitle && modalMessage) {
                modalTitle.textContent = `${serviceName} Connection Error`;
                modalMessage.innerHTML = `
                    <p>There was an error connecting to ${serviceName}:</p>
                    <p class="text-red-500 mt-2">${error.message || 'Unknown error'}</p>
                    <p class="mt-2">Please check your internet connection and try again. If the problem persists, verify your account settings or contact support.</p>
                `;
                
                const alertModal = document.getElementById('alertModal');
                if (alertModal) {
                    alertModal.style.display = 'block';
                }
            } else {
                // Fallback if modal elements not found
                showToast(`Error connecting to ${serviceName}: ${error.message || 'Unknown error'}`, 'error');
            }
        }

        function showServiceConnectModal(serviceName, message) {
            // Create modal if it doesn't exist
            let modal = document.getElementById('serviceConnectModal');
            
            if (!modal) {
                modal = document.createElement('div');
                modal.id = 'serviceConnectModal';
                modal.className = 'modal';
                modal.innerHTML = `
                    <div class="modal-content">
                        <h3 class="text-xl font-medium mb-4" id="serviceModalTitle"></h3>
                        <div class="flex items-center justify-center mb-4">
                            <div class="loading-spinner mr-3"></div>
                            <p id="serviceModalMessage"></p>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
                
                // Add loading spinner style if not already present
                const styleExists = document.querySelector('style[data-id="loading-spinner-style"]');
                if (!styleExists) {
                    const style = document.createElement('style');
                    style.setAttribute('data-id', 'loading-spinner-style');
                    style.textContent = `
                        .loading-spinner {
                            border: 3px solid rgba(255, 255, 255, 0.2);
                            border-top-color: var(--highlight-active);
                            border-radius: 50%;
                            width: 24px;
                            height: 24px;
                            animation: spin 1s linear infinite;
                        }
                        @keyframes spin {
                            to { transform: rotate(360deg); }
                        }
                    `;
                    document.head.appendChild(style);
                }
            }
            
            // Update modal content
            document.getElementById('serviceModalTitle').textContent = serviceName;
            document.getElementById('serviceModalMessage').textContent = message;
            
            // Show modal
            modal.style.display = 'block';
        }

        function showToast(message, type = 'info') {
            // Create toast container if it doesn't exist
            let toastContainer = document.getElementById('toastContainer');
            
            if (!toastContainer) {
                toastContainer = document.createElement('div');
                toastContainer.id = 'toastContainer';
                toastContainer.className = 'fixed bottom-4 right-4 z-50';
                document.body.appendChild(toastContainer);
            }
            
            // Create toast element
            const toast = document.createElement('div');
            toast.className = `toast toast-${type} bg-[#222] border-l-4 p-3 mb-2 rounded shadow-lg flex items-center`;
            
            // Set border color based on type
            if (type === 'success') {
                toast.classList.add('border-green-500');
            } else if (type === 'error') {
                toast.classList.add('border-red-500');
            } else if (type === 'warning') {
                toast.classList.add('border-yellow-500');
            } else {
                toast.classList.add('border-blue-500');
            }
            
            // Set icon based on type
            let icon;
            if (type === 'success') {
                icon = 'check-circle';
            } else if (type === 'error') {
                icon = 'exclamation-circle';
            } else if (type === 'warning') {
                icon = 'exclamation-triangle';
            } else {
                icon = 'info-circle';
            }
            
            toast.innerHTML = `
                <i class="fas fa-${icon} mr-2 text-xl"></i>
                <span class="flex-1">${message}</span>
                <button class="ml-2 text-gray-500 hover:text-white" onclick="this.parentElement.remove()">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            // Add to container
            toastContainer.appendChild(toast);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                if (toast.parentElement) {
                    toast.remove();
                }
            }, 5000);
        }
        
        // Your remaining script logic...
        // It should include all functions like playDeck, loadTrack, and so on.
    </script>
<!-- Core libraries -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

<!-- Application modules -->
<script src="js/config.js"></script>
<script src="js/ui.js"></script>
<script src="js/audio.js"></script>
<script src="js/effects.js"></script>
<script src="js/turntable.js"></script>
<script src="js/app.js"></script>
<!-- Hidden file input for track loading -->
<input type="file" id="fileInput" accept="audio/*" style="display: none;">
</body>
</html>
